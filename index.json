[{"content":"\n\nä¸å¤šè¯´ï¼Œå¤§çº²èµ°ä¸€æ³¢\n\n- Dubbo æ˜¯ä»€ä¹ˆï¼Ÿ\n- å¦‚ä½•ä½¿ç”¨ï¼Ÿ\n- æ³¨å†Œä¸­å¿ƒ\n- å¤šåè®®æ”¯æŒ\n- å¤šç‰ˆæœ¬æ”¯æŒ\n- å¯åŠ¨æ£€æŸ¥\n- é›†ç¾¤å®¹é”™\n- é™çº§\n\n## Dubbo æ˜¯ä»€ä¹ˆï¼Ÿ\n\næˆ‘è¦ç›´æ¥è¯´ã€Šåˆ†å¸ƒå¼æœåŠ¡æ²»ç†æ¡†æ¶ã€‹è®²é“ç†æ²¡äº†è§£è¿‡çš„å°ä¼™ä¼´åº”è¯¥æ˜¯ç›´æ¥ä¸€è„¸æ‡µé€¼ï¼Œé‚£ä¹ˆå°±ä»å…¶ä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜å¼€å§‹å§ï¼Œé¦–å…ˆè¯´è¯´å†å²\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft8ao6bdjvj20nk0cawg5.jpg)\nä»ç»å…¸çš„å•ä½“æ¶æ„è¯´èµ·ï¼Œé€šå¸¸è¿™æ ·æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œç›´åˆ°ç°åœ¨éƒ½å¾ˆå¸¸ç”¨ï¼Œç„¶è€Œéšç€ç”¨æˆ·é‡çš„å¢åŠ ï¼Œæ‰©å±•æ€§èƒ½ä¹Ÿå¾ˆæ–¹ä¾¿ï¼ŒåŠ æœåŠ¡å™¨å¯ä»¥äº†ï¼Œä½†éšç€ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œå¢åŠ æœåŠ¡å™¨çš„æˆæœ¬ä¹Ÿå¤§å¤§çš„æé«˜äº†ï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹ä¹Ÿå®¹æ˜“é€ æˆæ€§èƒ½çš„æµªè´¹ï¼Œéšç€è¶ŠåŠ è¶Šå¤šï¼Œæ¸æ¸çš„å¸¦æ¥çš„æå‡ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„æ˜æ˜¾äº†ï¼Œå¼€å‘ç»´æŠ¤èµ·æ¥ä¹Ÿéå¸¸è‡ƒè‚¿ï¼Œäºæ˜¯å°±æƒ³æŠŠå®ƒæ‹†åˆ†ï¼Œä¾‹å¦‚è¿™é‡Œæˆ‘å°†å®ƒæ°´å¹³æ‹†åˆ†ï¼Œå°†æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ‹†åˆ†æˆå•ä¸ªä¸€ä½“çš„æœåŠ¡ï¼Œè¿™æ ·åˆ©äºå¼€å‘ç»´æŠ¤å’ŒåšæŠ€æœ¯ç§¯ç´¯ï¼Œåœ¨æ‰©å±•æ€§èƒ½çš„æ—¶å€™ä¹Ÿå¯ä»¥æœ‰é’ˆå¯¹çš„æ‰©å±•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft8cotv6yvj21480eugp9.jpg)\nåœ¨æˆ‘ä»¬æ°´å¹³æ‹†åˆ†åï¼Œä¾‹å¦‚è°ƒç”¨ä¸‹è®¢å•è¿™ä¸ªæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´çš„äº¤äº’æ˜¯è¿™æ ·çš„ï¼Œå¦‚ä¸Šå›¾ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªé€šä¿¡çš„è¿‡ç¨‹ä¼šé‡è§ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n1.  åœ°å€çš„ç»´æŠ¤ï¼Œéšç€æœºå™¨è¶Šæ¥è¶Šå¤šï¼Œå„ä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œä»–ä»¬åœ°å€ä¹Ÿä¸ä¸€æ ·\n2.  è´Ÿè½½å‡è¡¡\n3.  å®¹é”™\n4.  é™çº§\n5.  æœåŠ¡ä¹‹é—´å­˜åœ¨ä¸åŒåè®®çš„é€šä¿¡\n6.  æœåŠ¡ä¹‹é—´è°ƒç”¨çš„ç›‘æ§\n7.  æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¦‚é‚£äº›æœåŠ¡ä¾èµ–äºé‚£äº›æœåŠ¡ï¼Œæ¯”å¦‚é‚£äº›æœåŠ¡å¿…é¡»è¦ç­‰å¾…ä¾èµ–çš„æœåŠ¡å…ˆå¯åŠ¨è‡ªå·±æ‰èƒ½å¤Ÿå¯åŠ¨\n8.  â€¦.\n\næ‰€è°“çš„æ²»ç†æˆ‘ä¸ªäººç†è§£èµ·æ¥å°±æ˜¯ï¼šè§£å†³ä¸ç®¡ç†\n\nåœ¨ Dubbo çš„æ¶æ„ä¸­æœ‰ 4 ä¸­è§’è‰²\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft8coffhwdj20so0ie774.jpg)\nè¯¥å›¾å€Ÿé‰´è‡³ Dubbo å®˜æ–¹æ–‡æ¡£\n\n**Provider**\n\næœåŠ¡æä¾›è€…ï¼Œæä¾›æœåŠ¡ç»™äºˆæ¶ˆè´¹è€…æ¶ˆè´¹\n\n**Registry**\n\næ³¨å†Œä¸­å¿ƒï¼Œæä¾›è€…å°†æœåŠ¡æ³¨å†Œè‡³æ³¨å†Œä¸­å¿ƒï¼Œæ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…ï¼Œä¸€æ—¦æœåŠ¡å‘ç”Ÿå˜åŠ¨éƒ½ä¼šé€šçŸ¥æ¶ˆè´¹è€…ï¼Œå…¶å®å°±æ˜¯æœåŠ¡çš„å‘ç°ä¸æ³¨å†Œ\n\n** Consumer **\n\næœåŠ¡æ¶ˆè´¹è€…ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„\n\n** Monitor **\n\nç›‘è§†è€…ï¼Œç›‘æ§æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°ä¸è°ƒç”¨æ—¶é—´\n\n## å¦‚ä½•ä½¿ç”¨ï¼Ÿ\n\né¦–å…ˆæˆ‘åˆ›å»º 2 ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ªåˆ†åˆ«å«åš`dubbo-server-demo`ä¸€ä¸ªå«åš`dubbo-client-demo`ï¼Œåˆ†åˆ«éƒ½ä½¿ç”¨`Maven`æ¥æ„å»º\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft8d38fsgsj20gm0e63zk.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft8d9nau3dj20h80agjsc.jpg)\n\næ¥ç€åœ¨`server-api`æ¨¡å—é‡Œåˆ›å»ºä¸€ä¸ªå¯¹å¤–æä¾›æœåŠ¡çš„æ¥å£`TestService`\n\n```\npackage org.yuequan.dubbo.demo;\n\npublic interface TestService {\n    String sayHello(String msg);\n}\n```\n\næ¥ç€åœ¨`server-provider`ä¸­å¯¹è¯¥æ¥å£å®ç°ï¼Œå½“ç„¶ä¹Ÿè¦æ·»åŠ å¯¹`server-api`çš„ä¾èµ–\n\n```\n\u003cdependency\u003e\n    \u003cgroupId\u003eorg.yuequan.dubbo.demo\u003c/groupId\u003e\n    \u003cartifactId\u003eserver-api\u003c/artifactId\u003e\n    \u003cversion\u003e1.0-SNAPSHOT\u003c/version\u003e\n\u003c/dependency\u003e\n\n\u003cdependency\u003e\n    \u003cgroupId\u003eorg.yuequan.dubbo.demo\u003c/groupId\u003e\n    \u003cartifactId\u003eserver-api\u003c/artifactId\u003e\n    \u003cversion\u003e1.0-SNAPSHOT\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\néšåå¯¹è¯¥æ¥å£è¿›è¡Œå®ç°\n\n```\npackage org.yuequan.dubbo.demo;\n\npublic class TestServiceImpl implements TestService {\n    @Override\n    public String sayHello(String msg) {\n        return \"Hiï¼ŒCustomerï¼š\" + msg;\n    }\n}\n```\n\né¦–å…ˆå¼•å…¥ä¾èµ–\n\n```\n\u003cdependency\u003e\n    \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e\n    \u003cartifactId\u003edubbo\u003c/artifactId\u003e\n    \u003cversion\u003e2.5.10\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\næ¥ç€åœ¨`/META-INF/dubbo/dubbo-server.xml`ä¸­åšä¸€ä¸‹é…ç½®ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥é…ç½®ä¸€ä¸ªç®€å•çš„\n\n```\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cbeans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:dubbo=\"http://code.alibabatech.com/schema/dubbo\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://code.alibabatech.com/schema/dubbo      http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"\u003e\n    \u003cdubbo:application name=\"dubbo-server\" owner=\"yuequan\" /\u003e\n    \u003cdubbo:registry address=\"N/A\" /\u003e\n    \u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService\" /\u003e\n    \u003cbean class=\"org.yuequan.dubbo.demo.TestServiceImpl\" name=\"testService\" \u003e\u003c/bean\u003e\n\u003c/beans\u003e\n```\n\næ¥ç€æˆ‘ä»¬æ¥å†™ä¸€ä¸ª`main`å‡½æ•°ç”¨äºå¯åŠ¨å®ƒï¼Œæœ‰ 2 ç§æ–¹å¼ä¸€ç§æ˜¯ä½¿ç”¨`Spring`å®¹å™¨å¯åŠ¨æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä½¿ç”¨ Dubbo çš„`Main.main`å¯åŠ¨ï¼Œè¿™é‡Œæˆ‘æš‚æ—¶å…ˆç”¨`Spring`å®¹å™¨å¯åŠ¨\n\n```\npublic class App\n{\n    public static void main(String[] args) throws IOException {\n        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"META-INF/dubbo/dubbo-server.xml\");\n        context.start();\n        System.in.read();\n    }\n}\n```\n\næ¥ç€å¯åŠ¨åº”ç”¨ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—çš„è¾“å‡º\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft95eecog4j21ty0ekdmh.jpg)\nåŒæ—¶ä¹Ÿçœ‹åˆ°æœåŠ¡å‘å¸ƒæˆåŠŸäº†\n\næ¥ç€æ¥`dubbo-client-demo`ï¼Œé¦–å…ˆå¼•å…¥`dubbo`ä¾èµ–\n\n```\n\u003cdependency\u003e\n  \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e\n  \u003cartifactId\u003edubbo\u003c/artifactId\u003e\n  \u003cversion\u003e2.5.10\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\næ¥ç€å†™é…ç½®æ–‡ä»¶`META-INF/dubbo/dubbo-client.xml`\n\n```\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cbeans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:dubbo=\"http://code.alibabatech.com/schema/dubbo\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://code.alibabatech.com/schema/dubbo      http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"\u003e\n    \u003cdubbo:application name=\"dubbo-client\" owner=\"yuequan\" /\u003e\n    \u003cdubbo:registry address=\"N/A\" /\u003e\n\t  \u003cdubbo:reference interface=\"org.yuequan.dubbo.demo.TestService\" url=\"dubbo://192.168.10.102:20880/org.yuequan.dubbo.demo.TestService\" /\u003e\n\u003c/beans\u003e\n```\n\nè¿˜è®°å¾—æ§åˆ¶å°æ—¥å¿—è¾“å‡ºçš„åœ°å€å—ï¼Œè¿™é‡Œå°±æ˜¯äº†ï¼Œç°åœ¨æš‚æ—¶ä¸ç”¨æ³¨å†Œä¸­å¿ƒï¼Œå…ˆæ¥ä¸€ä¸ªæœ€ç®€å•çš„ç‚¹å¯¹ç‚¹é€šä¿¡ï¼Œæ¥ç€æˆ‘ä»¬æ¥å†™å®¢æˆ·ç«¯çš„å¯åŠ¨ç±»ï¼Œé€šä¿¡åè®®é»˜è®¤æ˜¯ä½¿ç”¨çš„`dubbo`å…¶é»˜è®¤ç«¯å£å°±æ˜¯ 20880\n\n```\npublic class App\n{\n    public static void main( String[] args )\n    {\n        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"META-INF/dubbo/dubbo-client.xml\");\n        TestService service = (TestService) context.getBean(\"testService\");\n        System.out.println(service.sayHello(\"YueQuan\"));\n    }\n}\n```\n\næ¥ç€å¯åŠ¨å®ƒ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft95ppynwrj21u80a2n0f.jpg)\nè‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ä½¿ç”¨ä¾‹å­å°±å†™å¥½äº†ï¼Œæ¥ç€è¿›å…¥ä¸‹ä¸€ä¸ªå°èŠ‚\n\n## æ³¨å†Œä¸­å¿ƒ\n\nä¸Šä¸€ä¸ªå°èŠ‚çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç‚¹å¯¹ç‚¹é€šä¿¡çš„ä¾‹å­ï¼Œæ¥ç€æˆ‘ä»¬æ¥é…ç½®æ³¨å†Œä¸­å¿ƒï¼Œ`dubbo`é»˜è®¤æ”¯æŒèƒ½å¤Ÿç”¨æ¥åšæ³¨å†Œä¸­å¿ƒçš„æœ‰\n\n- Multicast\n- Zookeeper\n- Redis\n- Simple\n  è¿™é‡Œå®˜æ–¹æ¨èä½¿ç”¨ Zookeeperï¼Œä¸ä¼š Zookeeper å¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç« ï¼Œé¦–å…ˆæ¥ä¿®æ”¹`dubbo-server.xml`æ³¨å†Œä¸­å¿ƒé…ç½®\n\n```\n\u003c!-- N/A ä»£è¡¨ç€æ²¡æœ‰ï¼Œä¸ä½¿ç”¨çš„æ„æ€ --\u003e\n\u003cdubbo:registry address=\"N/A\" /\u003e\n\u003c!-- ä¿®æ”¹æˆï¼Œå½“ç„¶ä½ è¦å¯åŠ¨ZooKeeper --\u003e\n\u003cdubbo:registry address=\"zookeeper://127.0.0.1:2181\" /\u003e\n```\n\næ¥ç€å¼•å…¥ ZooKeeper ä¾èµ–\n\n```\n\u003cdependency\u003e\n    \u003cgroupId\u003eorg.apache.zookeeper\u003c/groupId\u003e\n    \u003cartifactId\u003ezookeeper\u003c/artifactId\u003e\n    \u003cversion\u003e3.4.12\u003c/version\u003e\n    \u003ctype\u003epom\u003c/type\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n    \u003cgroupId\u003ecom.101tec\u003c/groupId\u003e\n    \u003cartifactId\u003ezkclient\u003c/artifactId\u003e\n    \u003cversion\u003e0.10\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\næ¥ç€å¯åŠ¨\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft962ircsgj21ys0hitcj.jpg)\nå‘ç°æ—¥å¿—ä»€ä¹ˆéƒ½æ²¡æœ‰è¾“å‡ºï¼Œæ¥ç€é…ç½®ä¸‹æ—¥å¿—`log4j.properties`\n\n```\nlog4j.rootLogger=INFO, stdout\n\n# Direct log messages to stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.Target=System.out\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n\n```\n\næ¥ç€é‡å¯ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æœ‰æ—¥å¿—è¾“å‡ºäº†\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft967oulyhj21ve0fmdmy.jpg)\n\næ¥ç€çœ‹çœ‹æ¥çœ‹çœ‹ Zookeeper è¿™è¾¹\n\n```\n// è¿è¡Œå®¢æˆ·ç«¯\n./zkCli.sh\n```\n\nè¾“å…¥`ls /`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft96a9c1juj20js02m74n.jpg)\n\nå¯ä»¥çœ‹åˆ°ä¸‹é¢å¤šäº†ä¸€ä¸ª dubbo èŠ‚ç‚¹ï¼Œæ¥ç€æ¥çœ‹ä¸‹ dubbo èŠ‚ç‚¹ä¸‹çš„å†…å®¹ï¼š`ls /dubbo`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft96h5iy2tj20j4026gly.jpg)\n\nå¯ä»¥çœ‹åˆ°æ¥å£å·²ç»è¢«æ³¨å†Œä¸Šæ¥äº†ï¼Œæ¥ç€æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¥å£ä¸‹çš„å†…å®¹ï¼š\n\n```\nls /dubbo/org.yuequan.dubbo.demo.TestService\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft96j72liyj20ve026t95.jpg)\nå¯ä»¥çœ‹åˆ°ä¸‹é¢ç°åœ¨å°± 2 ä¸ªèŠ‚ç‚¹,æˆ‘ä»¬æ¥çœ‹çœ‹ç°åœ¨æœ‰å¤šå°‘ä¸ª providers:\n\n```\nls /dubbo/org.yuequan.dubbo.demo.TestService/providers\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft96jbgz18j20vm050myq.jpg)\nå¯ä»¥çœ‹åˆ°å·²ç»æ³¨å†Œä¸Šæ¥äº†\n\næ¥ç€æ¥é…ç½®ä¸‹`dubbo-client-demo`ï¼Œé¦–å…ˆå¼•å…¥ä¾èµ–\n\n```\n\u003cdependency\u003e\n    \u003cgroupId\u003eorg.apache.zookeeper\u003c/groupId\u003e\n    \u003cartifactId\u003ezookeeper\u003c/artifactId\u003e\n    \u003cversion\u003e3.4.12\u003c/version\u003e\n    \u003ctype\u003epom\u003c/type\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n    \u003cgroupId\u003ecom.101tec\u003c/groupId\u003e\n    \u003cartifactId\u003ezkclient\u003c/artifactId\u003e\n    \u003cversion\u003e0.10\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\nç„¶åä¿®æ”¹é…ç½®`dubbo-client.xml`\n\n```\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:registry address=\"N/A\" /\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:registry address=\"zookeeper://127.0.0.1:2181\" /\u003e\n\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" url=\"dubbo://192.168.10.102:20880/org.yuequan.dubbo.demo.TestService\" /\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" /\u003e\n```\n\næ¥ç€å¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡º\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft96q0t62zj21sy09iac7.jpg)\næ¥ç€æˆ‘ä»¬å†æ¥çœ‹ä¸‹ Zookeeperï¼š\n\n```\nls /dubbo/org.yuequan.dubbo.demo.TestService\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft973qukjrj20vc02sq3l.jpg)\nå¯ä»¥çœ‹è§å¤šäº† 2 ä¸ªèŠ‚ç‚¹åˆ†åˆ«ä¸º`routers`å’Œ`consumers`è¿™æ—¶å€™è¾“å…¥\n```\nls /dubbo/org.yuequan.dubbo.demo.TestService/comsumers\n```\nä¼šå‘ç°è¿”å›çš„æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œè¿™æ˜¯å› ä¸ºå®¢æˆ·ç«¯çš„æ¶ˆè´¹å·²ç»ç»“æŸäº†ï¼Œæ‰€ä»¥è¯¥ä¸‹çš„èŠ‚ç‚¹ä¹Ÿä¼šè¢«æ¸…é™¤ï¼Œè¿™ä¸€ç‰¹æ€§å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨ Zookeeper çš„ä¸´æ—¶èŠ‚ç‚¹æ¥å®ç°ï¼Œå®é™…ä¸Šå®ƒä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œæ¥ç€æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹å®¢æˆ·ç«¯çš„ä»£ç è®©ä»–ä¸é‚£ä¹ˆå¿«ç»“æŸ\n\n```\npublic class App\n{\n    public static void main( String[] args ) throws InterruptedException {\n        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"META-INF/dubbo/dubbo-client.xml\");\n        TestService service = (TestService) context.getBean(\"testService\");\n        System.out.println(service.sayHello(\"YueQuan\"));\n        Thread.sleep(10000);\n    }\n}\n```\n\nå¯åŠ¨åï¼Œå†æ¥çœ‹çœ‹\n\n```\nls /dubbo/org.yuequan.dubbo.demo.TestService/comsumers\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft973w42suj20vk06m40g.jpg)\n\nå¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…ä¿¡æ¯ï¼Œè¿™æ˜¯å•ä¸ªé…ç½®æ³¨å†Œä¸­å¿ƒï¼Œé‚£å¦‚æœæœ‰å¤šä¸ªå‘¢ï¼Ÿé…ç½®å¤šæ³¨å†Œä¸­å¿ƒä¹Ÿéå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š\n\n```\n\u003cdubbo:registry protocol=\"zookeeper\" address=\"192.168.1.1:2181,192.16.1.2:2181,192.168.1.3:2181\" /\u003e\n\u003c!-- OR --\u003e\n\u003cdubbo:registry address=\"zookeeper://192.168.1.1:2181?backup=192.16.1.2:2181,192.168.1.3:2181\" /\u003e\n\u003c!-- æ›´å¤šå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£~~~ --\u003e\n```\n\n## å¤šåè®®\n\næˆ‘ä»¬ä¸€ä¸ªæœåŠ¡å¯èƒ½ä¹‹å‰æ˜¯ä½¿ç”¨çš„`dubbo`åè®®ä½†åé¢åˆæ”¹æˆäº†`hessian`åè®®ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªæœåŠ¡æä¾›äº†`dubbo`åè®®ä¹Ÿæä¾›äº†`hessian`åè®®ï¼Œä½†ä¹Ÿæœ‰çš„å®¢æˆ·ç«¯å®ƒåªä½¿ç”¨ä¸€ç§åè®®çš„é€šä¿¡æ–¹å¼ï¼Œåœ¨å¤šåè®®çš„æƒ…å†µä¸‹ï¼Œ`Dubbo`æ¡†æ¶ä¹Ÿåšäº†å¾ˆå¥½çš„å®ç°æ¥ç€ä¿®æ”¹`dubbo-server.xml`æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å°†ä¼šä½¿ç”¨`hessian`å’Œ`dubbo`2 ä¸ªåè®®,æ‰€ä»¥éœ€è¦å…ˆå¼•å…¥`hessian`çš„ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°å®¹å™¨æ‰€ä»¥è¿˜éœ€è¦å¼•å…¥`servlet-api`å’Œä¸€ä¸ª`servlet`å®¹å™¨ï¼Œé‚£è¿™é‡Œæˆ‘å°±ä½¿ç”¨`jetty`ï¼Œæ·»åŠ çš„ä¾èµ–å¦‚ä¸‹\n\n```\n\u003cdependency\u003e\n    \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e\n    \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e\n    \u003cversion\u003e4.0.1\u003c/version\u003e\n    \u003cscope\u003eprovided\u003c/scope\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n    \u003cgroupId\u003eorg.mortbay.jetty\u003c/groupId\u003e\n    \u003cartifactId\u003ejetty\u003c/artifactId\u003e\n    \u003cversion\u003e6.1.26\u003c/version\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n    \u003cgroupId\u003ecom.caucho\u003c/groupId\u003e\n    \u003cartifactId\u003ehessian\u003c/artifactId\u003e\n    \u003cversion\u003e4.0.51\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\næ¥ç€ä¿®æ”¹é…ç½®\n\n```\n\t\u003cdubbo:protocol name=\"dubbo\" port=\"20880\" /\u003e\n\t\u003cdubbo:protocol name=\"hessian\" port=\"8011\" /\u003e\n\t\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService\" protocol=\"dubbo,hessian\" /\u003e\n```\n\næ¥ç€å¯åŠ¨ï¼Œè¿™æ ·å°±é…ç½®å¥½äº†ï¼Œä½†æ˜¯è¿™æ ·çœ‹ä¸åˆ°æ˜æ˜¾çš„æ•ˆæœå•Šï¼Ÿæˆ‘æ€ä¹ˆçŸ¥é“æˆ‘å®¢æˆ·ç«¯å†æœªæŒ‡å®šåè®®çš„æƒ…å†µä¸‹æ¶ˆè´¹çš„æ˜¯`hessian`åè®®è¿˜æ˜¯`dubbo`åè®®ï¼Ÿäºæ˜¯ä¸ºäº†æ¼”ç¤ºå¯ä»¥è¿™æ ·åšå°†`TestServiceImpl`åœ¨å¤åˆ¶ä¸€ä»½ï¼Œä¿®æ”¹ä¸‹å…¶ä¸­å†…å®¹\n\n```\npublic class TestService2Impl implements TestService {\n    @Override\n    public String sayHello(String msg) {\n        return \"Hi,Customerï¼š\" + msg + \"ï¼Œthrough Hessian protocol\";\n    }\n}\n```\n\nç„¶åå†è°ƒæ•´ä¸‹é…ç½®\n\n```\n\u003cbean class=\"org.yuequan.dubbo.demo.TestServiceImpl\" name=\"testService\" \u003e\u003c/bean\u003e\n\u003cbean class=\"org.yuequan.dubbo.demo.TestService2Impl\" name=\"testService2\"\u003e\u003c/bean\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService\" protocol=\"dubbo\" /\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService2\" protocol=\"hessian\" /\u003e\n```\n\næ¥ç€å¯åŠ¨ï¼Œç„¶åä¸ºäº†æ˜æ˜¾ï¼Œå†ä¿®æ”¹ä¸‹å®¢æˆ·ç«¯çš„è°ƒç”¨ä»£ç å¹¶å¼•å…¥ä¾èµ–ï¼Œè®©å®ƒè°ƒç”¨åæ¬¡ï¼Œå¯ä»¥çœ‹å‡ºè¿™åæ¬¡åˆ†åˆ«è°ƒç”¨çš„é‚£ä¸ª\n\n```\n\u003cdependency\u003e\n  \u003cgroupId\u003ejavax.servlet\u003c/groupId\u003e\n  \u003cartifactId\u003ejavax.servlet-api\u003c/artifactId\u003e\n  \u003cversion\u003e4.0.1\u003c/version\u003e\n  \u003cscope\u003eprovided\u003c/scope\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n  \u003cgroupId\u003eorg.mortbay.jetty\u003c/groupId\u003e\n  \u003cartifactId\u003ejetty\u003c/artifactId\u003e\n  \u003cversion\u003e6.1.26\u003c/version\u003e\n\u003c/dependency\u003e\n\u003cdependency\u003e\n  \u003cgroupId\u003ecom.caucho\u003c/groupId\u003e\n  \u003cartifactId\u003ehessian\u003c/artifactId\u003e\n  \u003cversion\u003e4.0.51\u003c/version\u003e\n\u003c/dependency\u003e\n```\n\nå®¢æˆ·ç«¯ä»£ç ä¿®æ”¹å¦‚ä¸‹\n\n```\npublic class App\n{\n    public static void main( String[] args ) throws InterruptedException {\n        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"META-INF/dubbo/dubbo-client.xml\");\n        TestService service = (TestService) context.getBean(\"testService\");\n        for (int i = 0; i \u003c 10; i++) {\n            System./out/.println(service.sayHello(\"YueQuan\"));\n        }\n\n    }\n}\n```\n\næ¥ç€å¯åŠ¨æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft98o7pq1kj21u60ngaey.jpg)\nDubbo é»˜è®¤çš„è´Ÿè½½å‡è¡¡æœºåˆ¶æ˜¯éšæœºçš„ï¼Œå…·ä½“çš„ä¼šåœ¨åç»­æ–‡ç« ç»†å†™\n\n## å¤šç‰ˆæœ¬æ”¯æŒ\n\næœåŠ¡æä¾›å¯¹å¤–çš„æ¥å£å¯èƒ½ä¼šé‡‡å–æŸç§ç­–ç•¥é€æ­¥å¹³æ»‘å‡çº§ï¼Œä¾‹å¦‚åŸå…ˆä½¿ç”¨ 1.0.0 çš„æ¥å£ï¼Œåˆå¯¹å¤–æä¾›äº† 2.0.0 å¤„äºåˆšåˆšå¼€æ”¾ï¼Œå­˜åœ¨æŸäº›ä¸ç¨³å®šå› ç´ ï¼Œå¯èƒ½æƒ³é€æ­¥å¼€å‘ï¼ŒæŸäº›å®¢æˆ·ç«¯ç»§ç»­ä½¿ç”¨ 1.0.0ï¼Œè®©ä¸€éƒ¨åˆ†å®¢æˆ·ç«¯å…ˆä½¿ç”¨ 2.0.0\n\næ¥ç€æˆ‘ä»¬ä¿®æ”¹`dubbo-server.xml`\n\n```\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService\" protocol=\"dubbo\" /\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService2\" protocol=\"hessian\"/\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService\" protocol=\"dubbo\" version=\"1.0.0\" /\u003e\n\u003cdubbo:service interface=\"org.yuequan.dubbo.demo.TestService\" ref=\"testService2\" protocol=\"hessian\" version=\"2.0.0\" /\u003e\n```\n\nå¯¹äº 1.0.0 çš„æ¥å£è®¿é—®ä½¿ç”¨`dubbo`åè®®ï¼Œ2.0.0 çš„æ¥å£è®¿é—®ä½¿ç”¨`hessian`\nç„¶åä¿®æ”¹å®¢æˆ·ç«¯é…ç½®`dubbo-client.xml`\n\n```\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" version=\"1.0.0\" /\u003e\n```\n\nç„¶åè¿è¡Œï¼Œä½ ä¼šå‘ç°åªä¼šè°ƒç”¨å®šä¹‰çš„`1.0.0`ç‰ˆæœ¬çš„æœåŠ¡ï¼Œ`2.0.0`åŒç†\n\n## å¯åŠ¨æ£€æŸ¥\n\nåœ¨æœåŠ¡çš„å¯åŠ¨è¿‡ç¨‹ä¸­å¯èƒ½æœ‰ä¾èµ–äºå…¶å®ƒæœåŠ¡ï¼Œä½†å…¶å®ƒæœåŠ¡å¹¶æ²¡æœ‰è¿è¡Œèµ·æ¥ï¼Œè¿™æ—¶å€™ä½ å…ˆèµ·èµ·æ¥äº†ï¼Œå¿…ç„¶ä¼šæŠ¥é”™ï¼Œæ›´æœ‰æ„æ€çš„æ˜¯å¦‚æœæ˜¯äº’ç›¸ä¾èµ–ï¼Œé‚£äº’ç›¸éƒ½èµ·ä¸æ¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰€ä»¥è¿™é‡Œå°±è¦å…³é—­å¯åŠ¨æ£€æŸ¥ï¼Œä¾‹å¦‚\n\n```\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" version=\"1.0.0\" /\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" version=\"1.0.0\" check=\"false\"/\u003e\n```\n\n## é›†ç¾¤å®¹é”™\n\nåœ¨é›†ç¾¤è°ƒç”¨ä¸­å‡ºç°è°ƒç”¨å¤±è´¥æ—¶ï¼Œæ¯”å¦‚æ‰€éœ€è¦è°ƒç”¨çš„æœåŠ¡å®ƒä¸€ç›´æœªè¿”å›æ•°æ®é˜»å¡ä½äº†ï¼Œç›´åˆ°è¶…æ—¶ç­‰æƒ…å†µï¼Œå¯¹äºè°ƒç”¨å¤±è´¥ Dubbo æä¾›äº†å‡ ç§å®¹é”™æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯\n\n1.  Failover\n2.  Failfast\n3.  Failsafe\n4.  Failback\n5.  Forking\n6.  Broadcast\n\n** Failover **\n\né»˜è®¤å°±æ˜¯å®ƒï¼Œå¤±è´¥åè‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥åï¼Œè‡ªåŠ¨åˆ‡æ¢å…¶å®ƒæœåŠ¡å™¨ï¼Œå½“ç„¶å¯ä»¥è®¾ç½®é‡è¯•æ¬¡æ•°\n\n** Failfast **\n\nå¿«é€Ÿå¤±è´¥ï¼Œå¤±è´¥åå°±ç«‹é©¬æŠ¥é”™\n\n** Failfast **\n\nå®‰å…¨å¤±è´¥ï¼Œå‘ç”Ÿå¼‚å¸¸ï¼Œç«‹é©¬åæ‰ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å¿½ç•¥\n\n** Failback **\n\nå¤±è´¥åè‡ªåŠ¨æ¢å¤\n\n** Forking **\n\nåŒæ—¶å¹¶è¡Œè°ƒç”¨å‡ ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ï¼Œä½†å¯ä»¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°\n\n** Broadcast **\n\nå¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼ŒæŒ¨ä¸ªè°ƒç”¨ï¼Œåªè¦æœ‰ä¸€ä¸ªæŠ¥é”™å°±æŠ¥é”™\n\né€šå¸¸å¯ä»¥é€šè¿‡é…ç½®å¯ä»¥å¯¹å®¹é”™çš„æ‰‹æ®µè¿›è¡Œæ›´æ”¹ï¼Œå¦‚ä¸‹ï¼š\n\n```\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" check=\"false\" version=\"1.0.0\" /\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:reference cluster=\"failsafe\" id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" check=\"false\" version=\"1.0.0\" /\u003e\n```\n\nè¿™é‡Œæˆ‘é…ç½®çš„`failsafe`æ‰€ä»¥æ¶ˆè´¹è€…è°ƒç”¨è¯¥æœåŠ¡çš„æä¾›è€…å°±ç®—å‡ºç°å¼‚å¸¸ä¹Ÿä¼šè¢«å¿½ç•¥æ‰ï¼Œä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæˆ‘è¿™é‡Œå°†è¶…æ—¶æ—¶é—´ä¿®æ”¹ä¸º 50 æ¯«ç§’\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft9uy1pd8ij21i40is0xf.jpg)\nå› ä¸ºæˆ‘è¿™é‡Œæ˜¯æœ¬æœºæ‰€ä»¥ 50 æ¯«ç§’ä¹Ÿè¿˜æ˜¯æœ‰æ‰§è¡ŒæˆåŠŸçš„ç°è±¡ä¸è¿‡æ— æ‰€è°“ï¼Œçœ‹ç¬¬ä¸€ä¸ª`null`æ‰§è¡Œå¤±è´¥çš„å¼‚å¸¸å¹¶æ²¡æœ‰è¾“å‡ºè€Œæ˜¯ç›´æ¥è¿”å›äº† null\n\n## é™çº§\n\né™çº§æˆ‘ç”¨ä¸€ä¸ªæ¯”è¾ƒç¬¼ç»Ÿçš„è¯´æ³•æ¥ç®€å•çš„é˜è¿°ä¸€ä¸‹ï¼Œé™çº§å®é™…ä¸Šå°±æ˜¯å…³é—­æˆ–è€…å‡å°‘å…¶å®ƒæœåŠ¡æ‰€å ç”¨çš„èµ„æºæ¥ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå°±æ¯”å¦‚å°ç±³çš„é¥¥é¥¿è¥é”€æˆ–è€…åœ¨åŒ 11 ä¸‹å•çš„æ—¶å€™ç»å¸¸ä¼šå‡ºç°æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•ï¼Œå†æ¯”å¦‚è¯´åœ¨åŒ 11 ä¸‹å•é«˜å³°çš„æ—¶å€™ï¼Œä¸ºäº†é›†ä¸­èµ„æºï¼Œå°†å¹³æ—¶é¦–é¡µç»™æ¨èçš„æ•°æ®åˆ†æå¹¶æ¨é€ç»™æˆ‘çš„ç›¸å…³æœåŠ¡å…¨éƒ¨å…³æ‰ï¼Œä»…ä¿ç•™åŸºæœ¬æ ¸å¿ƒæœåŠ¡ï¼Œç­‰é«˜å³°æœŸä¸€è¿‡åœ¨æŠŠè¿™äº›é™„åŠ æœåŠ¡å¼€æ”¾ï¼Œå®é™…ä¸Šé™çº§æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ï¼šé¡µé¢é™çº§ã€è¯»é™çº§ã€å†™é™çº§ã€è¶…æ—¶é™çº§ã€å¼€å…³é™çº§ç­‰ç­‰ç­‰ï¼Œåæ­£è¿™é‡Œ get åˆ°ç‚¹å°±å¯ä»¥äº†ï¼Œä»¥ååº”è¯¥æ˜¯æœ‰æœºä¼šæ¥å•ç‹¬è¯´é™çº§è¿™ä¸ªæ¦‚å¿µçš„ã€‚\nå¯¹äºæœåŠ¡é™çº§ Dubbo ä¹Ÿæ˜¯æä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è®©æˆ‘ä»¬å¤„ç†çš„ã€‚\nå°±æ¯”å¦‚è¯´ä¸€ä¸ªæ¥å£è¶…è¿‡äº† 50 æ¯«ç§’çš„å“åº”æ—¶é—´æˆ‘ä»¬å°±å¯¹å®ƒè¿›è¡Œé™çº§ï¼Œæ¥ä¿è¯å®ƒåŸºæœ¬å¯ç”¨ï¼Œæ¥å†™ä¸ª demo ä¿®æ”¹é…ç½®æ–‡ä»¶`dubbo-client.xml`\n\n```\n\u003c!-- ä¿®æ”¹å‰ --\u003e\n\u003cdubbo:reference cluster=\"failsafe\" id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" check=\"false\" version=\"1.0.0\" /\u003e\n\u003c!-- ä¿®æ”¹å --\u003e\n\u003cdubbo:reference id=\"testService\" interface=\"org.yuequan.dubbo.demo.TestService\" check=\"false\" version=\"1.0.0\" mock=\"org.yuequan.dubbo.demo.TimeoutMock\" timeout=\"50\"/\u003e\n```\n\nè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯ä»¥å‘ç°æˆ‘å°†`cluster`å› ä¸ºè¿™é‡Œå¦‚æœæ˜¯ä½¿ç”¨çš„`failsafe`çš„è¯æ˜¯ä¸ä¼šé™çº§çš„ï¼Œè€Œæ˜¯ç›´æ¥èµ°`failsafe`çš„æœºåˆ¶çš„ï¼Œæ¥ç€è¿è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ§åˆ¶å°\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft9vce24rrj219u0g6dk1.jpg)\nå¯ä»¥çœ‹åˆ°è°ƒç”¨è¶…è¿‡äº† 50 æ¯«ç§’çš„ä¼šç›´æ¥é™çº§ï¼Œæœ¬èŠ‚å°±å…ˆåˆ°è¿™é‡Œã€‚\n\n\nå¦‚æœä½ è§‰å¾—ä½œè€…å†™çš„è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©æˆ–è€…æ”¶è·å¾ˆå¤§çš„è¯ï¼Œä½ å¯ä»¥å°è¯•ç€è¯·æˆ‘å–ä¸€ç“¶ã€Šä¸œæ–¹æ ‘å¶ã€‹æˆ–è€…åƒä¸€å—ã€Š\u001dé¸¡èƒ¸ã€‹æ¥æ¿€åŠ±æˆ‘ï¼ï¼ï¼\n\n**å¾®ä¿¡è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmntt0mzpj20yi1auaki.jpg)\n\n\n**æ”¯ä»˜å®è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnun44gdj20go0p00y2.jpg)","cover":"","link":"dubbo_base.html","preview":"\u003cp\u003eDubbo(ä¸€)å…¥é—¨\u003c/p\u003e\n","title":"Dubbo(ä¸€)å…¥é—¨"},{"content":"\n\nå—¯ï¼Œæˆ‘æƒ³æƒ³ä»ä»€ä¹ˆåœ°æ–¹å†™èµ·æ¯”è¾ƒå¥½å‘¢ï¼Œæˆ‘è§‰å¾—ä»åˆ†å¸ƒå¼çš„Leaderé€‰ä¸¾ï¼Œè¿˜æœ‰å®ƒæ¶ˆæ¯åŒæ­¥çš„åˆ†å¸ƒå¼äº‹åŠ¡è¯´èµ·å§ï¼Œå¤§çº²èµ°ä¸€æ³¢\n\n* ä¸ºä»€ä¹ˆéœ€è¦é€‰ä¸¾Leader\n* å¦‚ä½•é€‰ä¸¾Leaderçš„åŠä½¿ç”¨ä»€ä¹ˆæœºåˆ¶è¾¾åˆ°æ•°æ®ä¸€è‡´æ€§\n* ç®€å•é˜…è¯»ä¸‹Leaderé€‰ä¸¾çš„æºç \n\n## ä¸ºä»€ä¹ˆéœ€è¦é€‰ä¸¾Leader\nè¦äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦å¾ˆæ˜ç¡®çš„çŸ¥é“ZooKeeperé›†ç¾¤ä¸‹å‡ ä¸ªè§’è‰²çš„ä¸»è¦åˆ†å·¥(Leaderã€Followerã€Observer)\n\n**Leader**\n\n* å¤„ç†è·Ÿäº‹åŠ¡ç›¸å…³çš„æ“ä½œ(å¢ã€åˆ ã€æ”¹)\n* å°†æ¶ˆæ¯åŒæ­¥åˆ°æ——ä¸‹çš„Follower\n* é›†ç¾¤å†…éƒ¨å„æœåŠ¡å™¨çš„è°ƒåº¦è€…åŒæ—¶ä¿è¯äº‹åŠ¡å¤„ç†çš„é¡ºåºæ€§\n\n**Follower**\n\n* å°†è·Ÿäº‹åŠ¡å¤„ç†ç›¸å…³çš„æ“ä½œè½¬å‘åˆ°å…¶å¯¹åº”çš„Leader\n* å‚ä¸äº‹åŠ¡è¯·æ±‚PropsalæŠ•ç¥¨(å› ä¸ºåœ¨åŒæ­¥æ¶ˆæ¯æ—¶ï¼Œåªæœ‰å¤§å¤š*æ•°Followeréƒ½äº‹åŠ¡æäº¤æˆåŠŸï¼Œè¯¥æ¬¡æäº¤æ‰ç®—æˆåŠŸï¼Œå¦åˆ™è¿›è¡Œå›æ»š)\n* å‚ä¸Leaderçš„é€‰ä¸¾\n\n**Observer**\n\nä»…ä½œä¸ºè§‚å¯Ÿè€…ï¼Œè§‚å¯ŸZooKeeperä¸­é›†ç¾¤çš„æœ€æ–°çŠ¶æ€å¹¶ä¸”æŠŠé›†ç¾¤çš„æœ€æ–°çŠ¶æ€æ›´æ–°åˆ°Observerä¸­ï¼Œå®ƒä¸å‚ä¸PropsalæŠ•ç¥¨ä¹Ÿä¸å‚ä¸é€‰ä¸¾ï¼Œåªæ˜¯åœ¨ä¸€æ—é™é™çš„åœ¨ä¸å½±å“äº‹åŠ¡æ€§èƒ½çš„æƒ…å†µä¸‹æå‡éäº‹åŠ¡å¤„ç†çš„èƒ½åŠ›ã€‚\n\nåœ¨æ˜ç™½äº†è¿™äº›é—®é¢˜äº†åï¼Œæ¥èŠèŠä¸ºä»€ä¹ˆéœ€è¦é€‰æ‹©Leaderï¼Ÿåœ¨ææ¸…æ¥šè¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å†å›å½’åˆ°æœ¬æºï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ï¼Ÿå‡å¦‚æˆ‘ä»¬ä½¿ç”¨äº†ZooKeeperæŠŠå®ƒç”¨ä½œæˆ‘ä»¬çš„æ³¨å†Œä¸­å¿ƒ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43mo2zblj20m60i2mzn.jpg)\n\nåœ¨æœ‰å¾ˆå¤šä¸ªæœåŠ¡éƒ½æ³¨å†Œåœ¨ZooKeeperä¸Šï¼Œé‚£æˆ‘ä»¬è¦å¦‚ä½•ä¿éšœå…¶é«˜å¯ç”¨å‘¢ï¼Ÿæœ€ç®€å•å’Œæœ‰æ•ˆçš„åŠæ³•é‚£ä¾¿æ˜¯åšé›†ç¾¤ï¼Œä¸€æ—¦æˆ‘ä»¬åšäº†é›†ç¾¤ï¼Œé‚£ä¹ˆé¦–å…ˆè§£å†³çš„é—®é¢˜å°±æ˜¯å•ç‚¹æ•…éšœçš„é—®é¢˜ï¼Œä¸ä¼šå› ä¸ºä¸€å°æœºå™¨çš„å®•æœºä»è€Œå¯¼è‡´æ‰€æœ‰ä¾èµ–ZooKeeperçš„æœåŠ¡éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä»è€Œå†ä»é›†ç¾¤çš„è¿™ä¸ªå®ç°ä¸­åˆ†æ‘Šäº†æ¥è‡ªå„æœåŠ¡çš„æµé‡ï¼Œä»è€Œæå‡äº†æ€§èƒ½ã€‚\n\né‚£ä»ä¸Šé¢çš„ç‚¹å‡ºå‘ï¼Œçœ‹æˆ‘ä»¬è¦ä¸€ä¸ªé«˜æ€§èƒ½é«˜å¯ç”¨çš„é›†ç¾¤ï¼Œé‚£ä¹ˆZooKeeperæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Œå¾ˆç®€å•å®ƒç›´æ¥åŒ–ç¹è‡³ç®€ï¼Œåœ¨ZooKeeperè¿™ç§åˆ†å¸ƒå¼åè°ƒæœåŠ¡å…¶è‡ªèº«åˆéœ€è¦å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆé¦–å…ˆå°±è¦ä¿éšœé›†ç¾¤ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆè¦æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½å†™å…¥æ•°æ®ï¼Œé‚£ä¹ˆä¸ºäº†è¾¾åˆ°æ•°æ®ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯éƒ½è¦é€šçŸ¥å„ä¸ªæœåŠ¡å™¨å»åŒæ­¥è¿™ä¸ªèŠ‚ç‚¹æ›´æ–°äº†çš„æ•°æ®ï¼Œå•å•æ˜¯è¿™ä¸€æ­¥å°±å·²ç»å¾ˆéº»çƒ¦äº†ï¼Œè¿˜è¦å¯¹æ›´æ–°ä¸æˆåŠŸçš„èŠ‚ç‚¹è¿›è¡Œé‡æ–°æ›´æ–°ç­‰ï¼Œæ•´ä¸ªäº‹æƒ…çš„å¤æ‚åº¦å°±å˜å¾—å¾ˆé«˜äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å®šä¹‰ä¸€ä¸ªLeaderèŠ‚ç‚¹ï¼Œå°†æ‰€æœ‰çš„äº‹åŠ¡èŠ‚ç‚¹éƒ½è½¬å‘åˆ°LeaderèŠ‚ç‚¹ä¸Šæ¥å¤„ç†ï¼Œé€šè¿‡LeaderèŠ‚ç‚¹æ¥ä¸‹å‘äº‹åŠ¡ç»™å„ä¸ªFollowerèŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œæ‰€æœ‰çš„éäº‹åŠ¡è¯·æ±‚ä»»ä½•èŠ‚ç‚¹æ¥æ”¶åˆ°éƒ½å¯ä»¥è‡ªè¡Œå¤„ç†æ‰ï¼Œæ•´ä¸ªäº‹æƒ…å°±å˜å¾—ç®€å•èµ·æ¥äº†ï¼Œä½†LeaderèŠ‚ç‚¹ä¸€æ—¦å®•æœºæŒ‚æ‰åï¼Œè¿™äº›FollowerèŠ‚ç‚¹ä¹Ÿä¼šç«‹é©¬é€‰ä¸¾ä¸€ä¸ªLeaderèŠ‚ç‚¹å‡ºæ¥ç»§ç»­å¹²LeaderèŠ‚ç‚¹çš„äº‹æƒ…ï¼Œé‚£ä¹ˆæ˜¯å¦‚ä½•é€‰ä¸¾Leaderçš„å‘¢ï¼Ÿå¦‚æœæœ‰åä¸ªäº‹åŠ¡ï¼ŒLeaderèŠ‚ç‚¹å¤„ç†åˆ°ä¸€åŠè¿˜å‰©äº”ä¸ªäº‹åŠ¡æœªå¤„ç†ï¼Œæ–°é€‰ä¸¾å‡ºæ¥çš„Leaderåˆæ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿæ—§çš„Leaderä¸Šçº¿åå¯¹è‡ªèº«æœªå®Œæˆçš„äº‹åŠ¡åˆè¯¥ä½•å»ä½•ä»å‘¢ï¼Ÿè·Ÿç€æˆ‘çš„æ€è·¯ï¼Œçœ‹ä¸‹ä¸€ä¸ªå°èŠ‚\n\n## å¦‚ä½•é€‰ä¸¾Leaderçš„åŠä½¿ç”¨ä»€ä¹ˆæœºåˆ¶è¾¾åˆ°æ•°æ®ä¸€è‡´æ€§\n\näº†è§£è¿™ä¸ªé—®é¢˜ä¹‹å‰å…ˆäº†è§£ä¸€ä»¶äº‹æƒ…ï¼Œé€šå¸¸ZooKeeperéƒ½æ˜¯ç”±2n + 1å°Serverç»„æˆï¼Œå¯¹äº2n+1å°Serveråªè¦æœ‰n+1å°Serverå¯ç”¨ï¼Œé‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿå°±ä¿æŒå¯ç”¨ï¼Œæ€ä¹ˆç†è§£è¿™ä¸ªæ¦‚å¿µå‘¢ï¼Ÿå°±æ˜¯è¿‡åŠçš„æ„æ€ç†è§£å§ï¼Ÿå¦‚æœæœ‰3å°æœºå™¨ç»„æˆçš„é›†ç¾¤å…¶æŒ‚æ‰1å°è¿˜å‰©2å°ä»»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå¦‚æœæœ‰5å°æœºå™¨çš„é›†ç¾¤èƒ½å¤Ÿåœ¨å¯¹2å°æœºå™¨æŒ‚æ‰çš„æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸å·¥ä½œå¹¶ä¸”åšå‡ºç›¸åº”çš„å®¹ç¾å¤„ç†ï¼Œåæ­£è¿‡åŠå°±å¯¹äº†ï¼Œä¹‹æ‰€ä»¥è¦æ»¡è¶³ä¸€ä¸ªè¿™æ ·çš„é›†ç¾¤æ˜¯å› ä¸ºå…¶é›†ç¾¤ä¸­ä¼šæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šæˆä¸ºè¯¥é›†ç¾¤ä¸­çš„Leaderéœ€è¦æœ‰è¶…è¿‡è¯¥é›†ç¾¤è¿‡åŠæ•°çš„èŠ‚ç‚¹æ”¯æŒï¼Œæœ‰äº†è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥çš„æ¥ç†è§£ä¸‹æ˜¯å¦‚ä½•é€‰ä¸¾Leaderçš„ã€‚\n\nè¿™é‡Œå¯ä»¥å¾ˆç®€å•çš„æè¿°ï¼Œä½†ä½ ä¸ä¸€å®šèƒ½çœ‹æ‡‚ï¼Œä½†æ²¡å…³ç³»è·Ÿç€æˆ‘çš„èŠ‚å¥ä½ è‚¯å®šèƒ½çœ‹æ‡‚ï¼ŒZooKeeperçš„é€‰ä¸¾é€šå¸¸æƒ…å†µç”±\n\n* zxid\n* myid\n\næ¥å†³å®šè°æ˜¯Leaderï¼Œé‚£ä¹ˆè¿™é‡Œåˆä¼šç–‘é—®ä»€ä¹ˆæ˜¯zxidä»€ä¹ˆæ˜¯myid?\n\n**zxid**\n\nzxidæ˜¯ä¸€ä¸ª64ä½çš„æœ‰è§„åˆ™ç¼–å·ï¼Œå…¶é«˜çš„32ä½æ˜¯epochç¼–å·ï¼Œå…¶ä½çš„32ä½æ˜¯æ¶ˆæ¯è®¡æ•°å™¨ï¼Œæ²¡æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯è®¡æ•°å™¨å°±ä¼šç´¯åŠ åŠ 1ï¼Œä½†è¿™é‡Œå¥‡æ€ªçš„æ˜¯ä»€ä¹ˆæ˜¯epochç¼–å·ï¼Œepochç¼–å·ç†è§£èµ·æ¥å¹¶ä¸éš¾ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯æ¯ä¸€è½®æŠ•ç¥¨é€‰ä¸¾Leaderéƒ½ä¼š+1çš„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯åœ¨æ¯å°èŠ‚ç‚¹æœºå™¨çš„`/tmp/zookeeper/acceptedEpoch`æ–‡ä»¶æ¥æŸ¥çœ‹å½“å‰epochæ˜¯å‡ ï¼Œä¸€ä¸ªepochå°±æ˜¯ä¸€ä¸ªç‹çš„ä¸Šä»»\n\n**myid**\n\nçœ‹è¿‡ä¸Šä¸€ç¯‡çš„myidæ˜¯ä»€ä¹ˆè¿˜è¦è§£é‡Šå—ï¼Ÿæ²¡çœ‹è¿‡çš„èµ¶å¿«å»çœ‹\n\næ¥ä¸‹æ¥è¯´ä¸€ä¸‹å…¶é€‰ä¸¾æœºåˆ¶ï¼Œé¦–å…ˆæ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨çš„çŠ¶æ€éƒ½æ˜¯LOOKINGçŠ¶æ€ï¼Œå¤„äºè§‚æœ›çŠ¶æ€ï¼Œç„¶åå…¶å†…éƒ¨å¼€å§‹æ‰§è¡Œé€‰ä¸¾ï¼Œæ¯ä¸ªServeréƒ½ä¼šå‘èŠ‚ç‚¹ä¹‹é—´äº’ç›¸å¹¿æ’­æŠ•ç¥¨ï¼Œæ¯æ¬¡æŠ•ç¥¨ä¿¡æ¯éƒ½ä¼šåŒ…å«æ‰€æ¨ä¸¾çš„æœåŠ¡å™¨çš„myidå’Œzxidï¼Œå®é™…ä¸Šåˆšå¯åŠ¨å¤§å®¶æ¨çš„éƒ½æ˜¯è‡ªå·±ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ (myid, zxid)æ¥è¡¨ç¤ºï¼ŒServer1æŠ•å‡ºå»çš„ä¿¡æ¯(1, 0)ã€Server2æŠ•å‡ºå»çš„ä¿¡æ¯(2, 0),é¦–å…ˆä¼šæ ¹æ®ZXIDæ¥é€‰ä¸¾è°æ˜¯LeaderèŠ‚ç‚¹å¯ä»¥çœ‹åˆ°2è€…çš„zxidéƒ½ä¸º0é‚£ä¹ˆæ¥ç€æ¯”è¾ƒå…¶myidï¼ŒServer2çš„myidè¦æ¯”server1çš„å¤§é‚£ä¹ˆåº”è¯¥æ˜¯æŠ•ç»™server2æ¥åšLeaderèŠ‚ç‚¹ï¼Œé‚£ä¹ˆç»è¿‡è¿™ä¸€æ­¥åå¼€å§‹ç»Ÿè®¡æŠ•ç¥¨é›†ç¾¤ä¸­çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œåªè¦æ ¹æ®è¯¥æ­¥éª¤é€‰ä¸¾æŠ•ç¥¨å¤§äºè¿‡åŠçš„æœºå™¨æ—¶æ­¤æ—¶ä¾¿è®¤ä¸ºå·²ç»é€‰ä¸¾å‡ºLeaderï¼Œå³åˆ»æ”¹å˜é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„çŠ¶æ€æ˜¯Followeréƒ½å°±æ›´æ–°è‡ªå·±çš„èŠ‚ç‚¹ä¸ºFollowingï¼Œæ˜¯Leaderå°±æ›´æ–°è‡ªå·±çš„çŠ¶æ€ä¸ºLeading\n\nä¸Šé¢ç®€å•çš„è¯´äº†ä¸‹é€‰ä¸¾æœºåˆ¶ä½†æœ‰æ²¡æœ‰è€ƒè™‘è¿‡ï¼Œå¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­Leaderçªç„¶æŒ‚æ‰äº†ï¼ŸLeaderæ˜¯å¦‚ä½•é‡æ–°è¿›è¡Œé€‰ä¸¾çš„ï¼Ÿ\n\nè¯´è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬è¦æ¥äº†è§£ä¸‹ZABåè®®ï¼ŒZAB(ZooKeeper Atomic Broadcast)æ˜¯ä¸€ç§ä¸“é—¨ä¸ºZooKeeperè®¾è®¡çš„åŸå­å¹¿æ’­åè®®ï¼Œç”¨å…¶ä¿è¯åœ¨åˆ†å¸ƒå¼æ•°æ®ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œè¯¥åè®®æœ‰2ç§æœ€åŸºæœ¬çš„æ¨¡å¼åˆ†åˆ«ä¸ºï¼šå´©æºƒæ¢å¤ã€åŸå­å¹¿æ’­ã€‚\n\nå½“é›†ç¾¤åˆšå¯åŠ¨æˆ–è€…LeaderèŠ‚ç‚¹å®•æœºæ—¶æ•´ä¸ªé›†ç¾¤å°±ä¼šè¿›å…¥ä¸€ä¸ªæ¢å¤æ¨¡å¼æ¥é€‰ä¸¾ä¸€ä¸ªLeaderï¼Œå½“æœ‰è¿‡åŠçš„æœºå™¨ä¸è¯¥LeaderèŠ‚ç‚¹è¿æ¥å¹¶ä¸”å®Œæˆæ•°æ®åŒæ­¥æ—¶åŸºäºZABåè®®å°±ä¼šé€€å‡ºæ¢å¤æ¨¡å¼ï¼Œå½“æœ‰è¿‡åŠçš„FollowerèŠ‚ç‚¹å®Œæˆäº†å’ŒLeaderèŠ‚ç‚¹çš„æ•°æ®åŒæ­¥åï¼Œæ•´ä¸ªé›†ç¾¤å°±è¿›å…¥äº†æ¶ˆæ¯å¹¿æ’­æ¨¡å¼ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå®Œæ•´çš„é›†ç¾¤ä¸­å†æ·»åŠ äº†ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥ç´§æ€¥æ¨¡å¼ï¼Œé€šè¿‡å®Œæˆä¸Leaderçš„åŒæ­¥åï¼Œå†åº¦è½¬ä¸ºæ¶ˆæ¯å¹¿æ’­æ¨¡å¼ã€‚\n\n**åŸå­å¹¿æ’­**\n\nZooKeeperçš„åŸå­å¹¿æ’­å®é™…ä¸Šæ˜¯åŸºäºä¸€ä¸ªç®€åŒ–ç‰ˆçš„2PCæäº¤è¿‡ç¨‹ï¼Œç†Ÿæ‚‰åˆ†å¸ƒå¼äº‹åŠ¡çš„åº”è¯¥äº†è§£2PCï¼Œæˆ‘è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»ä»€ä¹ˆæ˜¯2PCäº†ï¼Œç­‰å“ªå¤©æˆ‘å¯èƒ½ä¼šå¿ƒè¡€æ¥æ½®å†™ä¸€ç¯‡åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„æ–‡ç« æ—¶ï¼Œå†å¥½å¥½ä»‹ç»ä»€ä¹ˆæ˜¯2PCä»€ä¹ˆæ˜¯3PCå§~\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43o4onujj21640h4wka.jpg)\n\næ ¹æ®æˆ‘ç”»çš„å›¾ï¼Œæˆ‘åœ¨æ–‡å­—è¯¦è¿°ä¸€é\n1.Leaderæ¥æ”¶åˆ°äº‹åŠ¡æ—¶é¦–å…ˆä¼šå¯¹è¯¥äº‹åŠ¡ç”Ÿæˆä¸€ä¸ªzxid(éƒ½è¿˜è®°å¾—è¿™ä¸ªæ˜¯å•¥å§ï¼Ÿ)\n2.åœ¨Leaderä¸­æœ‰ä¸€ä¸ªFIFOé˜Ÿåˆ—ä¸“é—¨ç”¨æ¥å­˜æ”¾proposalï¼Œè¿™ä¸ªproposalå®é™…ä¸Šå°±æ˜¯å°†å¸¦æœ‰zxidçš„æ¶ˆæ¯å°è£…æˆä¸€ä¸ªproposalï¼Œåœ¨ä½¿ç”¨FIFOé˜Ÿåˆ—è¿›è¡Œæœ‰åºåˆ†å‘ã€‚\n3.åœ¨Followeræ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå¯¹è¯¥proposalå†™å…¥ç£ç›˜ï¼Œç„¶åä¼šæœåŠ¡å™¨è¿”å›ä¸€ä¸ªç»“æœACK\n4.æœåŠ¡å™¨æ”¶åˆ°è¿‡åŠçš„æˆåŠŸACKæ—¶ï¼Œå°±ä¼šå¯¹Followerå‘é€commitæŒ‡ä»¤ï¼ŒåŒæ—¶æœ¬åœ°ä¹Ÿä¼šæ‰§è¡Œ\n5.å½“Followeræ”¶åˆ°commitæŒ‡ä»¤åï¼Œæ‰§è¡Œcommit\n\n**å´©æºƒæ¢å¤**\n\nä¸€æ—¦æœ‰LeaderèŠ‚ç‚¹å®•æœºæˆ–è€…LeaderèŠ‚ç‚¹å¤±å»äº†å¤§åŠFollowerèŠ‚ç‚¹çš„è¿æ¥ï¼Œå¯èƒ½å› ä¸ºç½‘ç»œæ³¢åŠ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„Leaderå°±ä¸å†æ˜¯ä¸€ä¸ªåˆæ³•çš„Leaderï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼ï¼Œåœ¨ZABåè®®ä¸­ä¸ºäº†ä¿éšœæ­£ç¡®æ€§ï¼Œæ•´ä¸ªæ¢å¤è¿‡ç¨‹ç»“æŸåéœ€è¦é€‰ä¸¾ä¸€ä¸ªæ–°çš„Leaderï¼Œä¸ºäº†ä½¿å¾—å´©æºƒåè¿˜èƒ½é€‰ä¸¾å‡ºæ–°çš„Leaderæ¥è¿›è¡Œæ­£å¸¸å·¥ä½œé¦–å…ˆè¦ä¿è¯2ä»¶äº‹\n\n* å·²ç»è¢«å¤„ç†çš„äº‹åŠ¡ä¸èƒ½ä¸¢å¤±\n* è¿‡æ—¶çš„äº‹åŠ¡ä¸èƒ½å†å‡ºç°\n\n*å·²ç»è¢«å¤„ç†çš„äº‹åŠ¡ä¸èƒ½ä¸¢å¤±*\næ€ä¹ˆç†è§£å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæ ¹æ®åŸå­å¹¿æ’­Leaderæ”¶åˆ°ACKåä¼šå¯¹FollowerèŠ‚ç‚¹å‘å‡ºcommitæŒ‡ä»¤ï¼Œå½“è¿™ä¸ªæŒ‡ä»¤æŒ‡å‘äº†ä¸€å°æœºå™¨å‘é€è¿˜æœªå‘å…¶å®ƒæœºå™¨å‘é€ï¼Œè‡ªå·±å°±æŒ‚äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡å·²ç»å‘é€ç»™äº†ä¸€ä¸ªèŠ‚ç‚¹commitå°±ä»£è¡¨å·²ç»è¢«å¤„ç†è¿‡äº†\n\n*è¿‡æ—¶çš„äº‹åŠ¡ä¸èƒ½å†å‡ºç°*\nå°±æ¯”å¦‚æˆ‘LeaderèŠ‚ç‚¹ç›®å‰æ¥æ”¶äº†10ä¸ªäº‹åŠ¡ï¼Œç”Ÿæˆäº†10ä¸ªproposalï¼Œå½“è¿˜æ²¡æœ‰å‘é€å°±å·²ç»æŒ‚äº†ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¸€ä¸ªfolloweræ¥æ”¶åˆ°äº†è¯¥äº‹åŠ¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥å´©æºƒæ¢å¤æ¨¡å¼ï¼Œé€‰ä¸¾å‡ºæ–°çš„Leaderï¼Œå½“è¿™å°è€Leaderæ¢å¤äº†ï¼Œè¿æ¥ä¸Šäº†å®ƒä¹Ÿåªèƒ½åšä¸€ä¸ªFollowerèŠ‚ç‚¹ï¼Œå…¶è‡ªèº«æ²¡æœ‰å¤„ç†è¿‡çš„äº‹åŠ¡ä¹Ÿåº”è¯¥è§†ä¸ºè¿‡æ—¶åº”è¯¥è¿›è¡Œä¸¢å¼ƒ\n\n\né‚£ä¹ˆè¿™é‡Œå°±å¾ˆçµæ€§äº†ï¼Ÿæƒ³æƒ³é€‰ä¸¾æœºåˆ¶å´©æºƒåå¦‚ä½•é€‰ä¸¾æ–°çš„Leaderï¼Ÿå¦‚æœæœ‰èŠ‚ç‚¹æ‰§è¡Œäº†commité‚£ä¹ˆå®ƒçš„zxidæ˜¯ä¸æ˜¯æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè¿™äº›æ‰§è¡Œäº†commitçš„èŠ‚ç‚¹å°±æ˜¯ææœ‰å¯èƒ½æ˜¯leaderèŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰ä¸€å°æ‰§è¡Œäº†commitï¼Œä¸å‡ºå…¶å®ƒç‰›è§’å°–çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯Leaderï¼Œå› ä¸ºå®ƒæ˜¯æœ€æ–°çš„å˜›ï¼\n\n## ç®€å•çœ‹ä¸‹ZooKeeperé€‰ä¸¾æºç \né¦–å…ˆæˆ‘ä»¬ä»ä¸€ä¸ªå…·æœ‰mainå‡½æ•°çš„`QuorumPeerMain`ç±»å¼€å§‹ï¼Œæˆ‘ä»¬å°±ä»¥å®ƒä¸ºå…¥å£å§\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43oqozi2j20ys0lk0y6.jpg)\n\nä¼šå‘ç°ä»–åˆ›å»ºäº†ä¸€ä¸ª`QuorumPeerMain`çš„å®ä¾‹å¹¶æ‰§è¡Œäº†å…¶`initializeAndRun`æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43p8jutjj210g0lqjvs.jpg)\n\nå¦‚æœæ˜¯é›†ç¾¤å°±ä¼šæ‰§è¡Œ`runFromConfig`è¿™ä¸ªæ–¹æ³•é‡Œåšäº†ä¸€å †é…ç½®ï¼Œç®€å•çœ‹ä¸‹ä¸ç”¨å¤ªè¿‡å…³å¿ƒï¼Œé‡ç‚¹ä¸æ˜¯è¿™ï¼Œæ¥ç€ç»§ç»­çœ‹ï¼Œå¯ä»¥çœ‹åˆ°å®ƒè°ƒç”¨äº†ä¸€ä¸ª`start`æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43pk72t8j20j40703zd.jpg)\n\n`loadDataBase`å°±æ¢å¤å…¶è‡ªèº«æ•°æ®åº“å…¶å®å°±æ˜¯ä»æœ¬åœ°æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ï¼Œç„¶åè·å–æœ€æ–°çš„zxidï¼Œå…³é”®æ˜¯è¿™é‡Œçš„`startLeaderElection`çœ‹åˆ°è¿™ä¸ªæ–¹æ³•åï¼Œå°±çŸ¥é“äº†å§ï¼Ÿåœ¨è¿™é‡Œå¼€å§‹é€‰ä¸¾æƒ¹~\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43pswdafj210w0r0gr0.jpg)\n\nè¿™é‡Œä¼šè·å–è‡ªèº«çš„`myid`å’Œ`zxid`è¿˜æœ‰`epoch`å°è£…æˆ`Vote`å®ä¾‹ï¼Œé¡¾åæ€ä¹‰å§ï¼Ÿå…ˆå°†è‡ªå·±çš„æŠ•ç¥¨è®¾ç½®æˆè‡ªå·±çš„å†è¯´ï¼Œå…³é”®æœ€åä¸€æ­¥ï¼Œåˆ›å»ºé€‰ä¸¾ç®—æ³•ï¼Œè·Ÿç€æ¥çœ‹çœ‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43q22vs3j211a0sujw9.jpg)\n\né»˜è®¤ä»configä¸­è¯»å–å‡ºçš„æ˜¯3ï¼Œå¯ä»¥åœ¨`runFromConfig`ä¸­çœ‹åˆ°ç›¸å…³é…ç½®ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª`QuorumCnxManager`çš„å®ä¾‹ï¼Œè¯¥ç±»ä¸»è¦è´Ÿè´£Leaderé€‰ä¸¾çš„IOï¼Œç„¶åå¯åŠ¨å·²ç»‘å®šç«¯å£çš„é€‰ä¸¾ç›‘å¬ç°åœºï¼Œç­‰å¾…å…¶ä»–æœºå™¨è¿›è¡Œè¿æ¥ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª`FastLeaderElection`å®ä¾‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43qbm6v3j20yw054t9k.jpg)\n\nå…³é”®çœ‹`starter`æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43qk33yaj20xu08a0ul.jpg)\n\né‡Œé¢åˆ›å»ºäº†2ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—å’Œä¸€ä¸ªå‘é€é˜Ÿåˆ—ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª`Messenger`å®ä¾‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43qsjbq0j210c0g2ju4.jpg)\n\nè¯¥æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†å‘é€é˜Ÿåˆ—å’Œæ¥æ”¶é˜Ÿåˆ—çš„çº¿ç¨‹ï¼Œå¹¶å¯åŠ¨çº¿ç¨‹ï¼ŒWorkSenderæ˜¯è´Ÿè´£å‘é€æŠ•ç¥¨çš„ï¼ŒWorkerReceiveræ˜¯è´Ÿè´£æ¥æ”¶æŠ•ç¥¨çš„ï¼Œå†å›åˆ°`start`æ¥\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43r0yu2xj20hs06qmxy.jpg)\n\nè¿˜å‘ç°å…¶è°ƒç”¨äº†çˆ¶ç±»çš„`start`æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ç›´æ¥çœ‹å®ƒçš„`run`æ–¹æ³•ä¸å°±å¥½äº†å˜›ï¼Œè¿™ä¸å°±æ˜¯è¦†ç›–äº†ä¸‹`Thread`çš„`start`å˜›ï¼Ÿ\nç›´æ¥çœ‹`run`æ–¹æ³•çš„å…³é”®ç‚¹ï¼Œçœ‹å“ªé‡Œè¿˜è¦æˆ‘è§£é‡Šå—ï¼Ÿå½“ç„¶æ˜¯`LOOKING`çŠ¶æ€äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªè§‚æœ›çŠ¶æ€\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43rki721j20ph1c1qjn.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43rscapcj20xe068wfa.jpg)\n\né‡ç‚¹æ˜¯è¿™é‡Œé€šè¿‡makeLESStrategy()æ¥é€‰ç”¨ä¸€ä¸ªé€‰ä¸¾ç®—æ³•è¿›è¡ŒLeaderé€‰ä¸¾ï¼Œæ¥ç€çœ‹lookForLeader\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43s20sfej213c0be0wl.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43s6u6zvj20yi0ng43i.jpg)\n\nè¿™2ä¸ªä¸€ä¸ªæ˜¯ç”¨æ¥å­˜æ”¾æ”¶åˆ°çš„æŠ•ç¥¨ä¸€ä¸ªæ˜¯å­˜å‚¨é€‰ä¸¾ç»“æœçš„\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43sfj63zj20ya04oq3k.jpg)\n\né€»è¾‘é”+1ï¼Œå¹¶ä¸”æ›´æ–°è‡ªå·±çš„zxidå’Œepoch\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43so9ecij20zy02igly.jpg)\n\nä¸€ç›´å¾ªç¯åˆ°é€‰å‡ºLeader\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43svou0aj20ny04kdg8.jpg)\n\nä»æ¥æ”¶é˜Ÿåˆ—ä¸­æ‹¿æŠ•ç¥¨ä¿¡æ¯\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43t5u82fj20sc0ectaw.jpg)\n\nå¦‚æœé˜Ÿåˆ—æ‹¿å‡ºæ¥çš„ä¸ºç©ºï¼Œé‚£å°±æ˜¯å‘å®Œäº†ï¼Œç»§ç»­å‘é€ä¸€ç›´åˆ°é€‰å‡ºleader\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43tdoy9qj20ts02i0t0.jpg)\n\næ”¶åˆ°æŠ•ç¥¨ç¡®è®¤æ˜¯å¦æ˜¯æœ¬é›†ç¾¤ä¸­çš„nodeæŠ•ç¥¨\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43tm6vprj20vi0dkjud.jpg)\n\nå¦‚æœæ”¶åˆ°çš„èŠ‚ç‚¹epochå¤§äºlogicallockåˆ™è¡¨ç¤ºå½“å‰æ˜¯ä¸€è½®æ–°çš„é€‰ä¸¾\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43u9482ej20v407mabj.jpg)\n\næ‹¿è‡ªå·±çš„ç¥¨å’Œæ”¶åˆ°çš„ç¥¨PKä¸€æ³¢\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43uvg35bj211i040t97.jpg)\n\nå…ˆåˆ¤æ–­epochæ˜¯ä¸æ˜¯æ¯”å½“å‰çš„å¤§ï¼Œå¦‚æœæ˜¯æ¯”å½“å‰çš„å¤§ï¼Œé‚£ä¹ˆæˆ‘è¿™ä¸ªå°±æ˜¯æ—§çš„ï¼Œå› ä¸ºæ¯ä¸€è½®é€‰ä¸¾åéƒ½ä¼šepoch+1é‚£ä¹ˆåˆ™æ˜¯å¯¹æ–¹çš„å¤§ï¼Œé‚£ä¹ˆå¯¹æ–¹èƒœå‡ºï¼Œå¯¹æ–¹æ˜¯leaderï¼Œå¦‚æœepochç›¸ç­‰é‚£ä¹ˆå°±åˆ¤æ–­zxidï¼Œå¦‚æœå¯¹æ–¹çš„zxidå¤§ï¼Œé‚£ä¹ˆå¯¹æ–¹èƒœå‡ºå¯¹æ–¹æ˜¯leaderï¼Œå¦‚æœ epochå’Œzxidéƒ½ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±åˆ¤æ–­myidï¼Œè°å¤§è°èƒœå‡ºè°æ˜¯å®ƒè®¤å¯çš„Leader\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43v6owcyj20g20260sr.jpg)\n\nç„¶åå‘é€å¹¿æ’­æ¶ˆæ¯\n\nè¿‡å®Œé‚£ä¸€å †ifåï¼Œæ·»åŠ æœ¬æ¬¡æ”¶åˆ°çš„æŠ•ç¥¨çš„å¯¹è±¡ï¼Œç”¨æ¥é€‰ä¸¾æ—¶çš„æœ€ç»ˆåˆ¤æ–­\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43vlcakxj210e02maac.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43vq4wtdj20ve0deq5a.jpg)\n\nè¿™é‡Œåˆ¤æ–­é€‰ä¸¾æ˜¯å¦ç»“æŸï¼Œé»˜è®¤ç®—æ³•å°±æ˜¯è¶…è¿‡åŠæ•°serveræŠ•ç¥¨é€šè¿‡ï¼Œè¿™é‡Œçš„`while`ç»“æŸä»¥å\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft43w1j59vj20s40eqdi1.jpg)\n\nç¡®å®šLeaderå’Œä¿®æ”¹è‡ªèº«çŠ¶æ€ï¼Œå³é€‰ä¸¾å®Œæ¯•\n\nå°±ä»‹ç»åˆ°è¿™é‡Œ~~~ æˆ‘æƒ³æƒ³æˆ‘ä¸‹ä¸€ç¯‡æ˜¯å†™ã€ŠZooKeeper Java API åŠ WacheråŸç†ã€‹è¿˜æ˜¯å†™Dubboã€‚\n\nå¦‚æœä½ è§‰å¾—ä½œè€…å†™çš„è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©æˆ–è€…æ”¶è·å¾ˆå¤§çš„è¯ï¼Œä½ å¯ä»¥å°è¯•ç€è¯·æˆ‘å–ä¸€ç“¶ã€Šä¸œæ–¹æ ‘å¶ã€‹æˆ–è€…åƒä¸€å—ã€Š\u001dé¸¡èƒ¸ã€‹æ¥æ¿€åŠ±æˆ‘ï¼ï¼ï¼\n\n**å¾®ä¿¡è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmntt0mzpj20yi1auaki.jpg)\n\n\n**æ”¯ä»˜å®è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnun44gdj20go0p00y2.jpg)","cover":"","link":"zookeeper_election_leader.html","preview":"\u003cp\u003eZooKeeperçš„ä¸€äº›åŸç†äº†è§£ä¸€ä¸‹ï¼Ÿ\u003c/p\u003e\n","title":"ZooKeeperçš„ä¸€äº›åŸç†äº†è§£ä¸€ä¸‹ï¼Ÿ"},{"content":"\n\nä¸å¤šå“”å“”å¤§çº²å…ˆè¡Œ\n\n* ZooKeeperæ˜¯å•¥\n* ZooKeeperå¦‚ä½•ä½¿ç”¨\n* ZooKeeperåˆ†å¸ƒå¼æ­å»º\n* ZooKeeperçš„åº”ç”¨åœºæ™¯\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13jhh8wij20fu08241j.jpg)\n\n\n## ZooKeeperæ˜¯å•¥\n\nZooKeeperæ˜¯ä¸€ç§åˆ†å¸ƒå¼åè°ƒæ¡†æ¶ï¼Œæœ€æ—©æ˜¯ç”±é›…è™çš„ä¸€ä¸ªç ”ç©¶å°ç»„æ‰€å¼€å‘ï¼Œæœ€æ—©æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼å•ç‚¹é—®é¢˜ï¼Œå› ä¸ºæŠ€æœ¯æ°›å›´å¾ˆå¤šé¡¹ç›®éƒ½æ˜¯ç”¨åŠ¨ç‰©å‘½åï¼Œæ­£å¥½ZooKeeperæ˜¯ç”¨äºåè°ƒåˆ†å¸ƒå¼åº”ç”¨å› æ­¤å¾—åâ€œåŠ¨ç‰©å›­ç®¡ç†å‘˜â€(è¯‘è¿‡æ¥æ˜¯è¿™æ ·å•Š~)ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼å•ç‚¹é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¦ä¸¾ä¸€ä¸ªç®€å•çš„æ¶æ„æ¼”æŠ€è¿›ä¾‹å­æ¥è¯´æ˜äº†ï¼ˆæ€•æœ‰é’»ç‰›è§’å°–çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ¶æ„æ¼”è¿›æ˜¯ä¸ºäº†å†™è¿™ç¯‡æ–‡ç« ï¼Œç¬”è€…è‡ªå·±æ ¹æ®ç›®å‰çš„çŸ¥è¯†æƒ³å‡ºæ¥çš„æ¼”è¿›ï¼Œæ‰€ä»¥æˆ‘çš„åœ°ç›˜å¬æˆ‘çš„ï¼Œä¸æ¥å—ä»»ä½•ç‰›è§’å°–ï¼‰ã€‚\n\né¦–å…ˆä»æœ€åŸå§‹çš„æœ€å¸¸è§çš„å•ä½“åº”ç”¨ã€‚\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13k53zbuj20su0j8dik.jpg)\nè¿™ä¸ªæ— éœ€è§£é‡Šå§\n\néšç€å¹¶å‘éœ€æ±‚è¶Šæ¥è¶Šå¤§ï¼Œä¸€ä¸ªé¡¶ä¸ä½äº†ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªæ¶æ„å†æ‰©å±•ä¸€ä¸‹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13kfqufoj212i0l8gq0.jpg)\n\næ¯æ¬¡æ‹“å±•åˆä»–å–µçš„è¦å¤šå¼€ä¸€ä¸ªæœåŠ¡å™¨ç„¶ååœ¨éƒ¨ç½²ä¸€å¥—å•†åŸï¼Œè€Œä¸”å¾ˆå¤šç³»ç»Ÿéƒ½èƒ½ç”¨åˆ°ç±»ä¼¼çš„æœåŠ¡ï¼Œéš¾ä»¥è¾¾åˆ°å¤ç”¨çš„æ•ˆæœï¼Œè€Œä¸”æ‰©å±•èµ·æ¥æ¯”è¾ƒè€—è´¹è´¢åŠ›ï¼Œä¸èƒ½é’ˆå¯¹æŸä¸€ä¸ªç‚¹æ¥è¿›è¡Œæ€§èƒ½çš„æ‰©å±•ï¼Œå®¹æ˜“é€ æˆæŸäº›æ–¹é¢çš„æµªè´¹ï¼Œä¾‹å¦‚ è®¢å•æ˜¯ä¸€ä¸ªé«˜å¹¶å‘ä½¿ç”¨ï¼Œè€Œé’±åŒ…æ˜¯ä¸€ä¸ªä½å¹¶å‘ï¼Œé‚£ä¹ˆè®²é“ç†æˆ‘åªæƒ³é’ˆå¯¹å¹¶å‘é«˜çš„è¿™ä¸ªæœåŠ¡è¿›è¡Œæ€§èƒ½çš„æ‰©å±•ï¼Œäºæ˜¯æˆ‘ä»¬å…ˆå°†å®ƒæ‹†æˆæœåŠ¡\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13kvb4ayj20h80jkq56.jpg)\n\næœåŠ¡æ‹†åˆ†å¥½äº†ä»¥åæˆ‘ä»¬å†æ¥æ‰©å±•ä¸€å“ˆ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13l6jplqj20k20kwn0c.jpg)\n\nOKï¼Œæ¼”è¿›å°±å…ˆåˆ°è¿™é‡Œï¼Œèˆå°æ­å»ºå¥½äº†ï¼Œæˆ‘ä»¬æ¥å‘ç°è¿™å…¶ä¸­çš„é—®é¢˜\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13lfuessj205i05cjs5.jpg)\n\né¦–å…ˆæ— è®ºæ˜¯æ°´å¹³æ‰©å±•è¿˜æ˜¯å‚ç›´æ‰©å±•ï¼Œæœ‰äº›è®¸é—®é¢˜(ä»¥æ°´å¹³æ‰©å±•æ¥è¯´ï¼Œå‚ç›´å·®ä¸å¤šæ„ä¼šåˆ°äº†å°±è¡Œ)è¿™é‡ŒæŒ‘å‡ ä¸ªé’ˆå¯¹çš„æ¥è¯´\n\n* å…±äº«èµ„æº\n* æœåŠ¡æ³¨å†Œ\n* è´Ÿè½½å‡è¡¡\n\nå…¶å®è¿™é‡Œå°±å·²ç»æŠŠåº”ç”¨åœºæ™¯è¯´äº†ï¼Œä½†è¿™é‡Œåªæè¿°ä¸‹é—®é¢˜ï¼Œåœ¨åº”ç”¨åœºæ™¯çš„é‚£ä¸€ä¸ªå°èŠ‚å†ç»§ç»­åˆ»ç”»ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„åè°ƒé—®é¢˜ï¼Œä¾‹å¦‚å…±äº«èµ„æºï¼Œæˆ‘å‡ åå‡ ç™¾ä¸ªè®¢å•æœåŠ¡è¦åŒæ—¶ä½¿ç”¨ä¸€ä¸ªå…±äº«èµ„æºï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›å¼€å…³ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çš„ä¸€äº›å¼€å…³é…ç½®å°±èƒ½è®©æˆ‘å‡ ç™¾å‡ åƒä¸ªæœåŠ¡åŒæ—¶æ‰“å¼€ï¼Œé€šè¿‡æœåŠ¡çš„æ³¨å†Œæ¥å®ç°æœåŠ¡çš„ç»Ÿä¸€åœ°å€ç®¡ç†ã€æœåŠ¡çš„ä¸Šä¸‹çº¿ç­‰ï¼Œè¯´åˆ°è¿™é‡Œåº”è¯¥è¦å¯¹ZooKeeperåˆ†å¸ƒå¼åè°ƒæœ‰ç‚¹æ„Ÿè§‰äº†ï¼ˆå¦‚æœè¿˜ä¸èƒ½ç†è§£å¯ä»¥åŠ å¾®ä¿¡å…±åŒæ¢è®¨ä¸€ä¸‹å§ï¼‰ï¼Œé‚£æˆ‘å°±èµ°è¿›ZooKeeperäº†\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13lunl9mj207b06vmye.jpg)\n\nå…ˆä»‹ç»ä¸€ä¸‹ZooKeeperçš„å­˜å‚¨ç»“æ„ï¼Œå®ƒæ˜¯ä»¥æ ‘å½¢ç»“æ„æ¥å­˜å‚¨ä½†æ¯ä¸ªNodeåˆéƒ½æ˜¯ä¸€ä¸ªKey-Valueï¼Œè¯´èµ·æ¥å¤ªæŠ½è±¡ï¼Œç”»ä¸ªå›¾\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13m23xvcj216m0pwjy0.jpg)\n\nè™šçº¿è¿æ¥çš„éƒ½æ˜¯å½“å‰èŠ‚ç‚¹çš„valueï¼Œå®çº¿è¿æ¥ä¹‹å¤„ä¾¿æ˜¯å…¶å­èŠ‚ç‚¹äº†ï¼Œè¿™äº›å­èŠ‚ç‚¹ä¹Ÿæœ‰ä¸€ä¸ªåå­—é‚£ä¾¿æ˜¯ZNode,è¿™ä¸‹å¯¹ZooKeeperæ˜¯ä¸ªä»€ä¹ˆä»¥åŠå­˜å‚¨ç»“æ„éƒ½æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£äº†ï¼Œæ¥ç€è¿›å…¥ä¸‹ä¸€ä¸ªå°èŠ‚\n\n\n## ZooKeeperå¦‚ä½•ä½¿ç”¨ï¼Ÿ\né¦–å…ˆè¯´ä¸€ä¸‹æˆ‘çš„ç¯å¢ƒ\n* CentOS7\n* OpenJDK8\n\nè¿™ä¾¿æ˜¯æˆ‘ä¾èµ–çš„ç¯å¢ƒäº†\nè‡ªè¡Œå»[Apache ZooKeeper](https://zookeeper.apache.org/)ä¸‹è½½ï¼Œç„¶åè§£å‹ï¼Œè¿›å…¥ç›®å½•\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13mlkktgj20uk0580u7.jpg)\n\né¦–å…ˆè¿›å…¥`conf`ç›®å½•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13mvs1cbj20l0022mxg.jpg)\n\nZooKeeperé»˜è®¤ä¼šè¯»å–`zoo.cfg`æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡ªå¸¦çš„`zoo_sample.cfg`æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª\n`cp zoo_sample.cfg zoo.cfg`ï¼Œè¿™é‡Œé¢å†™äº†ä»€ä¹ˆæˆ‘ä»¬æš‚æ—¶ä¸å…³å¿ƒï¼Œç­‰ä¼šç»†è®²ï¼Œç„¶åå›é€€ç›®å½•æ¥ç€è¿›å…¥`bin`ç›®å½•ä¸‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13neelq9j20rw02qq3g.jpg)\n\nå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹æœ‰å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶,é¦–å…ˆå¯åŠ¨ZooKeeper\n\n```\n./zkServer.sh start\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13nzeu6nj20nu03e0tf.jpg)\n\næ¥ç€ä½¿ç”¨æä¾›çš„å®¢æˆ·ç«¯ï¼Œè¿æ¥å®ƒ\n```\n./zkCli.sh\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13oe93z0j20va0kw444.jpg)\n\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œé»˜è®¤æœ‰å“ªäº›æ•°æ®\n\n```\nls /\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13oqpai4j20ik01ydg0.jpg)\nå¯ä»¥çœ‹åˆ°é»˜è®¤åªæœ‰ä¸€ä¸ªzookeeperèŠ‚ç‚¹ï¼Œæ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹\n```\ncreate /a a \nls /\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13p9cokwj20mk03q0t8.jpg)\n\næ¥ç€å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œæ¥ç€åœ¨ç»§ç»­ç»™å®ƒåˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹\n\n```\ncreate /a/aa aa\nls /a\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13pki1k5j20ke0663zh.jpg)\n\næ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œä»€ä¹ˆæ˜¯ä¸´æ—¶èŠ‚ç‚¹å‘¢ï¼Œä¸ºä»€ä¹ˆå«ä¸´æ—¶æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„å‘¢ï¼Ÿåªéœ€è¦è®°ä½2ç‚¹ï¼Œä¸´æ—¶èŠ‚ç‚¹åªåœ¨ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå½“è¿æ¥ä¼šè¯ç»“æŸååœ¨ä¸€ä¸ªå¿ƒè·³å‘¨æœŸåä¼šå°†å®ƒåˆ é™¤æ‰ï¼Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ä¸´æ—¶èŠ‚ç‚¹æ˜¯ä¸å¯ä»¥æœ‰å­èŠ‚ç‚¹çš„\n```\ncreate -e /temp temp\nls /\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13q0mlvgj20hc02cglu.jpg)\n\næ¥ç€æˆ‘ä»¬`ctrl + c`ç»“æŸå®¢æˆ·ç«¯æ§åˆ¶å°ï¼Œç­‰å¾…ä¸ªå‡ ç§’é’Ÿåœ¨ç»§ç»­è¿›è¡Œè¿æ¥\n\n```\n./zkCli.sh\nls /\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13q932cmj20jk020aa8.jpg)\n\næ¥ç€ä¸´æ—¶èŠ‚ç‚¹å°±å·²ç»æœ¨æœ‰äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹ï¼Œå°±æ˜¯æœ‰åºèŠ‚ç‚¹ï¼Œæœ‰åºèŠ‚ç‚¹ä¸éœ€è¦ä½ ç»™å®ƒæŒ‡å®šå®ƒçš„åºåˆ—ç¼–å·ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œä¾‹å¦‚\n```\ncreate -s /seq seq01\nls /\n```\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13qkp20hj20n803kwf4.jpg)\n\nä½ ä»¬çš„åº”è¯¥ä¼šæ˜¯ä»0å¼€å§‹ä¸ºä»€ä¹ˆæˆ‘çš„æ˜¯ä»4å¼€å§‹å‘¢ï¼Ÿå› ä¸ºæˆ‘ç”¨çš„Dockerè·‘çš„CentOSæŒ‚è½½äº†è™šæ‹Ÿå·QAQæ‰€ä»¥ä¹‹å‰çš„è®°å½•ä¹Ÿè¿˜æ˜¯åœ¨çš„ï¼Œæ— ä¼¤å¤§é›…ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œæ¥ç€ç»™å®ƒåˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹\n```\ncreate -s /seq0000000004/cs children01\nls /seq0000000004\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13qvvko1j20uw03u3z8.jpg)\n\nåˆ›å»ºè¯´å®Œäº†ï¼Œæ¥ç€å¦‚ä½•æŸ¥è¯¢ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯å‘¢ï¼Ÿä¾‹å¦‚æˆ‘ä»¬æŒ‡å®šçš„valueï¼Œå¾ˆç®€å•ä½¿ç”¨getå‘½ä»¤å³å¯\n\n```\nget /a\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13r4f95yj20k80asjsr.jpg)\n\nå¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸²ä¿¡æ¯ï¼Œåˆ†åˆ«ä»‹ç»ä¸‹\n\n```\n// è¿™ä¸ªåœ°æ–¹æ˜¯value\na\n// äº‹åŠ¡IDå·\ncZxid = 0xd\n// äº‹åŠ¡å‘ç”Ÿæ—¶é—´,ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆ›å»ºæ—¶é—´\nctime = Wed Jul 04 15:11:09 UTC 2018\n// æœ€åä¿®æ”¹çš„äº‹åŠ¡IDå·\nmZxid = 0xd\n// ä¿®æ”¹å‘ç”Ÿæ—¶é—´\nmtime = Wed Jul 04 15:11:09 UTC 2018\n// æ·»åŠ æˆ–è€…åˆ é™¤å­èŠ‚ç‚¹æ“ä½œçš„äº‹åŠ¡IDğŸ‘Œ\npZxid = 0xe\n// å½“å‰èŠ‚ç‚¹çš„ç‰ˆæœ¬å·\ncversion = 1\n// å½“å‰èŠ‚ç‚¹æ•°æ®çš„ç‰ˆæœ¬å·\ndataVersion = 0\n// ACLç‰ˆæœ¬å·\naclVersion = 0\n// è¿™ä¸ªé»˜è®¤éƒ½æ˜¯0ï¼Œåªæœ‰ä¸´æ—¶èŠ‚ç‚¹æœ‰ï¼Œå¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ä¸´æ—¶èŠ‚ç‚¹çš„ä¼šè¯ID\nephemeralOwner = 0x0\n// value é•¿åº¦\ndataLength = 1\n// æœ‰å¤šå°‘ä¸ªå­èŠ‚ç‚¹\nnumChildren = 1\n```\n\næŸ¥è¯¢è¯´å®Œäº†ï¼Œæ¥æˆ‘ä»¬æ¥è¯´ä¸‹å¦‚ä½•ä¿®æ”¹èŠ‚ç‚¹ï¼Œä¹Ÿå¾ˆç®€å•åˆ©ç”¨`set`å‘½ä»¤å³å¯\n\n```\nset /a aa\nget /a\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13rgksnhj20o80b075q.jpg)\n\nå¯ä»¥çœ‹åˆ°ä¿®æ”¹æ—¶é—´å’Œæ•°æ®ç‰ˆæœ¬è¿˜æœ‰valueéƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¦è®°å½•versionå‘¢ï¼Ÿå› ä¸ºZooKeeperé¢å¯¹å¹¶å‘å†™å…¥æƒ…å†µä¸‹é‡‡ç”¨çš„æ˜¯ä¹è§‚é”çš„æ¦‚å¿µã€‚\n\næ¥ç€è¯´ä¸€ä¸‹å¦‚ä½•åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ©ç”¨`delete`å‘½ä»¤ä½†æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯ï¼Œè¦åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå¦åˆ™ä½ å°±è¦å…ˆä»è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ èµ·\n```\ndelete /a\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13rqpupuj20lc024dg4.jpg)\n\nçœ‹ç›´æ¥å°±æç¤ºäº†ï¼Œè¯¥èŠ‚ç‚¹ä¸æ˜¯ç”¨ç©ºèŠ‚ç‚¹\n```\nls /a\ndelete /a/aa\ndelete /a\nls /\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13s02audj20lc04cq3u.jpg)\n\nå·²ç»åˆ é™¤æ‰äº†ï¼Œæ›´å¤šçš„å‘½ä»¤å¯ä»¥ä½¿ç”¨`help`æ¥æŸ¥è¯¢ï¼Œæ¥ç€æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹é›†ç¾¤ï¼Œä½†åœ¨é›†ç¾¤ä¹‹å‰ï¼Œå…ˆæ¥è¯´ä¸€ä¸‹é‚£ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿˜è®°å¾—ä¹‹å‰é‚£ä¸ª`zoo.cfg`å˜›ï¼Ÿæ¥ç€å…ˆè¯´è¯´å®ƒï¼Œæ‹¿å‡ ä¸ªé»˜è®¤çš„å‡ºæ¥è¯´è¯´\n\n```\n// å¿ƒè·³ç»´æŒæ—¶é—´ï¼Œæ¯ä¸ªtickTimeé—´éš”å°±ä¼šå‘é€ä¸€æ¬¡å¿ƒè·³\ntickTime=2000\n//é›†ç¾¤ä¸­flloweræœåŠ¡ä¸leaderæœåŠ¡å™¨ä¹‹é—´æœ€é•¿å¿ƒè·³æ—¶é—´ initLimit * tickTime\ninitLimit=10\n//é›†ç¾¤ä¸­leaderå’Œfllowerä¹‹é—´å‘é€æ¶ˆæ¯è¯·æ±‚å’Œåº”ç­”æœ€å¤§æ—¶é—´é•¿åº¦ syncLimit * tickTime\nsyncLimit=5\n// å®¢æˆ·ç«¯è¿æ¥ç«¯å£\nclientPort=2181\n// æ•°æ®å­˜æ”¾ç›®å½•\ndataDir=/tmp/zookeeper\n```\nOKï¼Œæ¥ç€è¯´è¯´ZooKeeperçš„é›†ç¾¤\n\n## åˆ†å¸ƒå¼æ­å»º\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13sl1opfj20p80j0tb9.jpg)\n\nè¿™ä¾¿æ˜¯ZooKeeperçš„é›†ç¾¤ç»“æ„äº†ï¼Œä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªè§’è‰²ï¼Œåˆ†åˆ«æ˜¯ Leaderã€Followerã€Observerï¼Œåœ¨ç†è§£è¿™äº›è§’è‰²ä¹‹å‰æˆ‘ä»¬è¦å…ˆçŸ¥é“ZooKeeperæ˜¯ä¾èµ–ZABåè®®æ¥å®ç°åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ç®—æ³•ï¼ŒZABç®—æ³•æ˜¯ä¸€ç§ä¸“é—¨ä¸ºZooKeeperè®¾è®¡çš„ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ï¼ŒåŸºäºè¯¥åè®®ZooKeeperå®ç°äº†ä¸€ç§ä¸»å¤‡æ¨¡å¼çš„æ¶æ„æ¥ä¿è¯åˆ†å¸ƒå¼ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæ‰€æœ‰çš„äº‹åŠ¡æ“ä½œ(ä¾‹å¦‚åˆ›å»ºå’Œä¿®æ”¹)éƒ½ä¼šäº¤ç»™Leaderæ¥å®ç°ï¼Œå…¶å®ƒçš„Followerä¹Ÿåªè´Ÿè´£è½¬å‘ï¼Œæ‰€æœ‰çš„éäº‹åŠ¡æ“ä½œè‡ªç„¶å°±äº¤ç»™Followeræ˜¯ä¸æ˜¯æœ‰ç‚¹åƒæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Ÿé‚£è¿™ä¸ªLeaderå’ŒFolloweræ˜¯æ€ä¹ˆé…ç½®å’Œè®¾å®šçš„ï¼Ÿè¿™ä¸ªä¸éœ€è¦è®¾å®šï¼ŒZooKeeperå¯¹ä¸»ä»æœ‰å‡ ç§é€‰ä¸¾æœºåˆ¶ï¼Œå°±ç®—åœ¨é›†ç¾¤ç¯å¢ƒä¸­LeaderèŠ‚ç‚¹æŒ‚äº†ä¹Ÿä¼šç«‹é©¬ä»FollowerèŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸€ä¸ªLeaderæ¥ï¼Œå…·ä½“çš„é€‰ä¸¾ç®—æ³•ï¼Œæˆ‘ç•™åœ¨ä¸‹ä¸€ç¯‡ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥èŠèŠZooKeeperçš„ä¸€äº›åŸç†ï¼Œæ¥ç€æ¥è¯´è¯´Observerè¿™ä¸ªè§’è‰²ï¼Œè¿™ä¸ªè§’è‰²æ¯”è¾ƒç‰¹æ®Šï¼Œå› ä¸ºå®ƒåªè´Ÿè´£åœ¨ä¸å½±å“é›†ç¾¤äº‹åŠ¡å¤„ç†èƒ½åŠ›çš„å‰æä¸‹æ¥æå‡é›†ç¾¤çš„éäº‹åŠ¡çš„å¤„ç†æ€§èƒ½(å¦‚ä½•å¤„ç†çš„ä¹Ÿæ”¾åœ¨ä¸‹ä¸€ç¯‡åŸç†ç¯‡)ï¼Œè¯´äº†ä¸€å †æ¦‚å¿µï¼Œæ¥ç€æˆ‘ä»¬æ¥è¯´è¯´ZooKeeperçš„é›†ç¾¤ç¯å¢ƒæ­å»º\n\né¦–å…ˆæˆ‘å‡†å¤‡äº†3å°CentOSçš„æœºå™¨ï¼Œæˆ‘æ˜¯ä½¿ç”¨Dockeræ­å»ºçš„ç¯å¢ƒï¼Œæ¨èå¤§å®¶ä¹Ÿä½¿ç”¨ï¼Œå½“ç„¶å¤§å®¶ç”¨æœ¬æœºæˆ–è€…è™šæ‹Ÿæœºéƒ½æ˜¯å¯è¡Œçš„ï¼Œç¯å¢ƒè€Œå·²æ— æ‰€è°“ã€‚\n\né¦–å…ˆä¿®æ”¹å„è‡ªä¸‹é¢çš„`zoo.cfg`æ–‡ä»¶\næ·»åŠ å†…å®¹å¦‚ä¸‹:\n```\n// æ ¼å¼ä¸º IP or HOST + Port1 + Port2\nserver.1=centos_centos1_1:2333:3333\nserver.2=centos_centos2_1:2333:3333\nserver.3=centos_centos3_1:2333:3333\n```\næ¥è¯´ä¸€ä¸‹ï¼ŒIP or Hostè¿™ä¸ªæˆ‘å°±æ— éœ€è§£é‡Šäº†ï¼Œport1ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªç«¯å£æ˜¯Leaderå’ŒFollowerä¹‹é—´çš„é€šä¿¡ä¼ è¾“ç«¯å£ï¼Œport2ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªç«¯å£æ˜¯ä¸»æœºé—´é€‰ä¸¾Leaderæ—¶ä½¿ç”¨çš„æ¥å£ï¼Œæ¥ç€æˆ‘ä»¬åœ¨å„\n\næ¥ç€æˆ‘ä»¬å»å„ä¸ªä¸»æœºçš„dataDirç›®å½•ä¸‹å»åˆ›å»ºmyidæ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºå„è‡ªèŠ‚ç‚¹ID\n\nç¬¬ä¸€å°ä¸»æœº\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13t7l2ltj214i0n2t9c.jpg)\nç¬¬äºŒå°ä¸»æœº\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13tgbja6j20vy0kk0t6.jpg)\nç¬¬ä¸‰å°ä¸»æœº\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13tlirbjj20qo0hkq38.jpg)\né…ç½®å®Œæˆï¼Œæ¥ç€å¯åŠ¨æ¥çœ‹çœ‹\nå¯åŠ¨åæ¥ç€æ¥çœ‹çœ‹å®ƒçš„æ—¥å¿—æ–‡ä»¶ï¼Œå°±åœ¨binç›®å½•ä¸‹`cat zookeeper.out`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13u0jlptj21460i2ted.jpg)\nå‘ç°è™½ç„¶æ˜¯å¯åŠ¨å®Œæˆäº†ï¼Œä½†æ˜¯æŠ›äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™ä¸ªä¸ç”¨å¤ªåœ¨æ„ï¼Œæ˜¯å¦å¤–2å°æœºå™¨è¿˜æ²¡æœ‰å¯åŠ¨èµ·æ¥ï¼Œæ¥ç€æŠŠä»–ä»¬åˆ†åˆ«å¯åŠ¨ï¼ŒOKéƒ½å¯åŠ¨åï¼Œæˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ä»–ä»¬çš„å®¢æˆ·ç«¯è¿æ¥Server\n\n```\n./zkCli.sh \n```\n\næ¥ç€æˆ‘åˆ†åˆ«æ‰§è¡Œ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13ujeukqj21z00v0nkp.jpg)\n\nå¯ä»¥å‘ç°æˆ‘ä»¬ä¹‹å‰æ’å…¥çš„æ•°æ®ä¹Ÿè¢«åŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹äº†ï¼Œæ¥ç€éšæ„åœ¨ä¸€å°æœºå™¨ä¸Šæ’å…¥æ•°æ®\n```\ncreate /a cc\n```\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13usyu85j21ym092dyr.jpg)\né‚£å¦‚ä½•çŸ¥é“æˆ‘è¿™å°æœºå™¨æ˜¯Followerè¿˜æ˜¯Leaderå‘¢ï¼Ÿä½¿ç”¨`bin`ç›®å½•ä¸‹çš„`zkServer.sh`\n```\n./zkServer.sh status\n```\nç¬¬ä¸€å°æœºå™¨\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13v3ekljj20nk03mgm8.jpg)\nç¬¬äºŒå°æœºå™¨\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13vbec6lj20og05amy9.jpg)\nç¬¬ä¸‰å°æœºå™¨\n![](http://ww1.sinaimg.cn/large/7fd2951agy1ft13vljfr9j20qm04egmd.jpg)\n\nå¯ä»¥çœ‹åˆ°è¿™äº›æ•°æ®éƒ½æœ‰ä¸€ä¸ª`mode`çš„å±æ€§ï¼Œè¿™ä¸ªmodeçš„å€¼å³æŒ‡æ˜äº†å½“å‰è°æ˜¯followerè°æ˜¯leaderï¼Œé›†ç¾¤æ­å»ºå°±åˆ°è¿™é‡Œï¼Œä¸‹ä¸€ç¯‡è¯´ZooKeeperçš„ä¸€äº›åŸç†çš„æ—¶å€™è¿˜ä¼šå†ç»†å†™\n\n\n## ä½¿ç”¨åœºæ™¯\n\nç®€å•ä¸¾å‡ ä¸ªä¾‹å­ï¼ŒèŒƒå›´å¤ªå¹¿äº†\n\n**è´Ÿè½½å‡è¡¡**\n\né€šè¿‡ZooKeeperçš„è´Ÿè½½å‡è¡¡å¯ä»¥å¾ˆå¥½çš„é€šè¿‡ZooKeeperæ¥åšåˆ°è´Ÿè½½å‡è¡¡ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„èŠ‚ç‚¹éƒ½æ˜¯æ³¨å†Œåœ¨ZooKeeperä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ZooKeeperä¸‹èŠ‚ç‚¹çš„ä½¿ç”¨æƒ…å†µæ¥è‡ªå®šä¹‰è´Ÿè½½è·¯ç”±ç®—æ³•ï¼Œæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ä¹Ÿå°±æ˜¯ Dubbo + ZooKeeper ã€Kafka\n\n**æ³¨å†Œä¸­å¿ƒ**\n\nè¿˜éœ€è¦è§£é‡Šä¹ˆï¼Œè€Œä¸”åˆ©ç”¨å…¶ä¸´æ—¶èŠ‚ç‚¹çš„ç‰¹æ€§éå¸¸å¥½å®ç°ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒZooKeeperçš„ä¸´æ—¶èŠ‚ç‚¹åœ¨å…¶ä¼šè¯æ–­å¼€æ—¶ä¼šåœ¨ä¸€ä¸ªå¿ƒè·³å‘¨æœŸå†…å°†å…¶å¹²æ‰~\n\næœªå®Œå¾…ç»­ï¼Œæ•¬è¯·å…³æ³¨ä¸‹ä¸€ç¯‡ï¼šã€ŠZooKeeperçš„ä¸€äº›åŸç†ï¼Œäº†è§£ä¸€ä¸‹ã€‹\n\nå¦‚æœä½ è§‰å¾—ä½œè€…å†™çš„è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©æˆ–è€…æ”¶è·å¾ˆå¤§çš„è¯ï¼Œä½ å¯ä»¥å°è¯•ç€è¯·æˆ‘å–ä¸€ç“¶ã€Šä¸œæ–¹æ ‘å¶ã€‹æˆ–è€…åƒä¸€å—ã€Š\u001dé¸¡èƒ¸ã€‹æ¥æ¿€åŠ±æˆ‘ï¼ï¼ï¼\n\n**å¾®ä¿¡è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmntt0mzpj20yi1auaki.jpg)\n\n\n**æ”¯ä»˜å®è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnun44gdj20go0p00y2.jpg)","cover":"","link":"zookeeper_base.html","preview":"\u003cp\u003eZooKeeperæ¥åˆæ­¥äº†è§£ä¸€ä¸‹ï¼Ÿ\u003c/p\u003e\n","title":"ZooKeeperæ¥åˆæ­¥äº†è§£ä¸€ä¸‹ï¼Ÿ"},{"content":"\né¦–å…ˆï¼Œæˆ‘å…ˆåˆ—ä¸ªå¤§çº²ç›®å½•ï¼Œç®€æ˜æ‰¼è¦çš„è¯´æ˜ä¸€ä¸‹è¿™ä¸€ç¯‡æ–‡ç« è¦å†™çš„å†…å®¹æ˜¯å•¥\n\n* è¿·å®«å…¥å£çš„å®è§‚ç»“æ„\n* å…¥å£çš„èƒŒå\n* å®¹å™¨ä¸­è·å–ä¸€ä¸ªbeançš„èƒŒå\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnddn4zbj204z05rdgg.jpg)\n\n## è¿·å®«å…¥å£çš„å®è§‚ç»“æ„\n\nå—¯ï¼Œè¿·å®«ï¼Œè¿·å®«çš„å…¥å£æ˜¯ä»€ä¹ˆï¼Ÿæ ‡é¢˜è¯´çš„å¾ˆæ˜ç¡®ï¼Œæ˜¯ä½¿ç”¨Annotationçš„æ–¹å¼æ¥æ³¨å†Œå’Œæ³¨å…¥ï¼Œé‚£ä¹ˆæˆ‘åˆ†æçš„å…¥å£å°±æ˜¯`AnnotationConfigApplicationContext`ï¼Œé‚£ä¹ˆå…¥å£æœ‰äº†ï¼Œä½†æ˜¯å¹¶ä¸å‡†å¤‡ç›´æ¥ä»è¿™ä¸ªè¿·å®«èµ°è¿›å»ã€‚\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmne2c253j20b40b4abf.jpg)\n\nSpringç»“æ„è¿˜æ˜¯æ¸…æ™°æœ‰åºä¸­é€ç€å¤æ‚ï¼Œç›´æ¥é—¯åƒæˆ‘è¿™ç§é—¯è¿·å®«å·²ç»å¥½å¤šæ¬¡çš„â€œè€å¸æœºâ€åˆ°æ˜¯èƒ½æ¥å»è‡ªå¦‚ï¼Œä½†æ˜¯æ–°å¸æœºæ€•ä¸æ˜¯è¦æ™•å¤´è½¬å‘ï¼Œæ‰€ä»¥æ˜äººä¸è¯´æš—è¯ï¼Œæˆ‘è¦çœ‹å›¾ï¼Œæ²¡å›¾è¯´ä¸ªXX\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmneeocm5j22hc0uqacb.jpg)\n\nä¸è¦æ…Œï¼Œè™½ç„¶ç»“æ„å¤æ‚ï¼Œä½†åªå…³æ³¨ä¸»è¦çš„ï¼Œå…¶å®ƒçš„ä¹Ÿå°±è‡ªè¡Œä¸æ”»è€Œç ´æ‰€ä»¥ä¸æ…Œï¼\n\nå·²çŸ¥`ApplicationContext`ä¸€ä¸ªé¡¶å±‚çš„`Context`æ¥å£ï¼Œç„¶åå®ƒçš„é¡¶å±‚æ˜¯ç»§æ‰¿çš„`BeanFactory`ï¼Œ`BeanFactory`æ˜¯ä»€ä¹ˆå®ƒä¸»è¦è´Ÿè´£ä»€ä¹ˆï¼Ÿæˆ‘è¿™é‡Œå°±ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªBeanå·¥å‚çš„æ¥å£è§„èŒƒï¼Œé€šè¿‡å®ç°è¿™ä¸ªæ¥å£å¤–éƒ¨å¯ä»¥ä»å·¥å‚ä¸­è·å–ä¸€ä¸ª`bean`\n\næ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥è¯´ä¸€ä¸‹`HierarchicalBeanFactory`å’Œ`ListableBeanFactory`\n\n\n**HierarchicalBeanFactory**\n\nç®€è€Œè¨€ä¹‹å°±æ˜¯ä¸€ä¸ªç”¨æ¥å±‚æ¬¡åŒ–å·¥å‚çš„ï¼Œå…¶ä¸­å°±ä¸»è¦å®šä¹‰äº†2ä¸ªæ¥å£æ–¹æ³•`getParentBeanFactory`å’Œ`containsLocalBean`ï¼Œæ–¹æ³•åå°±å¾ˆé¡¾åæ€ä¹‰ï¼Œå¦‚æœè¿˜æ˜¯ä¸æ‡‚æ²¡å…³ç³»ï¼Œè¿™ä¸ªç±»å¯¹äºæœ¬æ–‡æ¥è¯´ä¸é‡è¦\n\n**ListableBeanFactory**\n\nä¹Ÿç®€å•æè¿°å§ï¼Œé¦–å…ˆè¿™ä¸ªæ¥å£å®šä¹‰çš„æ¥å£æ–¹æ³•å¤§ä½“èŒƒå›´æ„ä¹‰å°±æ˜¯è·å–`BeanDefinition`ä¸€äº›æ ¹æ®Annotationå’Œæ ¹æ®ç±»å‹è·å¾—ä¸€äº›Beanç±»å‹å±æ€§ï¼Œé‚£æ‰€è°“çš„`BeanDefinition`åˆæ˜¯ä¸ªä»€ä¹ˆé¬¼ä¸œè¥¿ï¼Ÿé‚£è¿™é‡Œå…ˆæ¥ç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼Œæ— è®ºä½ æ˜¯ä»XMLé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨`\u003cbean name=\"....\" class=\"...\"\u003e`è¿˜æ˜¯ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ³¨å†Œä¸€ä¸ªBeanéƒ½ä¼šè¢«å½“åšä¸€ä¸ª`BeanDefinition`å­˜å‚¨èµ·æ¥\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnfis70hj20c80c8go3.jpg)\n\nä¸å¤šå“”å“”ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹`ApplicationContext`ä½œä¸ºä¸€ä¸ªé¡¶å±‚çš„Contextæ¥å£æ€»è¿˜æ˜¯ä¼šæœ‰ç‰Œé¢çš„å®šä¹‰ä¸€äº›ä¸œè¥¿çš„ï¼Œé‡Œé¢å•Šé¦–å…ˆå°±æ˜¯ä¸€å †contextçš„å±æ€§è·å–å½“å‰contextçš„idå•¦ï¼Œä»€ä¹ˆApplicationNameå•¦ï¼Œå¯åŠ¨æ—¶é—´å•¦ï¼Œè·å¾—çˆ¶Contextå•¦ï¼Œä½†é‡Œé¢å®šä¹‰äº†`getAutowireCapableBeanFactory`(çªç„¶ä¸¥è‚ƒ)ï¼Œè¿™ä¸ªå·¥å‚ä¹Ÿæ˜¯ä¸ªæ¥å£é‡Œé¢å®šä¹‰ç€é…ç½®Beanã€åˆ›å»ºBeanã€é”€æ¯Beanå’Œè‡ªåŠ¨è£…é…ï¼Œç®€å•ç‚¹æ¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªå®šä¹‰ç€åˆ›å»ºbeanå’Œæ³¨å…¥beançš„ä¸€ä¸ªå·¥å‚æ¥å£ï¼Œè¿™æ ·è¯´OKå˜›ï¼Ÿé‡Œé¢è¿˜æœ‰ä¸€ç‚¹ç»†èŠ‚æˆ‘å°±ä¸è¡¥å……äº†\n\nå¾€ä¸‹èµ°ï¼Œæˆ‘ä»¬å†æ¥ç¨å¾®å…³æ³¨ä¸€ä¸‹`ConfigurableApplicationContext`æ¥å£,è¿™ä¸ªæ¥å£é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªå®šä¹‰äº†é…ç½®`ApplicationContext`çš„æ¥å£é‡Œé¢å®šä¹‰äº†äº›è®¸æ¥å£æ–¹æ³•ï¼Œä½†æš‚æ—¶å¹¶ä¸éœ€è¦å…³æ³¨é‚£ä¹ˆå¤šï¼Œè®°ä½`refresh`å’Œ`getBeanFactory`æ–¹æ³•å³å¯ï¼Œç°åœ¨ä¸åŒè¿™2ä¸ªæ–¹æ³•æ˜¯å¹²å•¥ç”¨çš„éƒ½æ²¡å…³ç³»ï¼Œä½ å…ˆè®°ä½ï¼Œå¾…ä¼šä½ å°±çŸ¥é“äº†ã€‚\n\næ¥ä¸‹æ¥è¶Šæ¥è¶Šè¿‘äº†ï¼Œç»ˆäºçœ‹åˆ°äº†ä¸€ä¸ªä¸æ˜¯æ¥å£çš„æŠ½è±¡ç±»`AbstractApplicationContext`ï¼Œè¿™ä¸ªç±»ç»†èŠ‚å¾ˆå¤šï¼Œä½†ä¸ç”¨æ…Œï¼Œåªéœ€è¦å…³æ³¨æˆ‘æœ¬æ–‡æ‰€æåŠå³å¯ï¼Œä»…ä»æœ¬æ–‡çš„è§’åº¦å‡ºå‘ï¼Œè¯¥æŠ½è±¡ç±»å®ç°äº†`BeanFactory`çš„`getBean`æ–¹æ³•ï¼Œè€Œè¿™äº›`getBean`çš„å®ç°å†…å®¹éƒ½æ˜¯é€šè¿‡`getBeanFactory().getBean(...)`æ¥å®ç°çš„ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ª`refresh`æ–¹æ³•ï¼Œè¯·ä¸€å®šè¦è®°ä½è¿™é‡Œå®ç°äº†`refresh`ï¼Œå®ƒé‡Œé¢å®ç°äº†å•¥ï¼Œéƒ½å…ˆä¸è¦ç®¡ï¼Œè®°ä½å°±è¡Œï¼Œæœ¬æ–‡åé¢ä¼šå›åˆ°è¿™ä¸ªæ–¹æ³•æ¥çš„ã€‚\n\n\næ¥ç€æ˜¯`GenericApplicationContext`æˆ‘ä»¬ä»…å…³æ³¨ä¸»è¦çš„(ä¸æœ¬æ–‡ç›¸å…³çš„)ï¼Œè¯¥ç±»ä¼šåœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ª`DefaultListableBeanFactory`çš„`beanFactory`å±æ€§å­˜èµ·æ¥ï¼Œä¹‹å‰å®šä¹‰ä¸ª`getBeanFactory`å®é™…ä¸Šè¿”å›çš„å°±æ˜¯æ­¤å¤„çš„`beanFactory`,å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªå…³é”®çš„æ–¹æ³•å°±æ˜¯`registerBeanDefinition`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmngbqyxqj20y805uab2.jpg)\n\nå®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨çš„`beanFactory`çš„`registryBeanDefinition`å®ƒçš„å®ç°ç»†èŠ‚ä¸ç®¡ï¼Œé©¬ä¸Šå°±è¦ä»‹ç»äº†ï¼Œå› ä¸ºæ¥ä¸‹æ¥å°±æ˜¯å…¥å£çš„èƒŒåå°èŠ‚äº†\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnglkghij206804ymy2.jpg)\n\n\n## å…¥å£çš„èƒŒå\næ­£å¼å‘è½¦ï¼Œé¦–å…ˆæ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnh0jmzyj20c80c8q5f.jpg)\n\n```\nApplicationContext applicationContext = new AnnotationConfigApplicationContext(\"base packages..\");\n\napplicationContext.getBean(\"....\")\n```\n\nå¤§è‡´å°±æ˜¯è¿™æ ·ç©çš„å§ï¼Œé¦–å…ˆå¾ˆå…³é”®åœ¨`new AnnotationConfigApplicationContext`æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ\n\n\u0008![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnhja9c4j20ua04mdge.jpg)\n\nå…ˆç®€è¦è¯´æ˜å„è‡ªçš„ä½œç”¨æˆ‘ä»¬åœ¨ç»†å…¥ä»ä¸­ï¼Œæ‰€è°“ä»å®è§‚åˆ°å¾®è§‚ï¼Œå¯èƒ½å¾®è§‚ä¸­åˆé€å…¥ç€å®è§‚ï¼Œé“æ³•è‡ªç„¶ï¼Œé¡ºæ°”è‡ªç„¶ã€‚\né¦–å…ˆ`this()`ï¼Œè°ƒç”¨äº†è‡ªèº«çš„æ— å‚æ„é€ å‡½æ•°\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmni7whcjj20rq03k3zd.jpg)\n\nå®ä¾‹åŒ–äº†2ä¸ªå±æ€§ï¼Œåªéœ€è¦å…³æ³¨`scanner`å±æ€§å³å¯å®ƒæ˜¯æ‰«æClassPathä¸‹çš„BeanDefinitionçš„\næ¥ç€æ˜¯`scan`æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnih1xnfj210k03wwfe.jpg)\n\nè¿™ä¸ªæ–¹æ³•å°±æ˜¯å»è°ƒç”¨äº†`scanner.scan`æ–¹æ³•å°†å¤–éƒ¨ä¼ å…¥çš„è¦æ‰«é¢çš„`basePackage`ç»™ä¼ äº†è¿›å»ï¼Œæ¥ç€æ¥çœ‹ä¸‹`scanner.scan`æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmniq6ckrj20vm0a40us.jpg)\n\nå…¶ä¸­ä¹Ÿåªè¦å…³æ³¨`doScan`æ–¹æ³•å³å¯ï¼Œå®ƒæ‰æ˜¯å¹•åä¸»ä½¿\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmniztsofj219i0m07ao.jpg)\n\né¦–å…ˆè€å¥—è·¯éå†ä¼ å…¥çš„basePackagesï¼ŒæŒ¨ä¸ªæœç´¢ï¼Œæš‚æ—¶åªéœ€è¦å…³æ³¨`findCandidateComponents`å®ƒä¼šæ ¹æ®éå†çš„æ¯ä¸ªbasePackageå»å®šä½å‡ºæ‰€æœ‰éœ€è¦æ³¨å†Œçš„BeanDefinitionæ¥ç®€å•çœ‹ä¸‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnj8xhhuj20xc07gabm.jpg)\n\næ²¡ä»€ä¹ˆå¥½è¯´çš„ç›´æ¥çœ‹`scanCandidateComponents`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnjhyufoj21440kiq6q.jpg)\n\nç›´æ¥èšç„¦åˆ°è¿™ä¸ªæ–¹æ³•ä¸­æœ€æ ¸å¿ƒçš„2æ®µæ¥çœ‹ä¸‹ï¼Œå°±æ˜¯ç”±è¿™é‡Œæ¥åˆ¤æ–­æ˜¯å¦æœ‰è¦æ³¨å†Œçš„`BeanDefinition `è€Œ`inlucdeFilters`ä¸­åœ¨è¯¥ç±»å®ä¾‹åŒ–æ—¶å°±ä¼šè¢«é»˜è®¤çš„æ·»åŠ `Component`æ³¨è§£ï¼Œæ‰€ä»¥é»˜è®¤åœ¨è¿™é‡Œæ‰€æœ‰`Component`æ³¨è§£éƒ½ä¼šè¢«æ³¨å†Œ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnjqta2aj20zi0bg0ur.jpg)\n\næ¥ç€å›æ¥å‰©ä¸‹çš„é‚£ä¸€å¥åˆ¤æ–­å°±æ›´åŠ ç®€å•äº†\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnjyj5b5j212004m75f.jpg)\n\næœ€åä¸€ä¸ªåˆ¤æ–­çœ‹æ–¹æ³•åéƒ½èƒ½çœ‹å‡ºæ¥ï¼Œå°±ä¸ç”¨å†å¤šè§£é‡Šäº†å§ã€‚ã€‚ã€‚è¿˜æ˜¯ç®€å•è§£é‡Šä¸€ä¸‹å§(çš®è¿™ä¸€ä¸‹å¾ˆå¼€å¿ƒ)ï¼Œé¦–å…ˆç±»å¿…é¡»ä¸æ˜¯ä¸€ä¸ªæ¥å£å…¶æ¬¡å¯ä»¥è¢«å­ç±»é‡å†™ï¼Œé€šè¿‡æ¡ä»¶çš„å°±ä¼šè¢«addè¿›å»æœ€åè¿”å›ï¼Œ\nå†åº¦å›åˆ°`doScan`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnkdx5y7j219i0lmagi.jpg)\n\nç„¶ååœ¨æ­¤å¤„è·å¾—`beanName`ç„¶åå°†æ‹¿åˆ°çš„æ‰€æœ‰`BeanDefinition`å°è£…æˆ`BeanDefinitionHolder`,å…¶å®è¿™é‡Œä¹Ÿæ˜¯å°è£…äº†ä¸€ä¸‹ï¼Œå°†`beanName`å’Œ`alias`è¿˜æœ‰`beanDefinition`å°è£…äº†è¿›å»æœ€åå†è°ƒç”¨`applyScopedProxyMode`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnknz5ulj214a09g0v0.jpg)\n\nè¿™é‡Œæˆ‘ä»¬è¿™æ ·ä½¿ç”¨é»˜è®¤æ˜¯ä½¿ç”¨çš„`NO`æ‰€ä»¥ç›´æ¥è¿”å›æ²¡ä»€ä¹ˆå¥½è¯´çš„(PS: å…¶å®æˆ‘æ˜¯æƒ³è¯´ä¸€ä¸‹çš„ï¼Œè¿™\u0008é‡Œè¿˜æ˜¯æœ‰ç‚¹é“é“å¯ä»¥è¯´çš„ï¼Œæ—¥åæœ‰æœºä¼šå†è¯´å§å¯¹äºè¿™é‡Œæš‚æ—¶ä¸é‡è¦~~)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnlkhim4j20jg0d6422.jpg)\n\næœ€ååœ¨`doScan`ä¸­è°ƒç”¨`registerBeanDefinition`å®Œæˆæ³¨å†Œ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnluv8w1j218802ymxw.jpg)\n\næˆ‘ä»¬æ¥ç€æ¥çœ‹è¿™ä¸ª`registerBeanDefinition`å¹²äº†ä»€ä¹ˆ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnm31sfhj21320dkacp.jpg)\n\nå®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†`AnnotationConfigApplicationContext`çš„`registerBeanDefinition`æ–¹æ³•å†æŠŠ`BeanDefinition`ä¼ é€’äº†è¿‡å»ï¼Œæˆ‘ä»¬å›åˆ°`AnnotationConfigApplicationContext`æ¥çœ‹\n`registerBeanDefinition`,ä½ ä¼šå‘ç°å¹¶æœ¨æœ‰ï¼Œè¿˜è®°å¾—å®ƒæ˜¯ç»§æ‰¿ä»€ä¹ˆç±»æ¥ç€å—ï¼Ÿæ²¡é”™`GenericApplicationContext`å®ƒé‡Œé¢å®šä¹‰äº†è€Œå®ƒåˆæ˜¯è°ƒç”¨`beanFactory`çš„`registerBeanDefinition `æ–¹æ³•æ‰€ä»¥ç›´æ¥çœ‹`beanFactory`çš„`registerBeanDefinition `æ–¹æ³•å°±å¯ä»¥äº†\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnmb8k46j20zi05awfr.jpg)\n\nåˆ«çš„ä¸ç®¡ä¸“æ³¨äºè¿™ä¸‰å¥å³å¯ï¼Œå®é™…ä¸Šå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ª`Map`ä¸€ä¸ª`List`å°†å®ƒå­˜å‚¨èµ·æ¥ï¼Œ`scan`åˆ†æå®Œäº†ï¼Œæœ‰æ²¡æœ‰å‘ç°é‚£é‡Œä¸å¯¹ç°åœ¨è¿˜åªæ˜¯ä¸ª`BeanDefinition`ä¸æ˜¯ä¸€ä¸ªå®ä¾‹å•Šä¸èƒ½æ³¨å…¥å•Šæœ‰æœ¨æœ‰ï¼Œå½“ç„¶äº†å› ä¸ºè¿˜æ²¡æœ‰åˆ†æå®Œï¼Œæˆ‘ä»¬åœ¨å›åˆ°`AnnotationConfigApplicationContext`è¿™é‡Œæ¥\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnmkan1rj20so04waam.jpg)\n\nå› ä¸ºè¿˜æœ‰ä¸€ä¸ª`refresh`æ–¹æ³•æ²¡æœ‰è®²å•Šï¼Œå®ƒè¿™é‡Œä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨`AbstractApplicationContext`ä¸­çš„`refresh`æ–¹æ³•ï¼Œä»æœ¬æ–‡çš„å‰æ–‡ä¸­å°±ä¸€ç›´æé†’è¯»è€…è®°ä½è¿™ä¸ªæ–¹æ³•ï¼Œè¯´ä¹‹å‰å…ˆå·²çŸ¥ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„`bean`å®ä¾‹åŒ–éƒ½æ˜¯å•ä¾‹çš„å’Œéæ‡’åŠ è½½ï¼ŒOKç°åœ¨å°±æ˜¯æ—¶å€™æ¥è¯´ä¸€ä¸‹å®ƒäº†ï¼Œå®ƒå¯æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„æ–¹æ³•\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnmshsjcj208c08c75p.jpg)\n\né‡Œé¢è°ƒç”¨äº†å¾ˆå¤šä¸ªæ–¹æ³•æ¥å®Œæˆè¿™ä»¶äº‹ï¼Œå®é™…ä¸Š`refresh`æ–¹æ³•å°±æ˜¯åˆå§‹åŒ–å®¹å™¨ç”¨çš„å®ƒä¸ºIOCå®¹å™¨å‡†å¤‡äº†Beanç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†æ¡ä»¶å¬ä¸æ‡‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åªå…³æ³¨å®ƒå…¶ä¸­å¾ˆå°çš„éƒ¨åˆ†ï¼Œè¿˜è®°å¾—æˆ‘è¯´çš„å·²çŸ¥å˜›ï¼Ÿæ—¶å€™è´´ä»£ç äº†\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnn3uwy6j210w0g276n.jpg)\n\nåªå…³æ³¨è¿™ä¸€å¥å³å¯ï¼Œå®ä¾‹åŒ–æ‰€æœ‰å•ä¾‹çš„éæ‡’åŠ è½½çš„beanï¼Œè¿·å®«å¿«èµ°åˆ°å¤´äº†ï¼Œæ¥æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥åœ£\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnnb89usj21hc0p60zr.jpg)\n\nä¸å¬ä¸å¬ğŸ™‰ï¼Œæˆ‘ä»¬åªå…³æ³¨`beanFactory.preInstantiateSingletons()`å³å¯ï¼Œç»§ç»­æ¥çœ‹è¿™ä¸ª`beanFactory.preInstantiateSingletons`åšäº†ä»€ä¹ˆ\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnnkentlj218a0tktfw.jpg)\n\nå®é™…ä¸Šè¿™é‡Œè°ƒç”¨çš„å°±æ˜¯`scan`æ³¨å†Œçš„`beanDefinitionNames`æœ‰æœ¨æœ‰å•Šï¼Œç„¶åå°†å®ƒæŒ¨ä¸ªå¾ªç¯å‡ºæ¥ç„¶åè°ƒç”¨`getBean`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnnsp2vrj215i0nm0xt.jpg)\n\nä»–è¿™é‡Œè°ƒç”¨äº†å®ƒçš„çˆ¶ç±»`AbstractBeanFactory`çš„`getBean`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmno23dbdj20vm03waau.jpg)\n\nç„¶ååœ¨ç»§ç»­æ¥çœ‹`doGetBean`é‡Œå¹²äº†å•¥ï¼Œä»£ç å¾ˆé•¿åªç”¨å…³æ³¨å¿…è¦çš„å³å¯\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmno9mkswj213s0e8mzr.jpg)\n\nè¿˜è®°å¾—æˆ‘ä»¬å·²çŸ¥çš„æ¡ä»¶å—ï¼Ÿ`bean`é»˜è®¤çš„ä½œç”¨åŸŸæ˜¯å•ä¾‹çš„,æ‰€ä»¥çœ‹è¿™é‡Œï¼Œè¿™é‡Œå®é™…ä¸Šæ˜¯å…ˆå»è°ƒç”¨äº†`AbstractAutowireCapableBeanFactory`çš„`createBean`æ–¹æ³•ï¼ŒåŒç†æˆ‘ä»¬ä¹Ÿåªéœ€è¦å…³æ³¨è¿™å…¶ä¸­éœ€è¦å…³æ³¨çš„ç‚¹å³å¯\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnojaoy7j211u070wfm.jpg)\n\næ³¨æ„äº†ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„ç»†èŠ‚è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œæˆ‘ä»…ç®€è¦è¯´æ˜è®©å¤§å®¶ç†è§£å³å¯\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnorl8tjj20z00o0aer.jpg)\n\næ¥ç€å…ˆçœ‹å®ƒçš„`createBeanInstance`æ–¹æ³•ï¼Œç›´æ¥çœ‹åˆ°å®ƒçš„æœ€åä¸€è¡Œï¼Œä¸€èˆ¬æ¥è¯´ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ï¼Œä½¿ç”¨æ— å‚æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnpggpotj20pq02i74j.jpg)\n\næ¥ç€æ¥çœ‹`instantiateBean`åšäº†å•¥\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnpoa39rj217s0hujvd.jpg)\n\næ­¤å¤„å°±æ˜¯è·å–ä¸€ä¸ªå®ä¾‹åŒ–ç­–ç•¥ï¼Œç„¶ååœ¨è°ƒç”¨`instantiate`æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å·²æœ€å¸¸ç”¨æœ€ç®€å•çš„`SimpleInstantiationStrategy`çš„`instantiate`æ¥è¯´\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnpy0gumj219w0qwwkt.jpg)\n\nè¿™é‡Œå®é™…ä¸Šä¼šå»è°ƒç”¨`BeanUtils.instantiateClass`å¦ä¸€ç§CGLIBçš„æ–¹å¼åœ¨ç®€å•çš„å®ä¾‹åŒ–ç­–ç•¥ä¸­æ˜¯ä¸æ”¯æŒçš„\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnq7y0roj210404kaah.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnqcfbbqj21e402mt9p.jpg)\n\næ¥ç€æ¥çœ‹`BeanUtils.instantiateClass`\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnqkss5yj21ea0h0wja.jpg)\n\næ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡åå°„åˆ›å»ºå®ä¾‹ï¼Œæ¥ç€ç»§ç»­å›æ¥\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnqsusdvj21100dktb5.jpg)\n\n`createBean`ä¹‹åä¼šè°ƒç”¨çš„ä¸€ä¸ª`getSingleton`æ–¹æ³•ï¼Œå¹¶å°†åˆ›å»ºçš„`bean`å®ä¾‹ä¼ é€’è¿›å»ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œç›´æ¥çœ‹å…³é”®ç‚¹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnr0va3yj20qm03oq39.jpg)\n\nå¯¹äºæ–°çš„å®ä¾‹éƒ½ä¼šè°ƒç”¨ä¸€ä¸ª`addSingleton`æ–¹æ³•æ¥çœ‹ä¸‹\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnr9oilhj20vk07iwgb.jpg)\n\nå®é™…ä¸Šå¾ˆç®€å•æœ‰æœ¨æœ‰ï¼Œå°±æ˜¯è¿˜æ˜¯å®šä¹‰äº†ä¸€ä¸ªMapå°†å®ä¾‹åŒ–çš„å¯¹è±¡å­˜å‚¨äº†èµ·æ¥ï¼Œå†ç»§ç»­å›åˆ°`doGetBean`æ¥æœ€åå°†`bean`è¿”å›å›å»ï¼Œç®€å•çš„æ¥è¯´`doGetBean`å¦‚æœå®ä¾‹æ˜¯å•ä¾‹çš„ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–è¿‡å°±ä¼šå¸®ä½ å®ä¾‹åŒ–ä¸€éï¼Œå¦åˆ™å°±ç›´æ¥è·å–è¿”å›\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnrlzuttj20pk02qjri.jpg)\n\nOKå®¹å™¨çš„é‡Œbeançš„åˆå§‹åŒ–éƒ½å·²ç»okäº†ï¼Œé‚£æˆ‘`Autowire`çš„å¯¹è±¡æ˜¯å¦‚ä½•æ³¨å…¥çš„å‘¢ï¼Ÿå®é™…ä¸Šåœ¨è°ƒç”¨`doCreateBean`ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„ç‚¹å°±æ˜¯è¿™ä¸€æ®µ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnrv3typj21cs0fywiv.jpg)\n`if (earlySingletonExposure)`ä¼šå°†æ‰€ä¾èµ–çš„è¿˜æœªåˆå§‹åŒ–çš„`bean`å…ˆç»™æ‹¿åˆ°å¹¶è¿›è¡Œä¼˜å…ˆåˆå§‹åŒ–ï¼Œç„¶åå†é€šè¿‡`populateBean`å»å¡«å……æˆ‘ä»¬æ‰€è¦æ³¨å…¥çš„`value`ï¼ŒOKï¼Œå¾ˆç®€å•çš„å‡ å¥è¯å°±æŠŠæ³¨å…¥çš„æ€è·¯ç»™è¯´æ˜ç™½äº†ï¼Œå¦‚æœè¦å…·ä½“åˆ°é‡Œé¢çš„ç»†èŠ‚åˆæ˜¯å¥½å¤šé“é“ï¼Œè¿™é‡Œæˆ‘å·²ç»æŠŠæºç ä¸­æ³¨å…¥çš„æ€è·¯å†™æ˜ç™½äº†ï¼Œå…·ä½“ç»†èŠ‚è‡ªä¸ªå»çœ‹å§\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmns9594zj20b40b4adp.jpg)\n\næ¥ä¸‹æ¥æœ€åä¸€ä¸ªå°èŠ‚\n\n## å®¹å™¨ä¸­è·å–ä¸€ä¸ªbeançš„èƒŒå\n\nè¿™ä¸ªå°èŠ‚è¿˜ç”¨å†™ä¹ˆï¼Œä¸å°±æ˜¯è°ƒç”¨`getBean`?\n```\napplicationContext.getBean(\"xxxx\")\n```\nè¿˜ä¸æ‡‚çš„è‡ªä¸ªå»å¤çœ‹ç¬¬äºŒä¸ªå°èŠ‚~~~\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnsv3ezgj20jg0jgq87.jpg)\n\nä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘è¿˜å†™äº†ä¸€ä¸ªç‚’é¸¡ç®€å•çš„å®ç°äº†ä¸€ä¸ªSpringçš„demoï¼Œæœ‰å…´è¶£çš„å¯ä»¥[ç‚¹æˆ‘](https://github.com/yuequan1997/simple-spring)äº†è§£ä¸€ä¸‹ï¼Œé¡ºæ‰‹å¯ä»¥ç»™ä¸ª`star`\n\næœ¬æ–‡å®Œ\n\nå¦‚æœä½ è§‰å¾—ä½œè€…å†™çš„è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©æˆ–è€…æ”¶è·å¾ˆå¤§çš„è¯ï¼Œä½ å¯ä»¥å°è¯•ç€è¯·æˆ‘å–ä¸€ç“¶ã€Šä¸œæ–¹æ ‘å¶ã€‹æˆ–è€…åƒä¸€å—ã€Š\u001dé¸¡èƒ¸ã€‹æ¥æ¿€åŠ±æˆ‘ï¼ï¼ï¼\n\n**å¾®ä¿¡è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmntt0mzpj20yi1auaki.jpg)\n\n\n**æ”¯ä»˜å®è¯·å®¢**\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fsmnun44gdj20go0p00y2.jpg)","cover":"","link":"spring_init_ioc.html","preview":"\u003cp\u003eæµ…è°ˆä½¿ç”¨Spring Annotationå®¹å™¨æ³¨å†Œä¸æ³¨å…¥\u003c/p\u003e\n","title":"æµ…è°ˆä½¿ç”¨Spring Annotationå®¹å™¨æ³¨å†Œä¸æ³¨å…¥"},{"content":"\nåˆ†æClassæ–‡ä»¶çš„æºç å¦‚ä¸‹ï¼š\n```\npackage org.yuequan.klass;\n\npublic class Foo{\n    private int m;\n\n    public int inc(){\n        return m + 1;\n    }\n}\n```\nç¬”è€…ä½¿ç”¨JDK1.8å°†æºæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œä¸ºäº†æ›´å¥½çš„æ‰‹åŠ¨åˆ†æè¿™ä¸ªclassæ–‡ä»¶ï¼Œç¬”è€…å°†ä½¿ç”¨ç°æœ‰çš„Classåˆ†æå·¥å…·å»æ‰“å¼€è¿™ä¸ªclassæ–‡ä»¶ã€‚\n\næ‰“å¼€åçš„Classæ–‡ä»¶:\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3jruhokj20qw0g2jv9.jpg)\n\nJavaè™šæ‹Ÿæœºè§„èŒƒå¯¹Classæ–‡ä»¶ç»“æ„åšäº†ä¸¥æ ¼çš„è§„å®šï¼Œå…¶ä¸­çš„å­—èŠ‚ä¸¥æ ¼çš„æŒ‰é¡ºåºç´§å¯†çš„æ’åœ¨ä¸€èµ·ï¼Œä¸­é—´æ²¡æœ‰ä»»ä½•çš„åˆ†éš”ç¬¦å’Œå…¶å®ƒæ•°æ®\n\nåˆ†æä¹‹å‰å…ˆæŠŠJavaè™šæ‹Ÿæœºè§„èŒƒå¯¹Classæ–‡ä»¶ç»“æ„çš„å®šä¹‰å…ˆåˆ—å‡ºæ¥\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3ksvs0jj20qm0fw414.jpg)\n\næ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒæ‰€æè¿°çš„Classæ–‡ä»¶ç»“æ„ï¼Œæˆ‘ä»¬å¤§è‡´çš„å¯ä»¥ç†è§£ç±»å‹åˆ†åˆ«ä¸ºu1ã€u2ã€u4ã€cp_infoã€field_infoã€method_infoã€attribute_infoï¼Œå…¶ä¸­u1ã€u2ã€u4åˆ†åˆ«ä¸º1ã€2ã€4æ— ç¬¦å·æ•´å‹å­—èŠ‚ï¼Œ_infoåç¼€ç»“å°¾çš„éƒ½æ˜¯è¡¨ç»“æ„ç±»å‹\nåŸºæœ¬çš„ä»‹ç»çš„å·®ä¸å¤šäº†ï¼Œé‚£å°±æ­£å¼å¼€å§‹åˆ†æå§ã€‚\n \n- - - -\næ ¹æ®ClassFileæ–‡ä»¶ç»“æ„æ¥åˆ†æï¼Œå‰é¢4ä¸ªå­—èŠ‚æ˜¯é­”æ•°ï¼Œé­”æ•°ä¸ºå›ºå®šçš„`0xCAFEBABE`ï¼Œé­”æ•°å¯ä»¥ä½œä¸ºä¸€ä¸ªæ–‡ä»¶çš„ç‰¹æ®Šè¯†åˆ«ï¼Œå¾ˆå¤šç±»å‹çš„æ–‡ä»¶ï¼Œéƒ½ä¼šåœ¨æ–‡ä»¶å‰é¢åŠ å‡ ä¸ªå­—èŠ‚å¡«å……é­”æ•°ï¼Œåˆ©ç”¨é­”æ•°æ¥è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼Œæ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒä¹Ÿåªæœ‰`0xFAFEBABE`é­”æ•°çš„æ–‡ä»¶æ‰èƒ½è¢«Javaè™šæ‹Ÿæœºæ‰€æ¥å—ã€‚\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3lh3931j20ra0g6q6u.jpg)\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3lp9v1mj20qk0fyq5k.jpg)\n- - - -\nå†ç´§è·Ÿç€çš„æ˜¯2ä¸ªå­—èŠ‚çš„æ¬¡ç‰ˆæœ¬å·\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3m6fol8j20r00gctcm.jpg)\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3mfgh5nj20qu0g20vd.jpg)\næ¬¡ç‰ˆæœ¬å·ä¸º0ï¼Œæ¬¡ç‰ˆæœ¬å·ä»JDK1.2ä»¥åæ¬¡ç‰ˆæœ¬å·å°±æ²¡æœ‰å†è¢«ä½¿ç”¨è€Œæ˜¯ä¸€ç›´ä½¿ç”¨ç€ä¸»ç‰ˆæœ¬å·ã€‚\n- - - -\nå†ç´§è·Ÿç€2ä¸ªå­—èŠ‚çš„ä¸»ç‰ˆæœ¬å·\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3mshxhvj20ra0gktcn.jpg)\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3n0pyelj20qy0g676x.jpg)\n  æˆ‘çš„ä¸»ç‰ˆæœ¬å·ä¸º`0x34`ä¸º52ï¼Œæ­£å¥½æ˜¯JDK1.8çš„ç‰ˆæœ¬å·ï¼Œä¸ºäº†æ–¹ä¾¿è§‚çœ‹ï¼Œç¬”è€…å°†JDKçš„ç‰ˆæœ¬å·æ•´ç†äº†ä¸€ä¸ªåˆ—è¡¨ä¾›å‚è€ƒ\n- - - -\nå†æ¥ä¸‹æ¥æ˜¯2ä¸ªå­—èŠ‚çš„å¸¸é‡æ± æ•°é‡\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3nb3hjej20r40gk787.jpg)\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3nmi59jj20r00gimzx.jpg)\næˆ‘çš„å¸¸é‡æ± æ•°é‡æ˜¯19ä¸ª`0x13 = 19`ï¼Œå¸¸é‡æ± å…ƒç´ ç´¢å¼•æ˜¯ä»1å¼€å§‹è€Œä¸æ˜¯0è¿™ç‚¹è¦æ³¨æ„ï¼Œæ‰€ä»¥å¸¸é‡æ± å¯ç”¨æ•°é‡ä¸º1 - count-1ï¼Œç¬¬0é¡¹æ˜¯ä¸ºäº†æŸäº›æŒ‡å‘å¸¸é‡æ± çš„ç´¢å¼•å€¼çš„æ•°æ®åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¸éœ€è¦å¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¸é‡æ± é¡¹ç›®çš„æ—¶å€™å°±å¯ä»¥å°†ç´¢å¼•ç½®ä¸º0\n\næ¥ä¸‹æ¥ä»‹ç»ClassFileçš„cp_infoä¹Ÿå°±æ˜¯å¸¸é‡æ± ï¼Œå¸¸é‡æ± ä¸­ä¸»è¦å­˜å‚¨å­—é¢é‡å’Œç¬¦å·å¼•ç”¨,å­—é¢é‡çš„æ„ä¹‰æ¯”è¾ƒæ¥è¿‘äºå¸¸é‡çš„æ¦‚å¿µï¼Œå¦‚å­—ç¬¦ä¸²ã€finalåçš„å¸¸é‡å€¼ç­‰ï¼Œè¿™é‡Œçš„ç¬¦å·å¼•ç”¨ä¸»è¦è¿˜æ˜¯åŒ…æ‹¬ï¼šç±»å’Œæ¥å£çš„å…¨é™å®šåã€å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ã€æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ï¼Œæ¥ä¸‹æ¥å†çœ‹ä¸‹cp_infoçš„ç»“æ„å®šä¹‰ï¼Œå¸¸é‡æ± ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œåˆ°ç›®å‰JDK8ç‰ˆæœ¬å…±æœ‰14ä¸ªå¸¸é‡ç±»å‹çš„ç»“æ„ï¼Œä¸ºäº†åŒºåˆ†è¿™äº›å¸¸é‡ç±»å‹ï¼Œå¸¸é‡æ•°æ®çš„ç¬¬ä¸€å­—èŠ‚æ˜¯tagåˆ†åˆ«å¯¹åº”ç€è¿™14ä¸ªå¸¸é‡ç±»å‹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3ohl0msj20vi0n4whp.jpg)\n- - - -\næ¦‚å¿µä»‹ç»åˆ°è¿™é‡Œå·®ä¸å¤šäº†ï¼Œé‚£ä¹ˆå¼€å§‹æ­£å¼çš„åˆ†æ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3oq5jk3j20ra0ge42f.jpg)\nç¬¬ä¸€ä¸ªå¸¸é‡çš„tagæ˜¯0x0Aå¯¹åº”ç€10ä¹Ÿå°±æ˜¯`Constant_Methodref_info`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3oxck2nj20da05ejrq.jpg)\næ ¹æ®ç»“æ„åé¢è¿˜æœ‰2ä¸ªu2ç±»å‹çš„`class_index`å’Œ`name_and_type_index`\n`class_index` æ˜¯æŒ‡å¸¸é‡æ± ä¸­ç´¢å¼•ä¸º`class_index`çš„å¸¸é‡é¡¹ï¼Œ`name_and_type_index`åŒç†ï¼Œç”±äºåé¢çš„å¸¸é‡é¡¹è¿˜æ²¡åˆ†æï¼Œæ— æ³•å¾—çŸ¥indexæ‰€æŒ‡çš„å…·ä½“å€¼ï¼Œæ‰€ä»¥å…ˆæŠŠå€¼åˆ†æå‡ºæ¥æ”¾åœ¨è¿™é‡Œå§ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘åœ¨æ–‡ç« çš„è¯¥åˆ—å‡ºæ¥çš„åœ°æ–¹è¿˜ä¼šåœ¨åˆ—ä¸€éï¼Œå¸¸é‡æ± ç¬¬ä¸€é¡¹çš„æ•°æ®\n```\n// index 1\ntag = 10\nclass_index = 4 \nname_and_type_index = 15\n```\n- - - -\næ¥ç€æˆ‘ä»¬æ¥åˆ†æç¬¬äºŒé¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3pv74upj20ra0h6gpj.jpg)\nç¬¬äºŒé¡¹tagä¸º9å¯¹åº”ç€`CONSTANT_Fieldref_info`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3q1l7a2j20ce04gq3a.jpg)\n```\n// index 2\ntag = 9\nclass_index = 3\nname_and_type_index = 16\n```\n- - - -\nç¬¬ä¸‰é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3q8sx56j20rc0goadz.jpg)\nç¬¬ä¸‰é¡¹tagä¸º7å¯¹åº”ç€`CONSTANT_Class_info`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3qey6aoj20ai03qwem.jpg)\n\n```\n// index 3\ntag = 7\nname_index = 17\n```\n- - - -\nç¬¬å››é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3qmqa1dj20rc0h0n13.jpg)\nç¬¬å››é¡¹tagä¸º7å¯¹åº”ç€`CONSTANT_Class_info`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3r7riowj20ai03qwem.jpg)\n```\n // index 4\n tag = 7\n name_index = 18\n```\n- - - -\nç¬¬äº”é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3ris9wmj20r60gctcm.jpg)\nç¬¬äº”é¡¹çš„tagä¸º1å¯¹åº”ç€`CONSTANT_Utf8`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3rrafunj20b804u74j.jpg)\né•¿åº¦ä¸º1\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3rxv3p5j20r20g6jva.jpg)\né•¿åº¦ä¸º1é‚£bytesä¹Ÿå°±åªæœ‰ä¸€ä¸ª\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3s5h86bj20rc0gigpj.jpg)\n```\n// index  5\ntag = 1\nlength = 1\nbytes = ['m'] // bytes = [6D]  6D = 109 =\u003e UTF8 =\u003e m \n```\n- - - -\nç¬¬å…­é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3sf5wh1j20r40h8n13.jpg)\nå—¯å“¼tagè¿˜æ˜¯01\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3sqhsqnj20b804u74j.jpg)\né•¿åº¦ä¸º1\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3sxzradj20r80gu42f.jpg)\n```\n// index 6\ntag = 1\nlength = 1\nbytes = ['I'] // bytes = ['49'] 49 =\u003e 73 =\u003e UTF8 =\u003e I\n```\n- - - -\nç¬¬ä¸ƒé¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3tefqvuj20r40gcq6u.jpg)\ntagè¿˜æ˜¯01\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3tkkfy7j20b804u74j.jpg)\né•¿åº¦ä¸º6\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3tqixvnj20r80gwgpj.jpg)\n```\n// index 6\ntag = 1\nlength = 6\n//  23333 å¾ˆé•¿äºæ˜¯æ³¨é‡Šå†™è¿™é‡Œ\n// [0x3C, 0x69, 0x6E, 0x69, 0x74, 0x3E]\n// to UTF8\n// ['\u003c', 'i', 'n', 'i', 't', '\u003e']\n// bytes.toString() =\u003e \"\u003cinit\u003e\"\nbytes = ['\u003c', 'i', 'n', 'i', 't', '\u003e']\n```\n- - - -\nç¬¬å…«é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3tx5ogzj20rm0gkwif.jpg)\ntagä»ä¸º01 ï¼ŒğŸ˜Š2333333\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3u4eg8vj20b804u74j.jpg)\né•¿åº¦ä¸º3\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3uavuqaj20r60gqadz.jpg)\n```\n// index 8\ntag = 1\nlength = 3\nbytes = ['(', ')', 'V'] //ä¸å†é‡å¤è½¬æ¢æ­¥éª¤æ‹‰\n```\n- - - -\nç¬¬ä¹é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3ulj05hj20rg0h0q6w.jpg)\ntagè¿˜æ˜¯01å“¦\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3urro3jj20b804u74j.jpg)\né•¿åº¦æ˜¯4\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3uxk9z7j20ri0gm0wo.jpg)\n\n```\n// index 9\ntag = 1\nlength = 4\nbytes = ['C', 'o', 'd', 'e']\n```\n- - - -\nç¬¬åé¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3v75rczj20rc0hmtco.jpg)\ntagè¿˜æ˜¯01å“¦\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3vd1k8vj20b804u74j.jpg)\né•¿åº¦æ˜¯15\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3vi8bmej20ra0gatcm.jpg)\n```\n// index 10\ntag = 1\nlength = 15\nbytes = ['L', 'i', 'n', 'e', 'N', 'u', 'm', 'b', 'e', 'r', 'T', 'a', 'b', 'l', 'e']\n```\n- - - -\nç¬¬åä¸€é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3vqbr8tj20r20h8n13.jpg)\né•¿åº¦ä¸º3\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3vxdd5gj20ri0gktcn.jpg)\n```\n// index 11\ntag = 1\nlength = 3\nbytes = ['i', 'n', 'c']\n```\n- - - -\nç¬¬åäºŒé¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3w32ensj20rc0g6tcm.jpg)\ntagä»»ç„¶æ˜¯1\né•¿åº¦ä¸º3\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3wcwbw9j20rk0gsjvc.jpg)\n```\n// index 12\ntag = 1\nlength = 3\nbytes = ['(', ')', 'I']\n```\n- - - -\nç¬¬åä¸‰é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3wk8jbfj20rm0gq788.jpg)\né•¿åº¦ä¸º10\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3wqwawjj20ra0gitcm.jpg)\n\n```\n// index 13\ntag = 1\nlength = 10\nbytes = ['S', 'o', 'u', 'r', 'c', 'e', 'F', 'i', 'l', 'e'] //SourceFile\n```\n- - - -\nç¬¬åå››é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3wylvbuj20re0h242g.jpg)\né•¿åº¦ä¸º8\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3x40avwj20ra0gk42f.jpg)\n```\n// index 14\ntag = 1\nlength = 8\nbytes = ['F', 'o', 'o', '.', 'j', 'a', 'v', 'a'] // Foo.java\n```\n- - - -\nç¬¬åäº”é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3xb9mpuj20r80hcwif.jpg)\ntagä¸º12,12å¯¹åº”ç€`CONSTANT_NameAndType`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3xjm4orj20dw04yq3c.jpg)\n```\n// index 15\ntag = 12\nname_index =  7\ndescriptor_index = 8\n```\n- - - -\nç¬¬åå…­é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3xqrzg1j20r00gi42f.jpg)\n```\n// index 16\ntag = 12\nname_index = 5\ndescriptor_index = 6\n```\n- - - -\nç¬¬åä¸ƒé¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3xwnkfoj20rk0g042f.jpg)\né•¿åº¦ä¸º21\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3y1frpcj20r60g2786.jpg)\n```\n// index 17\ntag = 1\nlength = 21\nbytes = ['o', 'r', 'g', '/', 'y', 'u', 'e', 'q', 'u', 'a', 'n', '/', 'k', 'l', 'a', 's', 's', '/', 'F', 'o', 'o']\n```\n- - - -\nå“‡ï¼Œæœ€åä¸€é¡¹ï¼Œç”±æ­¤å¯è§å¸¸é‡æ± å äº†æˆ‘ä»¬å­—èŠ‚ç æ–‡ä»¶çš„å¤§éƒ¨åˆ†å†…å®¹\nç¬¬åå…«é¡¹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3y9ob55j20rc0h8tcn.jpg)\né•¿åº¦ä¸º16\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3yg6juej20re0h0jvb.jpg)\n```\n// index 18\ntag = 1\nlength = 16\nbytes = ['j', 'a', 'v', 'a', '/', 'l', 'a', 'n', 'g', '/', 'O', 'b', 'j', 'e', 'c', 't']\n```\n- - - -\nè‡³æ­¤ï¼Œå¸¸é‡æ± å·²ç»åˆ†æå®Œäº†ï¼Œæ˜¯æ—¶å€™æ•´ç†ä¸€æ³¢äº†ã€‚\n\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3yml4l3j21jk2yuwzj.jpg)\nå¤§è‡´åˆ†æå‡ºæ¥çš„å†…å®¹ç”¨æ€ç»´å¯¼å›¾æ•´ç†äº†ä¸€ä¸‹ï¼Œæœ€ç»ˆæ•´åˆä¸€æ³¢\n```\n// index 1\n// class_index = 4  name_and_type = 15\nMethodref  java/lang/Object.\u003cinit\u003e\n\n// index 2\n// class_index = 3  name_and_type = 16\nFieldref org/yuequan/klass/Foo.m\n\n// index 3\n// name_index = 17\nClass org/yuequan/klass/Foo\n\n// index 4\n// name_index = 18\nClass java/lang/Object\n\n// index 5\nUtf8 m\n\n// index 6\nUtf8 I\n\n// index 7\nUtf8 \u003cinit\u003e\n\n// index 8\nUtf8 ()V\n\n// index 9\nUtf8 Code\n\n// index 10\nUtf8 LineNumberTable\n\n// index 11\nUtf8 inc\n\n// index 12\nUtf8 ()I\n\n// index 13 \nUtf8 SourceFile\n\n// index 14\nUtf8 Foo.java\n\n// index 15\n// name_index = 7 descriptor_index = 8\nNameAndType  \u003cinit\u003e\u0026()V\n\n// index 16\n// name_index = 5 descriptor_index = 6\nNameAndType m\u0026I\n\n// index 17\nUtf8 org/yuequan/klass/Foo\n\n// index 18\nUtf8 java/lang/Object\n```\nç»ˆææ•´ç†å·²å®Œæˆ~ï¼Œå¸¸é‡æ± åˆ†æå°±å…ˆåˆ°è¿™é‡Œï¼Œç”±äºæ–‡ç« ç¯‡å¹…å¥½åƒæœ‰ç‚¹é•¿äº†23333ï¼Œè¿˜æœ‰äº›è®¸çŸ¥è¯†ç‚¹æˆ‘æ”¾åœ¨ä¸‹ä¸€ç¯‡ã€Šå‡çº§ç‰ˆã€‹ä¸­å»æ¢è®¨\n- - - -\næ¥ä¸‹æ¥ï¼Œè¯¥åˆ†æå•¥ï¼Œæå‡ºClassFileç»“æ„æ¥çœ‹çœ‹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3yxhab3j20qs0g8415.jpg)\nå¸¸é‡æ± ç»“æŸåï¼Œç´§è·Ÿç€çš„æ˜¯2ä¸ªå­—èŠ‚çš„è®¿é—®æ ‡è¯†ç¬¦\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3z5by0wj20r80gi0wn.jpg)\næˆ‘ä»¬æ¥çœ‹çœ‹å¯¹åº”ç€å•¥ï¼Ÿ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3zdv3ttj20wu0hkgph.jpg)\nä¸€çœ¼çœ‹ä¸Šå»æ„Ÿè§‰æ²¡æœ‰å¯¹çš„ä¸Šçš„ï¼Ÿ ä½†ä½¿ç”¨äº†`bitmask`çš„æ€è·¯æ‰€ä»¥å¯¹åº”çš„åº”è¯¥æ˜¯\n```\naccess_flag = ACC_PUBLIC, ACC_SUPER\n```\n- - - -\nåœ¨æ¥ç€å¾€ä¸‹åˆ†æ\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3zl45b6j20po0feq5g.jpg)\nè®¿é—®æ ‡è¯†ç¬¦å®Œäº†åï¼Œæ ¹æ®ç»“æ„æ˜¯2ä¸ªå­—èŠ‚çš„`this_class` è¿™ä¸ªå€¼ä¹Ÿæ˜¯æŒ‡å‘çš„å¸¸é‡æ± çš„ç´¢å¼•\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3ztd794j20r00g6n12.jpg)\nå¯¹åº”ç€å¸¸é‡æ± ç¬¬ä¸‰ä¸ªç´¢å¼•(ä»1å¼€å§‹æ•°)ä¹Ÿå°±æ˜¯`org/yuequan/klass/Foo`\n- - - -\næ¥ä¸‹æ¥æ˜¯çˆ¶ç±»\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi3zzopopj20pe0f2jtw.jpg)\né™¤`java.lang.Object`ä»¥å¤–æ‰€æœ‰ç±»éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çˆ¶ç±»ï¼Œé‚£ä¾¿æ˜¯`java.lang.Object`ï¼Œå¯ä»¥ç†è§£ä¸ºçˆ¶è¦ä¹ˆä¸º0è¦ä¹ˆå°±æ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­å­˜åœ¨çš„Classï¼Œè€Œä¸º0çš„æ ¹æ®ç›®å‰æ¥çœ‹åº”è¯¥åªæœ‰`java.lang.Object`å¦‚æœè¿˜æœ‰å…¶å®ƒçš„æ¬¢è¿åœ¨Blogçš„Githubä¸Šæissueå¤§å®¶ä¸€èµ·åˆ†äº«ã€‚\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi4078mbtj20r20g4gpi.jpg)\nå¸¸é‡æ± ç´¢å¼•ä¸º4çš„æ˜¯`java.lang.Object`,æ‰€ä»¥è¯¥ç±»çš„çˆ¶ç±»åº”æ˜¯`java.lang.Object`\n- - - -\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi40gwp3pj20qo0fwacr.jpg)\næ¥ä¸‹æ¥æ˜¯æ¥å£\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi40tszdoj20r80h0wif.jpg)\næ­¤ç±»æ²¡æœ‰å®ç°æ¥å£æ•°é‡ä¸º0\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi40zcuioj20qq0fy0vf.jpg)\n- - - -\næ¥ä¸‹æ¥æ˜¯`fields_count`,å®ƒçš„æ•°é‡ä¸º1\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi415672uj20r00gaq6u.jpg)\næ¥ç€æ˜¯`field_info`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi41cw4bdj20qq0fswh6.jpg)\nå…ˆæŠŠç»“æ„æå‡ºæ¥çœ‹ä¸‹\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi41kiur7j20na06cq3p.jpg)\næ ¹æ®ç»“æ„å…ˆæ˜¯ä¸€ä¸ªu2çš„è®¿é—®æ ‡è¯†ç¬¦\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi41s3m78j20qu0g0ady.jpg)\n`0x0002`å¯¹åº”ç€`ACC_PRIVATE`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi41ykzxyj20u00l0jvo.jpg)\næ¥ç€æ˜¯ä¸€ä¸ªu2ç±»å‹çš„`name_index`ï¼Œ`0x0005`å¯¹åº”ç€å¸¸é‡æ± ä¸­cp_info[5]çš„m\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi42627ecj20ra0fwdjr.jpg)\næ¥ç€æ˜¯u2ç±»å‹çš„`descriptor_index`ï¼Œ`0x0006`å¯¹åº”ç€å¸¸é‡æ± ä¸­cp_info[6]çš„`I`(intçš„æè¿°å½¢å¼)\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi42fbxhfj20r40fwady.jpg)\næ¥ç€ä¹Ÿæ˜¯ä¸€ä¸ªu2ç±»å‹çš„attributes_countï¼Œä½†æ•°é‡ä¸º0\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi42lnsfqj20r00fwady.jpg)\n- - - -\næ¥ä¸‹æ¥çš„æ–¹æ³•çš„æ•°é‡\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi42rpg4sj20qm0futbc.jpg)\næ•°é‡è¡¨ç¤ºæœ‰2ä¸ªæ–¹æ³•\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi42zc6efj20r40fwady.jpg)\n- - - -\næ¥ç€æ˜¯`method_info`ï¼Œè¿˜æ˜¯å…ˆæŠŠç»“æ„æ‹¿å‡ºæ¥\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi434cxnrj20mu064752.jpg)\nå…ˆåˆ†æç¬¬ä¸€ä¸ª`access_flags`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi43dqjoxj20r60g8tcm.jpg)\n`0x0001`å¯¹åº”ç€`ACC_PUBLIC`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi43l182lj20u00rw448.jpg)\nç¬¬äºŒä¸ªæ˜¯`name_index`ï¼ŒæŒ‡å‘ç€å¸¸é‡æ± çš„ä¸€ä¸ªç´¢å¼•\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi43qw31cj20r60h0adz.jpg)\næŒ‡å‘å¸¸é‡æ± ç¬¬7ä¸ªç´¢å¼•`\u003cinit\u003e`\næ¥ç€æ˜¯`descriptor_index`\n![](http://ww1.sinaimg.cn/large/7fd2951agy1fqi43xvaq9j20r00g4jva.jpg)\næŒ‡å‘å¸¸é‡æ± ç¬¬8ä¸ªç´¢å¼•`()V`ï¼Œç”±äºæ–‡ç« ç¯‡å¹…å¤ªé•¿äº†ï¼Œå‰©ä¸‹çš„`attribute`æ”¹å¤©åˆ†è§£æˆ–è€…è¯´ä¸ä¼šå†è¯»åˆ†è§£ï¼Œæˆ‘æ„Ÿè§‰å·²ç»å¤Ÿäº†ï¼Œå¦‚æœå¤§å®¶æƒ³è¦æˆ‘å†™å®Œçš„è¯ï¼Œé‚£æˆ‘å°±å†™å®Œå§","cover":"","link":"class_analysis.html","preview":"","title":"æ‰‹æŠŠæ‰‹å¸¦ä½ åˆ†æClasså­—èŠ‚ç æ–‡ä»¶"},{"content":"\næœ¬æ¥æƒ³å†™ä¸€ç¯‡ä¼ä¸šçº§é€šç”¨çš„CI/CDä½†æ˜¯å¤ªéº»çƒ¦äº†ï¼Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹å¹¿åº¦è¾ƒå¤šï¼Œæˆ‘å…ˆå†™ä¸ªç®€æ˜“çš„å¼•å­å§ï¼Œä»¥åçœ‹æœ‰æ²¡æœ‰æœºä¼šåˆ†äº«ä¸€ä¸‹è¿‘æœŸç ”ç©¶å‡ºæ¥çš„ä¼ä¸šçº§æ¯”è¾ƒé€šç”¨çš„`CI/CD`æ–¹æ¡ˆï¼Œä»¥ä¸€ä¸ªSpringBootçš„é¡¹ç›®åšç¤ºä¾‹ã€‚\n\n\u003e å¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ¡ˆçš„è¯å¯ä»¥åŠ å¾®ä¿¡æˆ–è€…é‚®ç®±æˆ‘ä»¬å…±åŒæ¢è®¨ä¸€ä¸‹\n\nå‘å¸ƒæµç¨‹å¦‚å›¾\n\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprip989p1j21190fgjtm.jpg)\n\næˆ‘çš„æœåŠ¡å™¨ç¯å¢ƒæ˜¯\n* CentOS7\n* Docker 18.03.0-ce\n* DockerCompose 1.19.0\n\næœ¬æ¬¡æ–¹æ¡ˆæ‰€ä½¿ç”¨çš„æŠ€æœ¯æœ‰\n* Docker\n* Docker Compose\n* Jenkins\n\nä¸ºäº†æ–¹ä¾¿,æˆ‘å†™åšäº†ä¸€ä¸ª[docker-jenkins](https://github.com/yuequan1997/docker-jenkins)ç»™é¢—å°å¿ƒå¿ƒå°±å¯ä»¥äº†~\n\nè¿™é‡Œæ¼”ç¤ºèµ·è§ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ç›´æ¥ä½¿ç”¨[GitLab](https://gitlab.com/)çš„ä»“åº“ï¼Œè¿™æ ·å¤§å®¶éƒ½ä¸ç”¨å»åˆ›å»ºè‡ªå·±çš„Gitä»“åº“ï¼Œå¯ä»¥å¾ˆå¿«é€Ÿæ–¹ä¾¿çš„ä½“éªŒè¿™ä»½ç®€æ˜“çš„æŒç»­é›†æˆæ–¹æ¡ˆï¼Œä½†è¿™æ ·åšæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯å¦‚æœä½ æ²¡æœ‰åšå†…ç½‘æ˜ å°„æˆ–è€…æ˜¯æ²¡æœ‰å•ç‹¬çš„æœåŠ¡å™¨çš„è¯ï¼Œä½ æ— æ³•ä½¿ç”¨Gitçš„WebHookè®¿é—®åˆ°ä½ çš„JenkinsæœåŠ¡å™¨çš„æ¥å£\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriroo9clj21f60pqwio.jpg)\n\nåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç„¶åå°†é¡¹ç›®æ¨é€è‡³è¯¥ä»“åº“ï¼Œè¿™ä¸ªä¸ç”¨å†™åœ¨æ–‡ç« é‡Œäº†å§ï¼Œåº”è¯¥éƒ½ä¼šã€‚\n\nå¥½ï¼Œå¼€å§‹è¿›å…¥æ­£é¢˜ï¼Œè¿›å…¥æ­£é¢˜ä¹‹å‰è¯·ç¡®ä¿ä½ å·²ç»å®‰è£…äº†`docker`å’Œ`docker-compose`\né¦–å…ˆåˆ›å»ºä¸€ä¸ª`jenkins`æ–‡ä»¶å¤¹\nç„¶åå°†æˆ‘GayHubä»“åº“çš„`docker-compsoe.yml`ä¸‹ä¸‹æ¥ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘å·²ç»å°†é•œåƒæäº¤åˆ°äº†Dockerä»“åº“ï¼Œå¦‚æœä½ æ²¡æœ‰é…ç½®åŠ é€Ÿæˆ–è€…å…¶å®ƒçš„ä¸€äº›æ–¹å¼çš„è¯ï¼Œä½ å¯ä»¥è‡ªè¡Œä¸‹è½½`Dockerfile`æ–‡ä»¶è¿›è¡Œ`build`\n\n```\nmkdir jenkins \u0026\u0026 cd jenkins\n\nwget https://raw.githubusercontent.com/yuequan1997/docker-jenkins/master/docker-compose.yml\n\ndocker-compose up -d\n```\n\nä½¿ç”¨`docker ps`æ£€æŸ¥ä¸‹å®¹å™¨è¿è¡Œèµ·æ¥äº†æ²¡æœ‰\n\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprisnkuuqj21xm02iq3r.jpg)\n\nç„¶å\n```\ndocker logs å®¹å™¨ID\n```\næ³¨æ„æˆ‘çº¢è‰²æ¡†èµ·æ¥çš„åŒºåŸŸï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œä¹Ÿæ²¡æœ‰å‡ºç°å¼‚å¸¸çš„è¯ï¼Œè¯·ç­‰å¾…ä¸€ä¸‹ï¼Œç„¶åå¤åˆ¶é‚£ä¸€ä¸²åŠ å¯†çš„å­—ç¬¦\n\nå¦‚æˆ‘çš„æ˜¯ï¼š`61cfaad2c6a94b7ebb54deafac051150`\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpritgx6tuj21sw0t8tgn.jpg)\næ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š`http://æœåŠ¡å™¨IP:8080/`æˆ‘åœ¨`docker-compose.yml`æ–‡ä»¶ä¸­é…ç½®äº†ç«¯å£æ˜¯8080çš„æ˜ å°„å¦‚æœä½ çš„è¢«å ç”¨æˆ–è€…ä½ æƒ³æ›´æ¢ç«¯å£çš„è¯ï¼Œè¯·è‡ªè¡Œæ›´æ”¹\n\nå°†å¤åˆ¶çš„é‚£ä¸²ç§˜é’¥è´´è¿›å»ï¼Œç‚¹ç»§ç»­\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriubnetvj21l60xa431.jpg)\n\nç›´æ¥ç‚¹è¿™ä¸ª\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriv6fpxej21oc0zcn45.jpg)\n\nç­‰å®ƒå®‰è£…å®Œ,åŒæ—¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`dokcer logs`å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ§åˆ¶å°\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprivg5n4pj21pu0ywn24.jpg)\n\nåˆ›å»ºä¸€ä¸ªè´¦å·\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprivov7wkj21ii0uin0f.jpg)\n\nç„¶åè¿›å…¥æ§åˆ¶å°ï¼Œç³»ç»Ÿç®¡ç†=ã€‹ç®¡ç†æ’ä»¶ï¼Œç„¶åé€‰æ‹©å¯é€‰æ’ä»¶ï¼Œå®‰è£…ä»¥ä¸‹æ’ä»¶ï¼Œåˆ©ç”¨å³ä¸Šè§’çš„è¿‡æ»¤\n* Publish Over SSH\n* Gitlab\n* Gitlab Hook\n* Maven Integration\n\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriw2hpauj21ea0j2q57.jpg)\nå®‰è£…å¥½ä»¥åï¼Œå›åˆ°æ§åˆ¶å°ï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriwe1orxj21z20rwdkg.jpg)\n\nå› ä¸ºæˆ‘é¡¹ç›®æ˜¯ä½¿ç”¨mavenæ„å»ºä¹Ÿå®‰è£…äº†mavenæ’ä»¶ï¼Œæ‰€ä»¥ç›´æ¥é€‰\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriwu4k7gj21tc0tmwlv.jpg)\n\nåœ¨Generalé€‰é¡¹ä¸­ï¼Œæˆ‘é…ç½®äº†ä¿ç•™10ä¸ªæ—§çš„æ„å»º\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprix74wftj21jw0w642q.jpg)\n\né…ç½®ä½ çš„Gitä»“åº“\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprixkdbs0j21fk0ogtbs.jpg)\n\næ„å»ºè§¦å‘å™¨é€‰è¿™ä¸ª\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprixvbpj4j21js0t4tdn.jpg)\n\nç„¶åç‚¹é«˜çº§,è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªç§˜é’¥ï¼Œç„¶ååªå…è®¸masteråˆ†æ”¯è§¦å‘Webhookæ„å»º\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriy6avvgj21my0rugqn.jpg)\n\nç„¶åé…ç½®build,å®ƒä¼šè¯¢é—®ä½ çš„mavené…ç½®è¿™æ—¶å€™ç‚¹é“¾æ¥è¿›å»é…ç½®ä¸€ä¸‹\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriyhmrtpj21lo0dmq4o.jpg)\n\næˆ‘è¿™é‡Œä¸ºäº†ç®€å•ï¼Œæ²¡æœ‰å»é…åœ°å€ï¼Œç”¨çš„è‡ªåŠ¨å®‰è£…ï¼Œå¦‚æœä¸æƒ³è‡ªåŠ¨å®‰è£…å¯ä»¥å»æ‰è¿™ä¸ªé€‰é¡¹ç„¶åè¾“å…¥MAVEN_HOMEå°±å¯ä»¥äº†\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriyz9o2qj21fs0fejsr.jpg)\n\né…ç½®å¥½äº†åå›æ¥,æˆ‘çš„é…ç½®å†…å®¹å¦‚ä¸‹ï¼Œæˆ‘æ˜¯ä½¿ç”¨äº†`docker-maven-plugin`æ’ä»¶æ¥åšçš„é•œåƒç¼–è¯‘å’Œæ¨é€\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fpriz9c6tsj21fy0ak0tp.jpg)\n\næˆ‘çš„pom.xmlæ’ä»¶é…ç½®å¦‚ä¸‹\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprizjhlibj213m0isjvd.jpg)\n\nç„¶åè®¾ç½®\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprizs268xj21fc09ijsi.jpg)\n\næ·»åŠ ä¸€ä¸ª\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj035ge5j21o00ki41k.jpg)\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj0amj1nj21fa0s00x1.jpg)\n\n= = å»ç³»ç»Ÿç®¡ç†=ã€‹ç³»ç»Ÿè®¾ç½®ï¼Œæ·»åŠ ä¸ªSSH Server\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj0lzok8j21e60m4jt9.jpg)\n\nå…ˆè¿›å…¥`Docker`å®¹å™¨å†…ç”Ÿæˆæ‰§è¡Œ`ssh-keygen`ç”ŸæˆSSHç§˜é’¥å¯¹ï¼Œå¦‚æœä½ ç¡®å®šè¦ç”¨è¿™å¥—æµç¨‹çš„è¯ï¼Œè¯·å°†`~/.ssh`æŒ‚è½½ï¼Œä¸ç„¶æ¯æ¬¡é‡å¯éƒ½ä¼šä¸¢å¤± = =\n```\ndocker exec -it å®¹å™¨ID bash\nssh-keygen\n```\nç„¶åå†å°†ç”Ÿæˆçš„å…¬é’¥åŠ åˆ°ä½ çš„åº”ç”¨æœåŠ¡å™¨ä¸­å»ï¼Œç„¶åå†åˆ°åº”ç”¨æœåŠ¡å™¨ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•ä¸º`releases`\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj17q075j21f20rogow.jpg)\né…ç½®å®Œåå¯ä»¥ç‚¹å‡»Test Configurationè¿›è¡Œæµ‹è¯•\n\nè®¾ç½®å®Œåç»§ç»­å›åˆ°ä»»åŠ¡ä¸­è¿›è¡Œé…ç½®\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj1mg8oej21bc0ncgov.jpg)\n\næˆ‘åº”ç”¨æœåŠ¡å™¨çš„deploy.shè„šæœ¬å†…å®¹å¦‚ä¸‹\n```\ndocker pull registry.cn-hangzhou.aliyuncs.com/mitchell/eureka-server:latest\ndocker stop eureka-server\ndocker rm eureka-server\ndocker run --name eureka-server -p 9001:9001  -d registry.cn-hangzhou.aliyuncs.com/mitchell/eureka-server:latest\n```\n\nç„¶åä¿å­˜åè¿›è¡ŒGitlabçš„WebHooké…ç½®\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj22ssd7j21420rwgqv.jpg)\n\né…ç½®è¿™é‡Œ\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj2bchacj21ka0amtal.jpg)\n\nè¿™é‡Œçš„å†…å®¹å¡«\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj2kcmhzj21mg0cy0uz.jpg)\nå’Œ\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj2s15ooj21fu0340t2.jpg)\n\nå¡«å¥½åç‚¹add WebHookæ·»åŠ æˆåŠŸ\næ¥ç€ï¼Œæˆ‘ç”¨çš„æ˜¯Dockeré•œåƒæ¨é€ï¼Œæˆ‘éœ€è¦åœ¨jenkinsçš„å®¿ä¸»æœºä¸­å»ç™»å½•ä¸€æ¬¡æˆ‘Dockerçš„ç§æœ‰ä»“åº“ï¼Œç„¶ååœ¨ä¿®æ”¹ä¸‹`docker-compose.yml`æ–‡ä»¶å°†`/root/.docker/config.json`æ˜ å°„åˆ°jenkinså®¹å™¨ä¸­å»ï¼Œé•œåƒæ‰èƒ½æ¨é€åˆ°æˆ‘çš„ä»“åº“ä¸­å»ï¼Œå¦åˆ™ä¼šæ²¡æœ‰æƒé™ï¼Œå› ä¸º`docker-maven-plugin`1.0çš„ç‰ˆæœ¬ä»¥åä¼šé»˜è®¤çš„å»è¯»ä½ çš„Dockeré…ç½®ï¼Œæ¥è¿›è¡Œä»“åº“çš„æ¨é€ï¼Œè¿™é‡Œæˆ‘æ¼”ç¤ºæ˜¯ç”¨çš„é˜¿é‡Œäº‘çš„é•œåƒä»“åº“ï¼Œå¦‚æœä¸æƒ³è‡ªå·±æ­çš„è¯ä¹Ÿå¯ä»¥å»ä½¿ç”¨é˜¿é‡Œäº‘ã€‚\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj35laizj20rk0hiq4q.jpg)\n\næˆ‘æ¨é€åˆ°masteråˆ†æ”¯ï¼Œå¦‚æœä½ æ˜¯å†…ç½‘çš„è¯ = = gitè®¿é—®ä¸åˆ°ä½ çš„jenkinsæœºå™¨çš„è¯ï¼Œä½ è‡ªå·±ç‚¹ç«‹å³æ„å»º\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj3jnvedj21xo0peaev.jpg)\nå¼€å§‹äº†è‡ªåŠ¨æ„å»º\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fprj3vr4laj21wm0r4wq3.jpg)\nç­‰å®ƒæ„å»ºå®Œå°±å¯ä»¥äº†~~\n\nè¿˜æœ‰ä¸€äº›æ”¹è¿›çš„åœ°æ–¹ï¼Œå°†mavençš„ä»“åº“æ˜ å°„å®¿ä¸»æœºä¸Šå»ï¼Œè¿™æ ·æ¯é‡å¯å°±ä¸ç”¨å†é‡æ–°ä¸‹åŒ…äº†ï¼Œè¯¥æµç¨‹æ˜¯ä¸€ä¸ªå¾ˆç®€æ˜“çš„æµç¨‹ç»™å¤§å®¶ä¸€ä¸ªå¼•å­ä½†ä¹Ÿæ»¡è¶³ä¸€äº›éœ€æ±‚ï¼Œæƒ³è¦æ›´åŠ çµæ´»èƒ½æ›´åŠ å“åº”å¤æ‚çš„ä¸šåŠ¡åœºæ™¯çš„è¯ï¼Œå¯ä»¥å»äº†è§£`jenkins pipline`å’Œ`salave`è¿™ä¸ªå°±ä¸åœ¨æ–‡ä¸­æåŠäº†æ¶‰åŠçŸ¥è¯†çš„å¹¿åº¦ä¼šæ¯”è¾ƒå¤š","cover":"","link":"simple_ci_cd.html","preview":"","title":"ç®€æ˜“çš„æŒç»­é›†æˆæ–¹æ¡ˆï¼ŒSpringBoot+Docker+Jenkins+Gitlab"},{"content":"\n\næ•°æ®ç«äº‰æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å†…å­˜çš„åŒä¸€å—æ•°æ®æˆ–è€…ä¼šå…±åŒæ“ä½œçš„æ•°æ®(å¯èƒ½ä¸æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„æ•°æ®)è¿›è¡Œäº†æ“ä½œï¼Œåªè¦æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œäº†å†™æ“ä½œå°±ä¼šå‘ç”Ÿæ•°æ®ç«äº‰\n\nç«æ€æ¡ä»¶æŒ‡çš„æ˜¯ç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯ä¾èµ–æ‰§è¡Œçº¿ç¨‹æ‰§è¡Œçš„é¡ºåºï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹ä¼šå‡ºç°å…¶å®ƒçº¿ç¨‹æ‰§è¡Œçš„é¡ºåºçš„ä¸åŒè€Œå¯¼è‡´æ‰§è¡Œç»“æœå¯¼è‡´åå·®ï¼Œä¸¾ä¸‰ä¸ªä¾‹å­ï¼š\n\n1.æœ‰ç«æ€æ¡ä»¶ä½†æ— æ•°æ®ç«äº‰\n```\n//è·å–åº“å­˜æ•°é‡\nlock.lock();\nint count = getInventory(merchandiseId)\nlock.unlock();\n\n//åº“å­˜å¤§äºç­‰äºè´­ä¹°\nlock.lock();\nboolean isBuy = count \u003e= purchaseQuantity;\nlock.unlock();\nif(isBuy) {\n  //ç”Ÿæˆè®¢å•\n  lock.lock();\n  //åº“å­˜-1\n  lock.unlock();\n  //å‡ºåº“......\n}else {\n  throw new MerchandHungerException(\"åº“å­˜ä¸è¶³\");\n}\n```\n\nä»¥ä¸Šä»£ç åœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶å¹¶ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸ºä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›æ“ä½œï¼Œæ‰€ä»¥å¯¹æ•°æ®çš„æ“ä½œéƒ½åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†å…¶ä»»ç„¶æ˜¯å­˜åœ¨ç«Ÿæ€æ¡ä»¶çš„ï¼Œå› ä¸ºè¿™äº›å…±äº«æ•°æ®è¿˜æ˜¯ä¼šåœ¨è¯¥çº¿ç¨‹æ²¡æœ‰æŒæœ‰é”çš„æƒ…å†µä¸‹ä¼šè¢«å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼Œå¯¼è‡´å½“å‰è·å¾—çš„çŠ¶æ€æ˜¯å¤±æ•ˆçš„ï¼Œè¿™ç§ä¼šè¢«çº¿ç¨‹é—´æ‰§è¡Œé¡ºåºå½±å“çš„å°±æ˜¯ç«æ€æ¡ä»¶\n\n2.æœ‰ç«æ€æ¡ä»¶æœ‰æ•°æ®ç«äº‰\n\nä¾‹å¦‚ä¸€ä¸ªåº“å­˜å‡ºåº“ç³»ç»Ÿï¼Œå•†å“åªæœ‰ä¸€ä»¶äº†ï¼Œä½†åŒæ—¶æœ‰2ä¸ªç”¨æˆ·(Aç”¨æˆ·ã€Bç”¨æˆ·)éƒ½æƒ³è¦å¤Ÿä¹°è¿™ä¸€ä»¶å•†å“ï¼Œäºæ˜¯éƒ½åŠ å…¥äº†è´­ç‰©è½¦éƒ½åŒæ—¶ç‚¹å‡»äº†ç»“ç®—ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```\n//è·å–åº“å­˜æ•°é‡\nint count = getInventory(merchandiseId)\n//åº“å­˜å¤§äºç­‰äºè´­ä¹°\nif(count \u003e= purchaseQuantity) {\n  //ç”Ÿæˆè®¢å•\n  //åº“å­˜-1\n  //å‡ºåº“......\n}else {\n  throw new MerchandHungerException(\"åº“å­˜ä¸è¶³\");\n}\n```\næ‰§è¡Œçš„é¡ºåºå¯èƒ½å¦‚ä¸‹\n![](https://ws1.sinaimg.cn/large/7fd2951agy1fp5tbiwn7sj219808ijs1.jpg)\nBç”¨æˆ·è·å–çš„åº“å­˜ï¼Œåœ¨æ‰§è¡Œè¯„æ–­çš„æ—¶å€™å…¶æœ¬èº«è·å–çš„æ•°æ®å·²ç»æ˜¯å¤±æ•ˆçš„äº†ï¼Œä¹Ÿæœ‰å¯èƒ½2ä¸ªçº¿ç¨‹é—´æ‰§è¡Œçš„é¡ºåºè¿˜ä¼šæ›´åŠ çš„ä¸åŒï¼Œè¿™ç§æ‰§è¡Œæ—¶ä¼šå—åˆ°å…¶å®ƒçº¿ç¨‹é—´æ‰§è¡Œçš„é¡ºåºçš„å½±å“å°±ç§°ä¸ºç«Ÿæ€æ¡ä»¶\n\n3.æ— ç«æ€æ¡ä»¶æœ‰æ•°æ®ç«äº‰\n```\nMerchanddis merchanddis = getMerchanddis(merchandiseId);\nsychronized(this) {\n  //è·å–åº“å­˜æ•°é‡\n  int count = getInventory(merchanddis.id);\n  //åº“å­˜å¤§äºç­‰äºè´­ä¹°\n  if(count \u003e= purchaseQuantity) {\n\t//åº“å­˜-1\n  }else {\n\tthrow new MerchandHungerException(\"åº“å­˜ä¸è¶³\");\n\treturn;\n  }\n}\n//æ·»åŠ å•†å“å·²æ‹¥æœ‰\nhadMerchanddis.add(user, merchanddis);\n//ç”Ÿæˆè®¢å•\n//å‡ºåº“......\n```\nä¸Šè¿°ä»£ç å·²ç»ä¸ä¼šå‡ºç°ç«æ€æ¡ä»¶å› ä¸ºï¼Œä¸ä¼šå—åˆ°å…¶å®ƒçº¿ç¨‹æ‰§è¡Œçš„é¡ºåºè€Œå¯¼è‡´å…¶è‡ªèº«è¿è¡Œç»“æœçš„æ­£ç¡®æ€§ï¼Œä½†å…¶ä»ç„¶å­˜åœ¨æ•°æ®ç«äº‰å³`hadMerchanddis.add(user, merchanddis);`è¯¥æ•°æ®æ“ä½œè¿˜æ˜¯ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶`add`ä½†å½“å‰æ‰§è¡Œçº¿ç¨‹ä¸ä¼šå—åˆ°å…¶å®ƒçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„å½±å“ã€‚\n\nç«æ€æ¡ä»¶å’Œæ•°æ®ç«äº‰çš„åŒºåˆ«ï¼š\n\tæ•°æ®ç«äº‰ä¸»è¦æŒ‡çš„æ˜¯åŒä¸€å—æ•°æ®ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œï¼Œè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œæ—¶æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å†™äº†å°±æ˜¯æ•°æ®ç«äº‰ã€‚\n\tç«Ÿæ€æ¡ä»¶ä¸»è¦æŒ‡çš„æ˜¯å½“å‰çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºçš„ç»“æœï¼Œä¼šè¢«å…¶å®ƒçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„ç»“æœæ‰€å½±å“ã€‚","cover":"","link":"æ•°æ®ç«äº‰ä¸ç«Ÿæ€æ¡ä»¶åŠåŒºåˆ«.html","preview":"","title":"ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶ï¼Ÿä»€ä¹ˆæ˜¯æ•°æ®ç«äº‰ï¼Ÿ"},{"content":"\n\n## å¹¶å‘\n\nå¹¶å‘ï¼Ÿåˆ°åº•ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿæˆ‘ä¹Ÿæ—¶å¸¸åœ¨é—®è‡ªå·±ï¼Œä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œä½†å½“æˆ‘æƒ³åˆ°äº†ç°å®ç”Ÿæ´»ä¸­ä¸€ä¸ªä¸å¤ªå¯èƒ½çš„ä¾‹å­ä»¥åï¼Œæˆ‘æƒ³æ˜ç™½äº†ï¼Œç©¶ç«Ÿä»€ä¹ˆæ˜¯å¹¶å‘ï¼Œè¿™æ˜¯äººé€ çš„æ¦‚å¿µä½†è§„å¾‹å´ä»¿ä½›æ˜¯ç¥é€ çš„ä¸€èˆ¬(æŒ‡çš„äº§ç”Ÿçš„è‡ªç„¶è§„å¾‹)ï¼Œåœ¨è®¸å¤šæ–¹é¢æˆ‘ä»¬æ—¢æ˜¯äººä¹Ÿæ˜¯ç¥ï¼Œå‡å¦‚æœ‰3ä¸ªäººå»ä¹°ç¥¨ï¼Œå”®ç¥¨å‘˜åªæœ‰ä¸€äººçª—å£ä¹Ÿåªæœ‰ä¸€ä¸ªï¼Œè¿™æ˜¯ä¸€ä¸ªæ’é˜Ÿæœºåˆ¶è¿˜æ²¡æœ‰å‘ç°çš„å¹´ä»£ï¼Œæ²¡æœ‰æ’é˜Ÿæœºåˆ¶ï¼Œç»™ä¸‰ä¸ªä¹°ç¥¨çš„äººéƒ½å–ä¸ªåå­—ï¼Œåˆ†åˆ«å«Aã€Bã€Cï¼ŒAè¦ä¹°ç¥¨å»åŒ—äº¬ï¼ŒBè¦ä¹°ç¥¨å»ä¸Šæµ·ï¼ŒCè¦ä¹°ç¥¨å»æ­å·ï¼Œäºæ˜¯éƒ½åœ¨æŸœå°åŒæ—¶è¯´äº†å‡ºæ¥ï¼Œäºæ˜¯é¢å¯¹è¿™ä¸‰ä¸ªäººï¼Œå”®ç¥¨å‘˜åªèƒ½é€‰å–ä¸€äººè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œäºæ˜¯è¯´Bä½ è¦ä¹°å‡ ç‚¹çš„ç¥¨ï¼ŸBè¯´æˆ‘è¦ä¹°8ç‚¹çš„ç¥¨ï¼Œè¿™æ—¶å€™å”®ç¥¨å‘˜åˆè®°èµ·æ¥è¿˜æœ‰ACï¼Œè¿™æ—¶å€™åˆé—®Aä½ è¦ä¹°å‡ ç‚¹çš„ç¥¨Aä¹Ÿè¯´æ˜¯8ç‚¹ï¼Œè¿™æ—¶å€™å”®ç¥¨å‘˜åˆé—®Cä½ è¦ä¹°å‡ ç‚¹çš„ç¥¨ï¼ŒCä¹Ÿæ˜¯åŒæ ·è¯´é“è¦ä¹°8ç‚¹çš„ç¥¨ï¼Œåœ¨å¾—çŸ¥äº†è¿™äº›æ¶ˆæ¯åå”®ç¥¨å‘˜åˆæƒ³èµ·äº†Bè¦ä¹°8ç‚¹å»ä¸Šæµ·çš„ç¥¨ï¼Œè¿˜æ²¡æœ‰æŸ¥è¯¢ï¼Œäºæ˜¯é©¬ä¸ŠåˆæŠŠB8ç‚¹å‰å¾€ç›®çš„åœ°çš„ç¥¨ä»·å‘Šè¯‰äº†ä»–ï¼Œäºæ˜¯åˆ†åˆ«æƒ³èµ·äº†Aã€Cè¦ä¹°ç¥¨çš„äº‹æƒ…ï¼Œåˆ†åˆ«æŸ¥è¯¢å°†ç¥¨ä»·å‘Šè¯‰äº†ä»–ä»¬ï¼Œç„¶åå„è‡ªæé’±ï¼Œå”®ç¥¨å‘˜å¯èƒ½å…ˆæ”¶Bçš„é’±ï¼Œç„¶åå†å»æ”¶Cçš„é’±ç„¶åå†æ”¶Açš„é’±ç„¶åç»™Aå‡ºç¥¨ç„¶åå†ç»™Cå‡ºç¥¨å†ç»™Bå‡ºç¥¨\n\næˆ‘è‡ªå·±è§‰å¾—æˆ‘æ¯”å–»çš„éå¸¸å½¢è±¡ï¼Œæ¯”å–»å§‹ç»ˆæ˜¯æ¯”å–»ï¼Œè½åœ°åˆ°å®ç°ï¼Œæ¥èŠèŠè®¡ç®—æœºçš„å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œ\n\nåœ¨å•æ ¸æƒ…å†µä¸‹ç¨‹åºè®¡æ•°å™¨è¿™ä¸ªå¯„å­˜å™¨åªæœ‰ä¸€ä¸ªï¼Œè€ŒåŒæ—¶åœ¨ä¸Šé¢æ‰§è¡Œçš„ä¹Ÿåªæœ‰ä¸€ä¸ªè¿™ä¸ªå¯„å­˜å™¨ï¼Œè¿™ä¸ªå¯„å­˜å™¨å¥½æ¯”æˆ‘æ¯”å–»æè¿°çš„å”®ç¥¨å‘˜ï¼Œåªæœ‰ä¸€ä¸ªï¼ŒåŒæ—¶èƒ½å†å®ƒä¸Šé¢çš„æŒ‡ä»¤ä¹Ÿåªæœ‰ä¸€æ¡ï¼Œè¿™æ—¶å€™æœ‰ç¨‹åºè¿è¡Œäº†å‘æ“ä½œç³»ç»Ÿç”³è¯·äº†èµ„æºæ”¾å…¥äº†å†…å­˜ï¼Œè¿è¡Œèµ·æ¥äº§ç”Ÿäº†è¿›ç¨‹ï¼Œå‡è®¾è¿™ä¸ªè¿›ç¨‹ä¸­æœ‰ä¸‰ä¸ªçº¿ç¨‹(å¯èƒ½æ›´å¤šï¼Œä»…æ˜¯æ¯”å–»)ï¼Œåˆ†åˆ«æ˜¯Aã€Bã€Cçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿæ˜¯æœ‰å„è‡ªçš„ç¨‹åºè®¡æ•°å™¨ç”¨äºæ ‡è¯†å½“å‰çº¿ç¨‹æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œåœ¨æ¯”å–»ä¸­å°±ç›¸å½“äºAã€Bã€Cæ‰€è¯´çš„è¯ï¼Œ3ä¸ªçº¿ç¨‹éƒ½æƒ³æ‰§è¡Œä¹Ÿæ²¡æœ‰ä»»ä½•åŒæ­¥æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œç”±çº¿ç¨‹è°ƒåº¦å™¨æ¥è°ƒåº¦æ‰§è¡Œï¼Œå…·ä½“è°ƒåº¦å™¨å…·ä½“è°ƒåº¦ç®—æ³•ï¼Œä»…åšæ¯”å–»ï¼Œçº¿ç¨‹Aæ‰§è¡Œäº†1æ¡æŒ‡ä»¤äºæ˜¯é©¬ä¸Šè¢«çº¿ç¨‹Bæ‰§è¡Œäº†1æ¡æŒ‡ä»¤é©¬ä¸Šçº¿ç¨‹Cæ‰§è¡Œäº†ä¸€æ¡æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½æ˜¯å…ˆæ‰§è¡Œäº†çº¿ç¨‹Aï¼Œä»»ä½•çº¿ç¨‹Bã€Cè¿›è¡Œçš„äº¤æ›¿æ‰§è¡Œï¼Œæ¯”å–»ä¸­å”®ç¥¨å‘˜æƒ³èµ·Bè¦ä¹°8ç‚¹çš„ç¥¨æ—¶ï¼Œå¾—è¦å»å¸®Bå»æŸ¥è¯¢æ‰§è¡Œï¼Œä½†æ˜¯æ‰§è¡Œæ“ä½œçš„å‰ææ˜¯ä¸æ˜¯è¦å…ˆæƒ³èµ·æ¥Bè¦ä¹°8ç‚¹çš„ç¥¨çš„è¿™ä¸ªä¸Šä¸‹æ–‡ï¼Œè¿™ä¹Ÿå°±æ˜¯çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œéœ€è¦æŠŠä¹‹å‰çº¿ç¨‹æ‰§è¡Œçš„ä¸Šä¸‹æ–‡åˆé‡æ–°åŠ è½½è¿›æ¥ï¼Œç»¼ä¸Šæ‰€è¿°è¿™æ˜¯è®¡ç®—æœºä¸Šåœ¨æ‰§è¡Œçº¿ç¨‹ä¸Šçš„ä¸€ç§å¹¶å‘\n\nä¸Šé¢åˆå¤ªç»†ç²’åº¦ï¼Œæˆ‘åœ¨æ¦‚å¿µä¸Šåœ¨ç²—ç²’åº¦çš„æè¿°ä¸‹ä»€ä¹ˆå«åšå¹¶å‘ï¼Œå¹¶å‘å®é™…ä¸Šå°±æ˜¯å¤šä¸ªä»»åŠ¡æƒ³è¦åœ¨åŒä¸€æ—¶é—´ä¸Šå»æ‰§è¡Œï¼Œå‘å‡ºäº†å§”æ‰˜ï¼Œä½†å®é™…ä¸Šçš„æ‰§è¡Œå¯èƒ½æ˜¯äº¤æ›¿çš„ä¹Ÿå¯èƒ½æ˜¯å¹¶è¡Œçš„æˆ–è€…æŸä¸ªä»»åŠ¡åˆæ˜¯æ²¡æœ‰å›åº”çš„ï¼Œæƒ³è¦åŒä¸€æ—¶é—´å»æ‰§è¡Œå³ä¸ºâ€œå¹¶â€ï¼ŒåŒä¸€æ—¶é—´å‘å‡ºçš„æ‰§è¡Œå³ä¸ºâ€œå‘â€\n\n## å¹¶è¡Œ\n\nå¹¶è¡Œæ˜¯ä»€ä¹ˆï¼Ÿåˆ°åº•ä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿå…ˆåšä¸ªæ¯”å–»ï¼Œæˆ‘ä»¬æœ‰5ä¸ªäººæƒ³è¦åŒæ—¶çš„é€šè¿‡ä¸€é“é—¨ï¼ˆå¯ä»¥å®¹çº³6ä¸ªäººå¹¶æ’é€šè¿‡ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬å¹¶æ’èµ°åœ¨äº†ä¸€èµ·ï¼Œä¸€èµ·é€šè¿‡äº†è¿™æ¡é—¨\n\nå‡è®¾æˆ‘ä»¬æœ‰5ä¸ªçº¿ç¨‹åŒæ—¶åœ¨CPUä¸Šæ‰§è¡Œé‚£ä¹ˆå³æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å¾—æ‹¥æœ‰6ä¸ªæ ¸ï¼ˆæ²¡æœ‰5ä¸ªæ ¸çš„CPUï¼Œå½“ç„¶è¿™æ˜¯äººé€ çš„ï¼Œä½ è¯´è¦å»é€ ä¸€ä¸ª5æ ¸CPUä¹Ÿæ— å¯å¥ˆä½•ï¼Œå•æ ¸å•çº¿ç¨‹çš„å¤„ç†å™¨æƒ…å†µï¼‰ï¼Œå„ä¸ªæ ¸åŒæ—¶å¯¹æ¯æ¡çº¿ç¨‹æ‰§è¡Œï¼Œå³åƒæ¯”å–»ä¸­çš„å¹¶æ’èµ°åœ¨äº†ä¸€èµ·ï¼Œä¸€èµ·å³ä¸ºä¸ºâ€œå¹¶â€ï¼Œè¡Œä¸ºä¹ƒè‡³â€œè¡Œâ€\n\n## åŒºåˆ«\n\nå¹¶å‘æ˜¯åŒæ—¶å‘ç”Ÿçš„çŠ¶æ€å®ƒçš„å¯¹ç«‹é¢æ—¢æ˜¯åº”å¯¹ï¼Œåº”å¯¹çš„å¯¹ç«‹é¢æ—¢æ˜¯å‘ç”Ÿï¼Œè€Œå¹¶è¡Œæ˜¯å±äºåŒæ—¶æ‰§è¡Œçš„ä¸€ç§è¿è¡Œæœºåˆ¶","cover":"","link":"å¹¶å‘ä¸å¹¶è¡Œçš„ä»¥åŠåŒºåˆ«.html","preview":"","title":"å¹¶è¡Œå’Œå¹¶å‘ä»¥åŠåŒºåˆ«"},{"content":"\nåœ¨ä¸Šä¸€ç¯‡è¯´äº†`DefaultListableBeanFactory`è¿™ä¸ªç±»ï¼Œæœ¬ç¯‡å°†ä¼šåˆ†æå®ƒçš„ä¸€ä¸ªå­ç±»`XmlBeanFactory`ï¼Œè€è§„çŸ©å…ˆçœ‹çœ‹å®ƒçš„ç±»å…³ç³»å›¾\n![XmlBeanFactory ç±»å…³ç³»å›¾](http://ww1.sinaimg.cn/large/006TpURwgy1fngfhctj7kj31bo0lm77l.jpg)\n\n2333ï¼Œå¿½ç•¥å®ƒå·²ç»è¢«åºŸå¼ƒäº†ï¼Œè™½ç„¶è¢«åºŸå¼ƒäº†æˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å¾ˆæœ‰å¿…è¦ä»è¯¥ç±»å…¥æ‰‹çš„ï¼Œæ ¹æ®ç±»å…³ç³»å›¾å¾ˆç›´æ¥å®ƒç»§æ‰¿è‡³`DefaultListableBeanFactory`ï¼Œç°åœ¨æ¥çœ‹ä¸‹è¯¥ç±»æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œ(^V^è™½ç„¶å¤§å®¶åº”è¯¥éƒ½ä¼šç”¨)\n\n```\nResource resource = new ClassPathResource(\"application.xml\");\nBeanFactory beanFactory = new XmlBeanFactory(resource);\nPerson person = (Person) beanFactory.getBean(\"person\");\nSystem.out.println(person != null);\nSystem.out.println(person.toString());\n```\n\nå¾ˆç®€å•ï¼Œè·å–èµ„æºæ–‡ä»¶ï¼Œå°†è·å–çš„èµ„æºæ–‡ä»¶ä¼ å…¥`XmlBeanFactory`ï¼Œç„¶åå†ä»ä¸­è·å–å®šä¹‰çš„Beanï¼Œæ¥ä¸‹æ¥æ­£å¼å¼€å§‹å§ã€‚\n\n![XmlBeanFactory æºç ](http://ww1.sinaimg.cn/large/006TpURwgy1fngfjg0o40j313q0p47a2.jpg)\n\næ ¹æ®æºç å¯ä»¥å‘ç°è¯¥ç±»å®šä¹‰äº†2ä¸ªæ„é€ å‡½æ•°\n\n\n* XmlBeanFactory(Resource resource)\n* XmlBeanFactory(Resource resource, BeanFactory parentBeanFactory)\n\nç¬¬ä¸€ä¸ªï¼šè¯¥æ„é€ å‡½æ•°ç›´æ¥ä¼ å…¥`resource`å’Œ`null`è‡³å¦ä¸€ä¸ªæ„é€ å‡½æ•°\n\nç¬¬äºŒä¸ªï¼š`resource`è¯¥å‚æ•°å°±ä¸ç”¨è§£é‡Šäº†ï¼Œ`parentBeanFactory`è¯¥å‚æ•°ä»£è¡¨è¯¥`BeanFactory`å®ä¾‹çš„ä¸Šä¸€çº§çš„`BeanFactory`ï¼Œä¸ç†è§£æ²¡å…³ç³»ï¼Œæ—¥åä¼šå†™åˆ°çš„ã€‚\n\né¦–å…ˆè¯¥æ„é€ å‡½æ•°è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°å°†`parentBeanFactory`å‚æ•°ä¼ é€’äº†è¿‡å»ï¼Œç„¶ååˆè°ƒç”¨äº†`reader.loadBeanDefinitions(resource)`æ–¹æ³•ï¼Œæ•²é»‘æ¿ï¼é‡ç‚¹åœ¨è¿™é‡Œã€‚\n\næ¥ç€ç»§ç»­å¾€é‡Œèµ°\n\n![loadBeanDefinitionReader(Resource resource)](http://ww1.sinaimg.cn/large/006TpURwgy1fngflh8vmkj30z0040gmc.jpg)\næ ¹æ®ä»£ç ç‰‡æ®µçš„æˆªå›¾ï¼Œè¯¥æ–¹æ³•è°ƒç”¨äº†å¦ä¸€ä¸ªåŒåçš„é‡è½½å‡½æ•°\n\n![loadBeanDefinitionReader(EncodedResource encodedResource)](http://ww1.sinaimg.cn/large/006TpURwgy1fngflz6ma3j30n30hfdmn.jpg)\n\né¢„é˜²èµ„æºæ–‡ä»¶çš„ç¼–ç é—®é¢˜ï¼Œä¼šå…ˆå°†`resrouce`é‡‡ç”¨`EncodeResource`è¿›è¡Œå°è£…ï¼Œä»£ç å¾ˆç®€å•æƒ³æ·±å…¥æŸ¥çœ‹`EncodeResource`çš„å¯ä»¥è‡ªè¡Œå»æŸ¥çœ‹æºç ï¼Œåˆ°äº†è¿™é‡Œæƒ³æš‚åœä¸€ä¸‹ï¼Œä¸ºäº†æ›´åŠ ç³»ç»Ÿä¸€ç‚¹ï¼Œæˆ‘ä»¬åº”å½“å…ˆçœ‹ä¸‹è¿™ä¸ªç±»çš„å…³ç³»ç»“æ„\n\n![XmlBeanDefinitionReader ç±»å…³ç³»ç»“æ„å›¾](http://ww1.sinaimg.cn/large/006TpURwgy1fngfo31xycj30oe0e00tr.jpg)\nè‡ªç„¶ä»æœ€ä¸Šé¢çš„`EnvironmentCapable`å’Œ`BeanDefinitionReader`æ¥å£å¼€å§‹\n\n*EnvironmentCapable*\n![EnvironmentCapable æºç ](http://ww1.sinaimg.cn/large/006TpURwgy1fngfps9psfj30rk07kt9k.jpg)\n\nè¯¥æ¥å£ç”¨ä½œäºç¯å¢ƒæ ‡è¯†ï¼Œå…¶åªå®šä¹‰äº†ä¸€ä¸ªæ¥å£æ–¹æ³•`getEnvironment()`ç”¨äºè·å–å½“å‰ç¯å¢ƒï¼Œé¢ï¼Œåº”è¯¥ä¼šæœ‰äººé—®æˆ‘ç¯å¢ƒå§ï¼Œå»çœ‹ä¸‹Springçš„`profile`è¿™ä¸ªä¸œè¥¿ï¼Œå¯ä»¥åˆ©ç”¨`profile`æ¥åŒºåˆ†ç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€å¼€å‘ç¯å¢ƒçš„é…ç½®ç­‰ï¼Œ233333æ‰¯è¿œçš„ï¼Œå¦‚æœæœ‰æœ‹å‹å¯¹è¿™ä¸€å—æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç§ä¸‹æ¢è®¨ã€‚\n\n*BeanDefinitionReader*\n![BeanDefinitionReader æºç ](http://ww1.sinaimg.cn/large/006TpURwgy1fngfr1cbv9j30nc120wvg.jpg)\nè¯¥æ¥å£ä¸»è¦æ˜¯å®šä¹‰äº†åŠ è½½èµ„æºã€è§£æèµ„æºã€åŠ è½½Bean\n\n*AbstractBeanDefinitionReader*\n![AbstractBeanDefinitionReader æºç ](http://ww1.sinaimg.cn/large/006TpURwgy1fngfrm27yhj30mq2j5b29.jpg)\n\nè¯¥ç±»æœ€é‡è¦çš„æ–¹æ³•ä¾¿æ˜¯212è¡Œçš„`loadBeanDefinitions(String location, @Nullable Set\u003cResource\u003e actualResources)`æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹è¯¥æ–¹æ³•\né¦–å…ˆè·å–äº†å½“å‰çš„`ResourceLoader`ï¼Œæ¥ç€åˆ¤æ–­äº†`resourceLoader`çš„ç±»å‹æ˜¯å¦æ˜¯`ResourcePatternResolver`ç±»å‹ï¼Œ`ResourcePatternResolver`æ˜¯ä¸€ä¸ªæ‰¹é‡åŠ è½½èµ„æºçš„æ¥å£ï¼Œå¥½äº†è¿™é‡Œä¸å¿…ç»†ç©¶ï¼Œä»…æ˜¯åˆ¤æ–­äº†èµ„æºçš„åŠ è½½ç±»å‹ï¼Œé¦–å…ˆå‡è®¾`if(true)` \n\n```\ntry {\n\t//ä»æŒ‡å®šä½ç½®è·å–èµ„æº\n\tResource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location);\n\t//é€šè¿‡resourcesåŠ è½½beanå¹¶è·å–åŠ è½½çš„æ•°é‡\n\tint loadCount = loadBeanDefinitions(resources);\n\tif (actualResources != null) {\n\t\tfor (Resource resource : resources) {\n\t\t\t//å°†èµ„æºåŠ è½½è‡³ä¼ é€’è¿›æ¥çš„actualResourcesä¸­å»\n\t\t\tactualResources.add(resource);\n\t\t}\n\t}\n\tif (logger.isDebugEnabled()) {\n\t\tlogger.debug(\"Loaded \" + loadCount + \" bean definitions from location pattern [\" + location + \"]\");\n\t}\n\t//è¿”å›æ•°é‡\n\treturn loadCount;\n}catch (IOException ex) {\n\tthrow new BeanDefinitionStoreException(\"Could not resolve bean definition resource pattern [\" + location + \"]\", ex);\n}\n```\n\næ¥çœ‹ä¸‹è¯¥ç±»è°ƒç”¨çš„`loadBeanDefinitions(Resource... resources)`æ–¹æ³•\n\n```\n@Override\npublic int loadBeanDefinitions(Resource... resources) throws BeanDefinitionStoreException {\n\tAssert.notNull(resources, \"Resource array must not be null\");\n\tint counter = 0;\n\tfor (Resource resource : resources) {\n\t\t//è°ƒç”¨äº†å­ç±»çš„loadBeanDefinitionsæ¥åŠ è½½bean\n\t\tcounter += loadBeanDefinitions(resource);\n\t}\n\treturn counter;\n}\n```\n\nç¨ç­‰åœ¨å¾€ä¸‹çœ‹`loadBeanDefinitions(Resource resource)`æ–¹æ³•ï¼Œå…ˆæŠŠelseçš„ç‰‡æ®µçœ‹äº†ï¼Œå› ä¸ºå®ƒä¹Ÿè°ƒç”¨äº†2333333ï¼Œä¸€æ¬¡æ€§è§£å†³ã€‚\n\n```\n//ä»æŒ‡å®šçš„ç»å¯¹è·¯å¾„åŠ è½½ä¸€ä¸ªèµ„æº\nResource resource = resourceLoader.getResource(location);\n//è°ƒç”¨äº†å­ç±»çš„loadBeanDefinitionsæ¥åŠ è½½bean\nint loadCount = loadBeanDefinitions(resource);\n\tif (actualResources != null) {\n\t\t//å°†èµ„æºåŠ è½½è‡³ä¼ é€’è¿›æ¥çš„actualResourcesä¸­å»\n\t\tactualResources.add(resource);\n\t}\n\tif (logger.isDebugEnabled()) {\n\t\tlogger.debug(\"Loaded \" + loadCount + \" bean definitions from location [\" + location + \"]\");\n\t}\n\t//è¿”å›æ•°é‡\n\treturn loadCount;\n```\nç°åœ¨æˆ‘ä»¬å†å›æ¥çœ‹å­ç±»\nè¯¥æ–¹æ³•ä¹Ÿæ˜¯`XmlBeanFactory`ä¸­`reader`å®ä¾‹æ‰€æ‰€è°ƒç”¨çš„`loadBeanDefinitions(resource);`\n\næ¥ä¸‹æ¥ç›´æ¥æ¶‰åŠåˆ°è¯¥ç±»æ˜¯å¦‚ä½•å®ç°è§£æxmlä¸­æ‰€å®šä¹‰çš„beanï¼Œå¹¶ä¸”åŠ è½½è¿›æ¥ï¼Œå†…å®¹æ¯”è¾ƒé•¿â€¦â€¦â€¦æ‰€ä»¥æ”¾åœ¨ä¸‹ä¸€ç¯‡å§ã€‚\n","cover":"","link":"spring_beans_xml_bean_factory.html","preview":"\u003cp\u003eåœ¨ä¸Šä¸€ç¯‡è¯´äº†\u003ccode\u003eDefaultListableBeanFactory\u003c/code\u003eè¿™ä¸ªç±»ï¼Œæœ¬ç¯‡å°†ä¼šåˆ†æå®ƒçš„ä¸€ä¸ªå­ç±»\u003ccode\u003eXmlBeanFactory\u003c/code\u003e\u003c/p\u003e\n","title":"Springæºç ç³»åˆ—- Spring Beans - Spring Beans-XmlBeanFactoryï¼ˆä¸Šï¼‰"},{"content":"\nè¯»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯»è€…åº”è¯¥éƒ½èƒ½å¯¹Springçš„ä½“ç³»ç»“æ„æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œåœ¨ç»“å°¾å¤„ï¼Œæˆ‘ä¹Ÿè¯´è¿‡ä¼šä»`spring-beans`åŒ…å¼€å§‹åˆ†æï¼Œåœ¨é‡å¤ä¸€ä¸‹`beans`å®ƒä¸»è¦ä¸é…ç½®æ–‡ä»¶çš„è§£æã€ç®¡ç†ã€åˆ›å»ºbeanåŠIOC/DIç›¸å…³ã€‚\n\n`beans`å’Œ`context`å°±æ˜¯Springå®ç°IOCå®¹å™¨çš„åŸºç¡€ï¼Œå½“ç„¶åœ¨æœ¬ç« åªä¼šæåŠ`beans`ä¸ä¼šæåŠ`context`å½“ç„¶åœ¨ä»¥åçš„æ–‡ç« ä¼šæåŠåˆ°`context`åŒ…\n\nåœ¨`beans`åŒ…ä¸­æœ€æ ¸å¿ƒçš„çš„ä¸€ä¸ªç±»ä¹‹ä¸€å°±æ˜¯`DefaultListableBeanFactory`ï¼Œå½“ç„¶è¿™ä¸€ç¯‡æ–‡ç« ä¼šå›´ç»•ç€è¿™ä¸ªç±»æ¥è¿›è¡Œåˆ†è§£\né¦–å…ˆæ¥äº†è§£ä¸‹`DefaultListBeanFactory`è¿™ä¸ªç±»çš„å…³ç³»ç»“æ„\n![DefaultListBeanFactoryå…³ç³»ç»“æ„](http://ww1.sinaimg.cn/large/006TpURwgy1fn8fhm1z63j31dk0jy77c.jpg)\nè¯¥ç±»ç»§æ‰¿äº†`AbstractAutowireCapableBeanFactory`å¹¶å®ç°äº†`ConfigurableListableBeanFactory`å’Œ`BeanDefinitionRegistry`æ¥å£Serializableå°±ä¸ç”¨è¯´äº†å§ï¼Ÿ233333\n\né€ä¸€æ¥åˆ†æ\n\n**AliasRegistry**\n\nè¯¥æ¥å£ä¸»è¦å®šä¹‰äº†ç”¨äºç®¡ç†åˆ«åï¼Œæä¾›äº†åˆ«åçš„æ³¨å†Œã€åˆ é™¤ã€è·å–ã€ä»¥åŠåˆ¤æ–­åˆ«åçš„æ¥å£ã€‚è¯¥æ¥å£ç›®å‰å®šä¹‰çš„æ¥å£æ–¹æ³•å¦‚å›¾\n![AliasRegistry æ¥å£æ–¹æ³•](http://ww1.sinaimg.cn/large/006TpURwgy1fn8fj14k7tj30i206egmg.jpg)\næ¥ç€æ˜¯å®ç°äº†`AliasRegistry`æ¥å£çš„`SimpleAliasRegistry`ç±»\n\n**SimpleAliasRegistry**\n\nè¯¥ç±»ä¸»è¦æ˜¯å®ç°äº†`AliasRegistry`æ¥å£å¹¶ä½¿ç”¨äº†`Map`å¯¹è±¡æ¥å­˜å‚¨åˆ«åï¼Œä¸ªäººæ„Ÿè§‰é‡Œé¢æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»çœ‹çœ‹è¯¥ç±»çš„æºç ï¼Œå¦‚æœ‰ä¸æ‡‚çš„å¯ä»¥é‚®ä»¶æˆ‘`yuequan1997@gmail.com`æˆ–è€…åŠ æˆ‘å¾®ä¿¡`yuequan1997`éƒ½å¯ä»¥ã€‚\næ¥ä¸‹æ¥å·¦èµ°ä¸€æ­¥å…ˆè¯´`SingletonBeanRegistry`æ¥å£ï¼Œåœ¨æ¥ç€å¾€ä¸‹è¯´`DefaultSingletonBeanRegistry`\n\n**SingletonBeanRegistry**\n\nè¯¥æ¥å£ä¸»è¦å®šä¹‰äº†å•ä¾‹Beançš„æ³¨å†ŒåŠè·å–ï¼Œæ¥å£å¦‚å›¾ï¼Œè¿™æ¥å£å¾ˆå¥½ç†è§£ï¼Œç¬”è€…æ„Ÿè§‰ä¸éœ€è¦è§£é‡Šï¼Œå¦‚æœå®åœ¨çœ‹ä¸æ‡‚ç§èŠæˆ‘å§233333\n![SingletonBeanRegistry æ¥å£æ–¹æ³•å®šä¹‰](http://ww1.sinaimg.cn/large/006TpURwgy1fn8fk3caydj30jg08ugmw.jpg)\næ¥ç€è¯´`DefaultSingletonBeanRegistry`\n\n**DefaultSingletonBeanRegistry**\n\nè¯¥ç±»ä¸»è¦è¿˜æ˜¯å®ç°äº†`DefaultSingletonBeanRegistry`ï¼Œç¬”è€…è®¤ä¸ºè¯¥å®ç°çš„å’Œå®šä¹‰å‡ ä¸ªæ–¹æ³•éƒ½å¾ˆå¥½ç†è§£ï¼Œæ„Ÿè§‰ä¸ç”¨å¤ªè¿‡äºå»è§£é‡Šï¼Œä½†æ˜¯è¯¥ç±»å®šä¹‰çš„å‡ ä¸ªå˜é‡è¿˜æ˜¯ç¨å¾®å€¼å¾—è§£é‡Šä¸‹çš„\n```\n// ç¼“å­˜æ‰€æœ‰æ³¨å†Œçš„singletonå®ä¾‹\nprivate final Map\u003cString, Object\u003e singletonObjects = new ConcurrentHashMap\u003c\u003e(256);\n// ç¼“å­˜singleton å·¥å‚\nprivate final Map\u003cString, ObjectFactory\u003c?\u003e\u003e singletonFactories = new HashMap\u003c\u003e(16);\n// ç›®å‰æˆ‘åœ¨è¯¥ç±»ä¸­çœ‹åˆ°çš„ä½œç”¨æ˜¯ç”¨äºç¼“å­˜singletonå·¥å‚è·å–å‡ºæ¥çš„singletonå®ä¾‹\nprivate final Map\u003cString, Object\u003e earlySingletonObjects = new HashMap\u003c\u003e(16);\n// ç¼“å­˜å·²æ³¨å†Œçš„singletonå®ä¾‹çš„beanName\nprivate final Set\u003cString\u003e registeredSingletons = new LinkedHashSet\u003c\u003e(256);\n// ç¼“å­˜æ­£åœ¨åˆ›å»ºä¸­çš„singletonå®ä¾‹\nprivate final Set\u003cString\u003e singletonsCurrentlyInCreation =\n\t\t\tCollections.newSetFromMap(new ConcurrentHashMap\u003c\u003e(16));\n// ç¼“å­˜ä¸éœ€è¦è·å–åˆ›å»ºä¸­è¿™ç§çŠ¶æ€çš„singletonå®ä¾‹\nprivate final Set\u003cString\u003e inCreationCheckExclusions =\n\t\t\tCollections.newSetFromMap(new ConcurrentHashMap\u003c\u003e(16));\n// ç¼“å­˜å‘ç”Ÿå¼‚å¸¸æ—¶å¯ä»¥ç”¨äºæŠ›å‡ºå¼‚å¸¸çš„ç±»é›†åˆ\nprivate Set\u003cException\u003e suppressedExceptions;\n// åªéœ€è¦ç¼“å­˜ä¸€æ¬¡çš„bean\nprivate final Map\u003cString, Object\u003e disposableBeans = new LinkedHashMap\u003c\u003e();\n// ç¼“å­˜beanåŒ…å«çš„bean names\nprivate final Map\u003cString, Set\u003cString\u003e\u003e containedBeanMap = new ConcurrentHashMap\u003c\u003e(16);\n// ç¼“å­˜beanä¾èµ–çš„bean names\nprivate final Map\u003cString, Set\u003cString\u003e\u003e dependentBeanMap = new ConcurrentHashMap\u003c\u003e(64);\n// ç¼“å­˜åˆ›å»ºbeanæ—¶æ‰€éœ€è¦ä¾èµ–çš„æ‰€æœ‰ä¾èµ–å…³ç³»\nprivate final Map\u003cString, Set\u003cString\u003e\u003e dependenciesForBeanMap = new ConcurrentHashMap\u003c\u003e(64);\n```\nè§£å†³beançš„ä¾èµ–é—®é¢˜çš„å±æ€§ä¸»è¦æ˜¯\n\n* containedBeanMap\n* dependentBeanMap\n* dependenciesForBeanMap\n\nå› ä¸ºè¿™ä¸ªç±»çš„æºç å¯è¯»æ€§éå¸¸çš„å¼ºï¼Œæƒ³è¦æ·±å…¥çš„äº†è§£å¯ä»¥è‡ªè¡Œçš„å»ç»†çœ‹è¯¥ç±»çš„æºç ï¼Œè¿™é‡Œå·²ç»æŠŠå±æ€§éƒ½è¿›è¡Œäº†è¯´æ˜å·²ç»æ›´åŠ å¥½é˜…è¯»å®ç°çš„é€»è¾‘äº†ï¼Œç¬”è€…ä¹Ÿä¸€ç›´å¸Œæœ›æ˜¯æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”çš„å¿ƒæ€æ¥å’Œå¤§å®¶åˆ†äº«ã€æ¢è®¨ã€‚\næ¥ä¸‹æ¥æ˜¯`FactoryBeanRegistrySupport`ç±»\n\n**FactoryBeanRegistrySupport**\n\nè¯¥ç±»ç»§æ‰¿äº†DefaultSingletonBeanRegistryå¹¶æ·»åŠ äº†`factoryBean`çš„æ”¯æŒ\næ¥ä¸‹æ¥æ˜¯`AbstractBeanFactory`?æˆ–è€…`ConfigurableBeanFactory`?ï¼ŒNONONOï¼Œæˆ‘çœ‹å¾…äº‹ç‰©å’Œåˆ†æä¸œè¥¿éƒ½å–œæ¬¢ä»æœ€ä¸Šé¢å¼€å§‹å½“ç„¶æ˜¯`BeanFactory`\n\n**BeanFactory**\n\nè¯¥æ¥å£ä¸»è¦æä¾›äº†beançš„å„ç§è·å–æ–¹å¼å’Œbeançš„å„ç§å±æ€§ï¼Œè¯¥ç¯‡ä¸ä¼šå¯¹è¿™ä¸€å—è¿›è¡Œå¤ªè¯¦ç»†çš„è¯´æ˜ï¼Œåªéœ€è¦æœ‰ä¸ªå°è±¡å³å¯ï¼Œä»¥åçš„ç« èŠ‚ä¼šåˆ†æåˆ°è¿™é‡Œçš„ã€‚\n\n**HierarchicalBeanFactory**\n\nè¯¥æ¥å£ç»§æ‰¿è‡³`BeanFactory`æ¥å£åœ¨è¯¥åŸºç¡€ä¹‹ä¸Šæ–°å¢äº†è·å–`parentFactory`å’Œ`containsLocalBean`æ¥å£æ–¹æ³•ã€‚\n\n**ConfigurableBeanFactory**\n\nè¯¥æ¥å£ç»§æ‰¿è‡³`HierarchicalBeanFactory`å’Œ`SingletonBeanFactory`ï¼Œä¸»è¦æ˜¯æ–°å¢äº†é…ç½®BeanFactoryçš„æ–¹æ³•\næ¥ä¸‹æ¥æ˜¯\n\n**AbstractBeanFactory**\n\nè¯¥ç±»ç»§æ‰¿äº†`FactoryBeanRegistrySupport`å¹¶å®ç°äº†`ConfigurableBeanFactory`æ¥å£ç»¼åˆäº†2è€…çš„åŠŸèƒ½ï¼Œå†™ç€å†™ç€å‘ç°æœ‰å¥½å¤šå†…å®¹â€¦â€¦ è¿˜æ˜¯ä»¥åå•ç‹¬æ‹‰ä¸€ç¯‡å†™å§ï¼Œè€Œä¸”ç›®å‰å‡ ç¯‡çš„é‡ç‚¹ä¸åœ¨æ­¤ï¼Œå…ˆæœ‰å°è±¡å³å¯ã€‚\næ¥ä¸‹æ¥æ˜¯`AbstractAutowireCapableBeanFactory`ï¼Œå—¯ï¼Œè¿™å°±å¤ªå¹´è½»äº†ï¼Œæˆ‘è¯´è¿‡ï¼Œæˆ‘å–œæ¬¢ä»ä¸Šé¢å¼€å§‹å½“ç„¶æ˜¯å…ˆè¯´`AutowireCapableBeanFactory`\n\n**AutowireCapableBeanFactory**\n\nè¯¥æ¥å£ç»§æ‰¿è‡³`BeanFactory`ï¼Œè¯¥æ¥å£ä¸»è¦å®šä¹‰äº†åˆ›å»ºbeanã€åˆå§‹åŒ–ã€æ³¨å…¥ã€ä½¿ç”¨åçš„`Processors`\n\n**AbstractAutowireCapableBeanFactory**\n\nç»¼åˆäº†AbstractBeanFactoryçš„åŠŸèƒ½å¹¶å®ç°äº†AutowireCapableBeanFactoryæ¥å£\n\n**ListableBeanFactory**\n\nè¯¥æ¥å£ç»§æ‰¿è‡³`BeanFactory`ï¼Œå®ƒä¸»è¦æä¾›äº†è·å–beançš„åŸºæœ¬ä¿¡æ¯å’Œbeançš„é…ç½®åå’Œæ˜¯å¦åŒ…å«æŸä¸€ä¸ªBeanç­‰æ¥å£æ–¹æ³•\n\n**ConfigurableListableBeanFactory**\n\nè¯¥ç±»ç»§æ‰¿äº†\n\n* ListableBeanFactory\n* AutowireCapableBeanFactory\n* ConfigurableBeanFactory\n\né™¤äº†æ‹¥æœ‰çˆ¶æ¥å£çš„æ–¹æ³•å¤–ï¼Œè¿˜æä¾›äº†è·å–`BeanDefinition`å’Œé¢„åŠ è½½ä»¥åŠå¿½ç•¥çš„ç±»å‹ç­‰æ¥å£\n\n**BeanDefinitionRegistry**\n\nè¯¥æ¥å£ç»§æ‰¿è‡³`AliasRegistry`æ¥å£ï¼Œè¿˜æ–°æ·»åŠ äº†å¯¹`BeanDefinition`çš„æ³¨å†Œã€åˆ é™¤è¿˜æœ‰è·å–è¿˜æœ‰æ˜¯å¦ä»¥åŠåœ¨ä½¿ç”¨ä¸­ç­‰æ¥å£æ–¹æ³•\n\n**DefaultListableBeanFactory**\n\nè¯¥ç±»ç»¼åˆäº†ä»¥ä¸Šæ‰€æœ‰çš„åŠŸèƒ½ï¼Œå®ƒæ˜¯Springå¯¹æ³¨å†ŒåŠåŠ è½½Beançš„é»˜è®¤å®ç°\n\n\u003e è¯¥ç¯‡ä¸»è¦æ˜¯ä¸ºä¸‹å‡ ç¯‡åšé“ºå«ï¼Œä¸å¿…è¿‡äºæ·±å…¥ï¼Œæ·±å…¥çš„å¾€åä¼šå†™åˆ°ï¼Œè¿™ä¸€ç¯‡ä»…ä»…æ˜¯ä¸€ä¸ªè¿‡æ¸¡çš„é“ºå«ï¼Œå‰§é€æ—¶é—´ï¼šæ¥ä¸‹æ¥ä¼šè¯´æœ€ç»å…¸ä»¥å‰ç»å¸¸ç”¨ï¼Œåœ¨3.1åå°±ä»¥åŠè¢«åºŸå¼ƒäº†çš„`XmlBeanFactory`ï¼Œé—®æˆ‘ä¸ºä»€ä¹ˆè¦è¯´åºŸå¼ƒäº†çš„è¿™ä¸ªç±»ï¼Ÿè¯´äº†å…ˆä»beanåŒ…å¼€å§‹ï¼Œæ¨èçš„åšæ³•è·Ÿ`context`åŒ…æ¯æ¯ç›¸å…³ï¼Œå†™åˆ°å“ªé‡Œçš„æ—¶å€™å†åšè¯¦ç»†çš„èµ˜è¿°ï¼ŒåŒæ—¶å»åˆ†æ`XmlBeanFactory`ä¹Ÿæ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œè€Œä¸”å®ƒå’Œç°åœ¨æ¨èçš„åšæ³•ï¼Œåœ¨ä½¿ç”¨è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„ï¼Œå…ˆä¸èŠäº†ï¼Œä¸‹ç¯‡è§ã€‚  ","cover":"","link":"spring_beans_core_class_basic_intro.html","preview":"\u003cp\u003eè¯»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯»è€…åº”è¯¥éƒ½èƒ½å¯¹Springçš„ä½“ç³»ç»“æ„æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œåœ¨ç»“å°¾å¤„ï¼Œæˆ‘ä¹Ÿè¯´è¿‡ä¼šä»\u003ccode\u003espring-beans\u003c/code\u003eåŒ…å¼€å§‹åˆ†æï¼Œåœ¨é‡å¤ä¸€ä¸‹\u003ccode\u003ebeans\u003c/code\u003eå®ƒä¸»è¦ä¸é…ç½®æ–‡ä»¶çš„è§£æã€ç®¡ç†ã€åˆ›å»ºbeanåŠIOC/DIç›¸å…³ã€‚\u003c/p\u003e\n","title":"Springæºç ç³»åˆ—- Spring Beans - æ ¸å¿ƒç±»çš„åŸºæœ¬ä»‹ç»"},{"content":"\n# Springæºç ç³»åˆ— - å¼€ç¯‡ - Springä½“ç³»ç»“æ„ç®€ä»‹\n\u003e \tæ­¤ç¯‡æœ‰äº›è¯è¯´åœ¨å‰å¤´ï¼Œä»¥å…æµªè´¹é˜…è¯»çš„æ—¶é—´ï¼Œè¯¥ç¯‡åªéœ€è¦å¤§è‡´äº†è§£å¹¶ä¸éœ€è¦æ·±ç©¶ï¼Œåªæ˜¯ä¸ºæ²¡æœ‰è®¤çœŸäº†è§£è¿‡Springä½“ç³»ç»“æ„çš„è¯»è€…ä¸ºåç»­ç« èŠ‚çš„é˜…è¯»åšä¸ªé“ºå«ï¼Œä»¥å…å¯¹äºæˆ‘åˆ†æçš„é‚£ä¸ªæ¨¡å—çš„ä½œç”¨äº‘é‡Œé›¾é‡Œï¼Œå¦‚æœè¯´å¾—é«˜å¤§ä¸Šä¸€ç‚¹æ˜¯ä¸æ˜¯è¦å€Ÿç”¨ä¸€äº›æƒ¯ç”¨çš„è¯è¯­ï¼šè‡ªé¡¶å‘ä¸‹ï¼Ÿ233333å¼€ä¸ªç©ç¬‘ã€‚\n\n æˆ‘ä¹Ÿé¢ä¸´è¿‡å¦‚ä½•é˜…è¯»ä¸€ä¸ªæ¡†æ¶çš„æºç çš„é—®é¢˜ï¼Ÿè¯¥æ€ä¹ˆé˜…è¯»æ‰å¥½ï¼Ÿä»å“ªé‡Œä¸‹æ‰‹ï¼Ÿæ‘¸ä¸ç€å¤´æ‘¸ä¸ç€å°¾ï¼Œè‡ªå·±å¹³æ—¶ä¹Ÿæœ‰å–œæ¬¢åšç¬”è®°è‡ªå·±è·Ÿè‡ªå·±è®¨è®ºçš„ä¹ æƒ¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯å°‘äº†ç‚¹ä»€ä¹ˆï¼Œæƒ³æŠŠè‡ªå·±ç†è§£çš„æ‹¿å‡ºæ¥è·Ÿå¤§å®¶åˆ†äº«æ¢è®¨ï¼Œäºæ˜¯ä»Šå¹´è‡ªå·±å¼€å§‹å†™åšå®¢äº†ï¼Œä¹Ÿä¸çŸ¥é“å†™äº›ä»€ä¹ˆå¥½ï¼Œä½†ç›´æ¥æŠŠç¬”è®°å‘å‡ºæ¥æ„Ÿè§‰åˆæœ‰ä¼¤å¤§é›…ï¼Œäºæ˜¯æˆ‘å†³å®šå¼€å§‹æ…¢æ…¢çš„åˆ©ç”¨åšå®¢çš„åšæ–‡æ¥æ¢³ç†è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œè¿‘æœŸçš„åšå®¢å¯èƒ½éƒ½ä¼šå›´ç»•ç€Springçš„æºç åˆ†æã€å¤šçº¿ç¨‹ç›¸å…³çš„çŸ¥è¯†ã€‚\n\nSpringè¿™ä¸ªæ¡†æ¶æˆ‘å°±ä¸å¤šä»‹ç»ï¼Œç©Javaçš„åº”è¯¥éƒ½çŸ¥é“è¿™ä¸ªå¤§åé¼é¼çš„æ¡†æ¶ï¼Œå½“ç„¶ä¸ªäººæ„Ÿè§‰Springå·²ç»ä¸èƒ½ç”¨è¿™ä¸ªæ¡†æ¶è¿™ç§è¯è¯­æ¥å½¢å®¹äº†ï¼Œå®ƒå·²ç»æ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„ç”Ÿæ€äº†(PS: æ„Ÿè°¢è¿™äº›è´¡çŒ®è€…)ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹Springçš„ä½“ç³»ç»“æ„ï¼Œå“¦å¯¹äº†æˆ‘å†™è¿™ä¸ªç³»åˆ—åšæ–‡ä½¿ç”¨çš„Springç‰ˆæœ¬æ˜¯5.0.2\n![è¯¥å›¾æ¥è‡ªäºSpringå®˜æ–¹](https://ws1.sinaimg.cn/large/7fd2951agy1fn2oaj5fcuj20k00f00ti.jpg)\n**Core Containeræ¨¡å—**\n\næ ¹æ®ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¯¥æ¨¡å—ä¸»è¦åŒ…å«äº†beansã€coreã€contextã€SpELå‡ ä¸ªå†…å®¹ï¼Œ`core`å’Œ`beans`è¿™2ä¸ªæ¨¡å—æä¾›äº†æ•´ä¸ªæ¡†æ¶çš„åŸºç¡€ï¼Œå®ƒæä¾›äº†IOCå’Œæ³¨å…¥åè½¬çš„åŠŸèƒ½ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯BeanFactoryçœ‹åå­—å°±çŸ¥é“å®ƒæ˜¯ä½¿ç”¨å·¥å‚æ¨¡å¼è¿›è¡Œçš„å®ç°ï¼Œå®ƒèƒ½å¼±åŒ–ä½ ç¨‹åºåŒ–å•ä¾‹æ¨¡å¼çš„éœ€è¦(å¦‚æœç†è§£ä¸äº†çš„å°±ç®€å•çš„ç†è§£ä¸ºå®ƒä¸éœ€è¦ä½ å»æ˜¾å¼çš„ç¼–å†™ä¸€äº›å¯¹è±¡çš„å•ä¾‹å…¶å®ä¸æ­¢å•çº¯çš„å•ä¾‹è¿™ä¹ˆç®€å•ï¼Œæ…¢æ…¢æ¥å§233333)ï¼Œå¯ä»¥å°†é…ç½®å’Œç‰¹å®šçš„ä¾èµ–å…³ç³»è¿›è¡Œè§£è€¦ã€‚\n\ncore(spring-core):\n    è¯¥æ¨¡å—ä¸»è¦åŒ…å«äº†Springæ¡†æ¶çš„æ ¸å¿ƒå·¥å…·ç±»ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„Springç»„ä»¶éƒ½ä¼šä½¿ç”¨åˆ°è¯¥æ¨¡å—ä¸­çš„ç±»ï¼Œå®ƒå¯ä»¥è¯´çš„ä¸Šæ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒäº†\n\nbeans(spring-beans):\n    è¯¥æ¨¡å—åŸºæœ¬æ‰€æœ‰åº”ç”¨éƒ½ä¼šåº”ç”¨åˆ°ï¼Œå®ƒæä¾›äº†é…ç½®æ–‡ä»¶çš„è§£æã€åˆ›å»ºã€ç®¡ç†beanä»¥åŠè¿›è¡ŒIOC/DIç­‰æ“ä½œç›¸å…³çš„ç±»\n\ncontext(spring-context):\n    è¯¥æ¨¡å—æ˜¯å»ºç«‹åœ¨`core`å’Œ`beans`æ¨¡å—çš„åŸºç¡€ä¹‹ä¸Šï¼Œå®ƒæä¾›äº†ä¸€ç§ç±»ä¼¼äºJNDIæ³¨å†Œå™¨çš„å¯¹è±¡è®¿é—®æ–¹æ³•ï¼ŒåŒæ—¶`context`æ¨¡å—ç»§æ‰¿äº†`beans`æ¨¡å—çš„ä¸€äº›ç‰¹æ€§ï¼Œæä¾›äº†å¤§é‡çš„æ‰©å±•å¹¶ä¸”æ·»åŠ äº†å¯¹å›½é™…åŒ–ã€äº‹ä»¶ä¼ æ’­ã€èµ„æºåŠ è½½å’Œåˆ›å»ºContextçš„æ”¯æŒï¼ŒåŒæ—¶`context`æ¨¡å—ä¹Ÿæ”¯æŒJ2EEçš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚EJBã€JMXå’ŒåŸºç¡€çš„è¿œç¨‹å¤„ç†ï¼Œå…¶ä¸­çš„ApplicationContextæ¥å£æ˜¯è¯¥æ¨¡å—çš„å…³é”®æ ¸å¿ƒï¼Œåç»­ä¼šåˆ†æåˆ°è¯¥æ¥å£ï¼Œç°åœ¨å°±ä¸åšå¤ªè¯¦ç»†çš„æè¿°äº†\n\nSpEL(spring-expression):\n    è¯¥æ¨¡å—æä¾›äº†å¼ºå¤§çš„bè¡¨è¾¾å¼è¯­è¨€ç”¨äºåœ¨è¿è¡Œæ—¶æ“ä½œå¯¹è±¡ï¼Œå®ƒæ˜¯JSP2.1è§„èŒƒæ‰€æŒ‡å®šçš„ç»Ÿä¸€è¡¨è¾¾å¼è¯­è¨€çš„æ‰©å±•ï¼Œè¯¥è¯­è¨€æ”¯æŒè®¾ç½®å’Œè·å–å±æ€§çš„å€¼ã€å±æ€§çš„åˆ†é…ã€æ–¹æ³•çš„è°ƒç”¨ã€æ•°ç»„å†…å®¹çš„å­˜å‚¨ã€å®¹å™¨å’Œç´¢å¼•ã€é€»è¾‘å’Œç®—æœ¯è¿ç®—ç¬¦ã€å‘½åå˜é‡ä»¥åŠä»Springçš„ IoCå®¹å™¨ä¸­æ ¹æ®åç§°æ£€ç´¢å¯¹è±¡ã€‚å½“ç„¶å¸¸è§çš„é›†åˆæ“ä½œä¹Ÿæ˜¯æ”¯æŒçš„\n\t\n**AOP / Instrumentation æ¨¡å—**\n\nAOPæ¨¡å—æä¾›äº†ç¬¦åˆAOPè”ç›Ÿçš„é¢å‘åˆ‡é¢ç¼–ç¨‹çš„å®ç°ï¼ŒåŒæ—¶å®ƒä¹Ÿå…è®¸ä½ è‡ªå®šä¹‰ä¾‹å¦‚ï¼šæ–¹æ³•æ‹¦æˆªå™¨å’Œåˆ‡å…¥ç‚¹ï¼Œå°†é€»è¾‘ä»£ç å’Œæ–¹æ³•æ‹¦æˆªå™¨çš„ä»£ç å½»åº•åˆ†å¼€ï¼Œé™ä½ä»–ä»¬ä¹‹é—´è€¦åˆæ€§ï¼Œåˆ©ç”¨ source-level çš„å…ƒæ•°æ®åŠŸèƒ½ï¼Œè¿˜å¯ä»¥å°†å„ç§è¡Œä¸ºä¿¡æ¯åˆå¹¶åˆ°ä½ çš„ä»£ç ä¸­ï¼Œè¿™æœ‰ç‚¹åƒ.NetæŠ€æœ¯ä¸­çš„attributeæ¦‚å¿µ\nå•ç‹¬çš„spring-aspectsæ¨¡å—æä¾›äº†AspectJçš„é›†æˆå’Œä½¿ç”¨ã€‚\n`instrument`æ¨¡å—æä¾›äº†`class instrumentation`çš„æ”¯æŒä»¥åŠåœ¨æŸäº›åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä½¿ç”¨ç±»åŠ è½½å™¨å®ç°ã€‚\n\n**Messaging æ¨¡å—**\n\nè¯¥æ¨¡å—æ˜¯Spring4ä»¥åå¼•å…¥çš„ï¼Œæ˜¯ä»Springé›†æˆé¡¹ç›®ä¸­æŠ½è±¡å‡ºæ¥çš„ï¼Œä¾‹å¦‚Messageã€MessageChannelã€MessageHandlerä»¥åŠå…¶ä»–ç”¨æ¥æä¾›åŸºäºæ¶ˆæ¯çš„åŸºç¡€æœåŠ¡ï¼Œè¯¥æ¨¡å—è¿˜åŒ…æ‹¬äº†èƒ½å°†æ¶ˆæ¯æ˜ å°„åˆ°æ–¹æ³•çš„æ³¨è§£ï¼Œç±»ä¼¼äºåŸºäºç¼–ç¨‹æ¨¡å‹çš„Spring MVCæ³¨è§£ã€‚\n\n**Data Access/Integration æ¨¡å—**\n\nè¯¥æ¨¡å—ç”±ç”±JDBCã€ORMã€OXMã€JMSå’Œäº‹åŠ¡æ¨¡å—ç»„æˆ\njdbc(spring-jdbc): ç©Javaçš„åº”è¯¥éƒ½çŸ¥é“JDBCæ²¡æœ‰ç»è¿‡å°è£…æ—¶å†™èµ·æ¥çš„æ—¶å€™æœ‰å¤šä¹ˆçš„å†—é•¿å§..ï¼Œè¯¥æ¨¡å—ä¸»è¦å¯¹JDBCè¿›è¡Œäº†å°è£…\ntrasaction(spring-tx): è¯¥æ¨¡å—æä¾›äº†å¯ç¼–ç¨‹å’Œå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œè¿™äº›ç±»éƒ½å¿…é¡»å®ç°ç‰¹å®šçš„æ¥å£ï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰POJOéƒ½é€‚ç”¨ã€‚\n\norm(spring-orm): è¯¥æ¨¡å—æä¾›äº†æµè¡Œçš„å¯¹è±¡å…³ç³»æ˜ å°„(ORM)APIæä¾›äº†ä¸€ä¸ªäº¤äº’å±‚ï¼Œä¾‹å¦‚JPAã€JDOã€Hibernateã€MyBatisç­‰ï¼Œåˆ©ç”¨è¯¥æ¨¡å—çš„å°è£…å¯ä»¥åœ¨Springæä¾›çš„ç‰¹æ€§ä¸Šä½¿ç”¨æ‰€æœ‰çš„O/Ræ˜ å°„æ¡†æ¶ä¸Springæä¾›çš„å…¶å®ƒåŠŸèƒ½è¿›è¡Œç»“åˆä½¿ç”¨ï¼Œè¯´ç™½äº†å°±æ˜¯å¯¹è¿™äº›ORMæ¡†æ¶è¿›è¡Œé›†æˆï¼Œå¦‚æœè¿™æ ·å¥½ç†è§£å°±è¿™æ ·ç†è§£å§,233333\n\noxm(spring-oxm):è¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªå¯¹Object / XMLæ˜ å°„å®ç°çš„æŠ½è±¡å±‚ï¼ŒObject/XMLæ˜ å°„å®ç°åŒ…æ‹¬JAXBã€Castorã€XMLBeansã€JiBXå’ŒXStreamï¼Œå¦‚æœç†è§£ä¸äº†çš„è¯,å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå°±æ˜¯xmlè½¬æ¢æˆå¯¹è±¡ï¼Œ233333ã€‚\n\njms:è¯¥æ¨¡å—ç”¨äºç”Ÿäº§å’Œæ¶ˆè´¹æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œä»Spring4.1å¼€å§‹æä¾›é›†æˆ`messaging`æ¨¡å—\n\n**Webæ¨¡å—**\n\nè¯¥æ¨¡å—ç”±webã€webmvcã€websocketã€portletæ¨¡å—æ„æˆ\n\nweb(spring-web):è¯¥æ¨¡å—æä¾›äº†åŸºæœ¬çš„é¢å‘Webå¼€å‘çš„é›†æˆåŠŸèƒ½ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ ã€ä½¿ç”¨Servlet listenerså’ŒWebå¼€å‘åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆå§‹åŒ–IOCå®¹å™¨,ä¹ŸåŒ…å«HTTPå®¢æˆ·ç«¯ä»¥åŠSpringæœ‰å…³Webéƒ¨åˆ†çš„è¿œç¨‹è®¿é—®æ”¯æŒ\n\nwebmvc(spring-webmvc): è¯¥æ¨¡å—ä¹Ÿè¢«ç§°ä¸ºWeb-Servletæ¨¡å—ï¼ŒåŒ…å«Springçš„model-view-controller(MVC)çš„å®ç°å’ŒREST Web Servicesçš„å®ç°, Springçš„MVCæ¡†æ¶ä½¿å¾—æ¨¡å‹èŒƒå›´å†…çš„ä»£ç å’Œweb formsä¹‹é—´èƒ½å¤Ÿæ¸…æ¥šåœ°åˆ†ç¦»å¼€æ¥ï¼Œå¹¶ä¸Springæ¡†æ¶çš„å…¶ä»–ç‰¹æ€§é›†æˆåœ¨ä¸€èµ·\n\nportlet(spring-webmvc-portlet)ï¼šè¯¥æ¨¡å—ä¹Ÿè¢«ç§°ä¸ºWeb-Portletæ¨¡å—ï¼Œæä¾›äº†MVCæ¨¡å¼çš„å®ç°ï¼Œä½¿ç”¨Portletç¯å¢ƒå’Œwebmvcæ¨¡å—åŠŸèƒ½çš„é•œåƒï¼Œå…¶å®è¿™å—å·²ç»åœ¨Spring 5ä¸­å·²ç»è¢«åºŸå¼ƒè¢«webfluxæ¨¡å—å–ä»£23333\n\n**Testæ¨¡å—**\n\nspring-testæ¨¡å—æ”¯æŒé€šè¿‡é›†æˆJUnitæˆ–TestNGæ¥è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œå®ƒæä¾›äº†æŒç»­åŠ è½½ApplicationContextå¹¶ä¸”ä¼šç¼“å­˜è¿™äº›ä¸Šä¸‹æ–‡ï¼Œè€Œä¸”å®ƒè¿˜æä¾›äº†Mockå¯¹è±¡å¯ä»¥ç”¨æ¥éš”ç¦»æµ‹è¯•ä»£ç ~~~\n\nå¤§è‡´å°±äº†è§£åˆ°è¿™é‡Œäº†ï¼Œå‰§é€ä¸€æ³¢æˆ‘ä¼šä»beansæ¨¡å—çš„æºç å¼€å§‹å†™åšå®¢~~~~ 2333 ï¼Œç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼ã€‚\n","cover":"","link":"spring_start_struct_intro.html","preview":"\u003cp\u003eæ–°å¹´å¥½ï¼Œæ­¤ç« å¯¹Springçš„ä½“ç³»ç»“æ„è¿›è¡Œçš„ä¸€äº›ç®€æ˜çš„è¯´æ˜ã€‚\u003c/p\u003e\n","title":"Springæºç ç³»åˆ— - å¼€ç¯‡ - Springä½“ç³»ç»“æ„ç®€ä»‹"},{"content":"\n# åšå®¢å¼€é€šäº†\nå¤§å®¶æ–°å¹´å¥½ï¼Œæˆ‘å†³å®šä»ä»Šå¹´å¼€å§‹å†™åšå®¢å•¦ï¼","cover":"","link":"blog_start.html","preview":"\u003cp\u003eå¤§å®¶æ–°å¹´å¥½å‘€ï¼\u003c/p\u003e\n","title":"åšå®¢å¼€é€šäº†"}]